{"version":3,"sources":["../../../../../nodes/Discord/v2/methods/loadOptions.ts"],"sourcesContent":["import type { IDataObject, ILoadOptionsFunctions, INodePropertyOptions } from 'n8n-workflow';\n\nimport { checkAccessToGuild } from '../helpers/utils';\nimport { discordApiRequest } from '../transport';\n\nexport async function getRoles(this: ILoadOptionsFunctions): Promise<INodePropertyOptions[]> {\n\tconst guildId = this.getNodeParameter('guildId', undefined, {\n\t\textractValue: true,\n\t}) as string;\n\n\tconst isOAuth2 = this.getNodeParameter('authentication', '') === 'oAuth2';\n\n\tif (isOAuth2) {\n\t\tconst userGuilds = (await discordApiRequest.call(\n\t\t\tthis,\n\t\t\t'GET',\n\t\t\t'/users/@me/guilds',\n\t\t)) as IDataObject[];\n\n\t\tcheckAccessToGuild(this.getNode(), guildId, userGuilds);\n\t}\n\n\tlet response = await discordApiRequest.call(this, 'GET', `/guilds/${guildId}/roles`);\n\n\tconst operations = this.getNodeParameter('operation') as string;\n\n\tif (operations === 'roleRemove') {\n\t\tconst userId = this.getNodeParameter('userId', undefined, {\n\t\t\textractValue: true,\n\t\t}) as string;\n\n\t\tconst userRoles = ((\n\t\t\tawait discordApiRequest.call(this, 'GET', `/guilds/${guildId}/members/${userId}`)\n\t\t).roles || []) as string[];\n\n\t\tresponse = response.filter((role: IDataObject) => {\n\t\t\treturn userRoles.includes(role.id as string);\n\t\t});\n\t}\n\n\treturn response\n\t\t.filter((role: IDataObject) => role.name !== '@everyone' && !role.managed)\n\t\t.map((role: IDataObject) => ({\n\t\t\tname: role.name as string,\n\t\t\tvalue: role.id as string,\n\t\t}));\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,mBAAmC;AACnC,uBAAkC;AAElC,eAAsB,WAAuE;AAC5F,QAAM,UAAU,KAAK,iBAAiB,WAAW,QAAW;AAAA,IAC3D,cAAc;AAAA,EACf,CAAC;AAED,QAAM,WAAW,KAAK,iBAAiB,kBAAkB,EAAE,MAAM;AAEjE,MAAI,UAAU;AACb,UAAM,aAAc,MAAM,mCAAkB;AAAA,MAC3C;AAAA,MACA;AAAA,MACA;AAAA,IACD;AAEA,yCAAmB,KAAK,QAAQ,GAAG,SAAS,UAAU;AAAA,EACvD;AAEA,MAAI,WAAW,MAAM,mCAAkB,KAAK,MAAM,OAAO,WAAW,OAAO,QAAQ;AAEnF,QAAM,aAAa,KAAK,iBAAiB,WAAW;AAEpD,MAAI,eAAe,cAAc;AAChC,UAAM,SAAS,KAAK,iBAAiB,UAAU,QAAW;AAAA,MACzD,cAAc;AAAA,IACf,CAAC;AAED,UAAM,aACL,MAAM,mCAAkB,KAAK,MAAM,OAAO,WAAW,OAAO,YAAY,MAAM,EAAE,GAC/E,SAAS,CAAC;AAEZ,eAAW,SAAS,OAAO,CAAC,SAAsB;AACjD,aAAO,UAAU,SAAS,KAAK,EAAY;AAAA,IAC5C,CAAC;AAAA,EACF;AAEA,SAAO,SACL,OAAO,CAAC,SAAsB,KAAK,SAAS,eAAe,CAAC,KAAK,OAAO,EACxE,IAAI,CAAC,UAAuB;AAAA,IAC5B,MAAM,KAAK;AAAA,IACX,OAAO,KAAK;AAAA,EACb,EAAE;AACJ;","names":[]}