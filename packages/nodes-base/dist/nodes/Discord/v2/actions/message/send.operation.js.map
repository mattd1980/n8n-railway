{"version":3,"sources":["../../../../../../nodes/Discord/v2/actions/message/send.operation.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tINodeExecutionData,\n\tINodeProperties,\n} from 'n8n-workflow';\n\nimport { updateDisplayOptions } from '../../../../../utils/utilities';\nimport {\n\tparseDiscordError,\n\tprepareEmbeds,\n\tprepareErrorData,\n\tprepareOptions,\n\tsendDiscordMessage,\n} from '../../helpers/utils';\nimport {\n\tembedsFixedCollection,\n\tfilesFixedCollection,\n\tsendToProperties,\n} from '../common.description';\n\nconst properties: INodeProperties[] = [\n\t...sendToProperties,\n\t{\n\t\tdisplayName: 'Message',\n\t\tname: 'content',\n\t\ttype: 'string',\n\t\tdefault: '',\n\t\tdescription: 'The content of the message (up to 2000 characters)',\n\t\tplaceholder: 'e.g. My message',\n\t\ttypeOptions: {\n\t\t\trows: 2,\n\t\t},\n\t},\n\t{\n\t\tdisplayName: 'Options',\n\t\tname: 'options',\n\t\ttype: 'collection',\n\t\tplaceholder: 'Add option',\n\t\tdefault: {},\n\t\toptions: [\n\t\t\t{\n\t\t\t\tdisplayName: 'Flags',\n\t\t\t\tname: 'flags',\n\t\t\t\ttype: 'multiOptions',\n\t\t\t\tdefault: [],\n\t\t\t\tdescription:\n\t\t\t\t\t'Message flags. <a href=\"https://discord.com/developers/docs/resources/channel#message-object-message-flags\" target=\"_blank\">More info</a>.‚Äù.',\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Suppress Embeds',\n\t\t\t\t\t\tvalue: 'SUPPRESS_EMBEDS',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Suppress Notifications',\n\t\t\t\t\t\tvalue: 'SUPPRESS_NOTIFICATIONS',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line n8n-nodes-base/node-param-display-name-miscased\n\t\t\t\tdisplayName: 'Message to Reply to',\n\t\t\t\tname: 'message_reference',\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: '',\n\t\t\t\tdescription: 'Fill this to make your message a reply. Add the message ID.',\n\t\t\t\tplaceholder: 'e.g. 1059467601836773386',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Text-to-Speech (TTS)',\n\t\t\t\tname: 'tts',\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdefault: false,\n\t\t\t\tdescription: 'Whether to have a bot reading the message directly in the channel',\n\t\t\t},\n\t\t],\n\t},\n\tembedsFixedCollection,\n\tfilesFixedCollection,\n];\n\nconst displayOptions = {\n\tshow: {\n\t\tresource: ['message'],\n\t\toperation: ['send'],\n\t},\n\thide: {\n\t\tauthentication: ['webhook'],\n\t},\n};\n\nexport const description = updateDisplayOptions(displayOptions, properties);\n\nexport async function execute(\n\tthis: IExecuteFunctions,\n\tguildId: string,\n\tuserGuilds: IDataObject[],\n): Promise<INodeExecutionData[]> {\n\tconst returnData: INodeExecutionData[] = [];\n\tconst items = this.getInputData();\n\n\tconst isOAuth2 = this.getNodeParameter('authentication', 0) === 'oAuth2';\n\n\tfor (let i = 0; i < items.length; i++) {\n\t\tconst content = this.getNodeParameter('content', i) as string;\n\t\tconst options = prepareOptions(this.getNodeParameter('options', i, {}), guildId);\n\n\t\tconst embeds = (this.getNodeParameter('embeds', i, undefined) as IDataObject)\n\t\t\t?.values as IDataObject[];\n\t\tconst files = (this.getNodeParameter('files', i, undefined) as IDataObject)\n\t\t\t?.values as IDataObject[];\n\n\t\tconst body: IDataObject = {\n\t\t\tcontent,\n\t\t\t...options,\n\t\t};\n\n\t\tif (embeds) {\n\t\t\tbody.embeds = prepareEmbeds.call(this, embeds);\n\t\t}\n\n\t\ttry {\n\t\t\treturnData.push(\n\t\t\t\t...(await sendDiscordMessage.call(this, {\n\t\t\t\t\tguildId,\n\t\t\t\t\tuserGuilds,\n\t\t\t\t\tisOAuth2,\n\t\t\t\t\tbody,\n\t\t\t\t\titems,\n\t\t\t\t\tfiles,\n\t\t\t\t\titemIndex: i,\n\t\t\t\t})),\n\t\t\t);\n\t\t} catch (error) {\n\t\t\tconst err = parseDiscordError.call(this, error, i);\n\n\t\t\tif (this.continueOnFail()) {\n\t\t\t\treturnData.push(...prepareErrorData.call(this, err, i));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\treturn returnData;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA,uBAAqC;AACrC,mBAMO;AACP,oBAIO;AAEP,MAAM,aAAgC;AAAA,EACrC,GAAG;AAAA,EACH;AAAA,IACC,aAAa;AAAA,IACb,MAAM;AAAA,IACN,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,aAAa;AAAA,IACb,aAAa;AAAA,MACZ,MAAM;AAAA,IACP;AAAA,EACD;AAAA,EACA;AAAA,IACC,aAAa;AAAA,IACb,MAAM;AAAA,IACN,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS,CAAC;AAAA,IACV,SAAS;AAAA,MACR;AAAA,QACC,aAAa;AAAA,QACb,MAAM;AAAA,QACN,MAAM;AAAA,QACN,SAAS,CAAC;AAAA,QACV,aACC;AAAA,QACD,SAAS;AAAA,UACR;AAAA,YACC,MAAM;AAAA,YACN,OAAO;AAAA,UACR;AAAA,UACA;AAAA,YACC,MAAM;AAAA,YACN,OAAO;AAAA,UACR;AAAA,QACD;AAAA,MACD;AAAA,MACA;AAAA;AAAA,QAEC,aAAa;AAAA,QACb,MAAM;AAAA,QACN,MAAM;AAAA,QACN,SAAS;AAAA,QACT,aAAa;AAAA,QACb,aAAa;AAAA,MACd;AAAA,MACA;AAAA,QACC,aAAa;AAAA,QACb,MAAM;AAAA,QACN,MAAM;AAAA,QACN,SAAS;AAAA,QACT,aAAa;AAAA,MACd;AAAA,IACD;AAAA,EACD;AAAA,EACA;AAAA,EACA;AACD;AAEA,MAAM,iBAAiB;AAAA,EACtB,MAAM;AAAA,IACL,UAAU,CAAC,SAAS;AAAA,IACpB,WAAW,CAAC,MAAM;AAAA,EACnB;AAAA,EACA,MAAM;AAAA,IACL,gBAAgB,CAAC,SAAS;AAAA,EAC3B;AACD;AAEO,MAAM,kBAAc,uCAAqB,gBAAgB,UAAU;AAE1E,eAAsB,QAErB,SACA,YACgC;AAChC,QAAM,aAAmC,CAAC;AAC1C,QAAM,QAAQ,KAAK,aAAa;AAEhC,QAAM,WAAW,KAAK,iBAAiB,kBAAkB,CAAC,MAAM;AAEhE,WAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACtC,UAAM,UAAU,KAAK,iBAAiB,WAAW,CAAC;AAClD,UAAM,cAAU,6BAAe,KAAK,iBAAiB,WAAW,GAAG,CAAC,CAAC,GAAG,OAAO;AAE/E,UAAM,SAAU,KAAK,iBAAiB,UAAU,GAAG,MAAS,GACzD;AACH,UAAM,QAAS,KAAK,iBAAiB,SAAS,GAAG,MAAS,GACvD;AAEH,UAAM,OAAoB;AAAA,MACzB;AAAA,MACA,GAAG;AAAA,IACJ;AAEA,QAAI,QAAQ;AACX,WAAK,SAAS,2BAAc,KAAK,MAAM,MAAM;AAAA,IAC9C;AAEA,QAAI;AACH,iBAAW;AAAA,QACV,GAAI,MAAM,gCAAmB,KAAK,MAAM;AAAA,UACvC;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,WAAW;AAAA,QACZ,CAAC;AAAA,MACF;AAAA,IACD,SAAS,OAAO;AACf,YAAM,MAAM,+BAAkB,KAAK,MAAM,OAAO,CAAC;AAEjD,UAAI,KAAK,eAAe,GAAG;AAC1B,mBAAW,KAAK,GAAG,8BAAiB,KAAK,MAAM,KAAK,CAAC,CAAC;AACtD;AAAA,MACD;AAEA,YAAM;AAAA,IACP;AAAA,EACD;AAEA,SAAO;AACR;","names":[]}