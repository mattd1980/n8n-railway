{"version":3,"sources":["../../../../../../nodes/Discord/v2/actions/webhook/sendLegacy.operation.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tINodeExecutionData,\n\tINodeProperties,\n} from 'n8n-workflow';\n\nimport { updateDisplayOptions } from '../../../../../utils/utilities';\nimport {\n\tparseDiscordError,\n\tprepareEmbeds,\n\tprepareErrorData,\n\tprepareMultiPartForm,\n\tprepareOptions,\n} from '../../helpers/utils';\nimport { discordApiMultiPartRequest, discordApiRequest } from '../../transport';\nimport { embedsFixedCollection, filesFixedCollection } from '../common.description';\n\nconst properties: INodeProperties[] = [\n\t{\n\t\tdisplayName: 'Message',\n\t\tname: 'content',\n\t\ttype: 'string',\n\t\tdefault: '',\n\t\tdescription: 'The content of the message (up to 2000 characters)',\n\t\tplaceholder: 'e.g. My message',\n\t\ttypeOptions: {\n\t\t\trows: 2,\n\t\t},\n\t},\n\t{\n\t\tdisplayName: 'Options',\n\t\tname: 'options',\n\t\ttype: 'collection',\n\t\tplaceholder: 'Add option',\n\t\tdefault: {},\n\t\toptions: [\n\t\t\t{\n\t\t\t\tdisplayName: 'Avatar URL',\n\t\t\t\tname: 'avatar_url',\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: '',\n\t\t\t\tdescription: 'Override the default avatar of the webhook',\n\t\t\t\tplaceholder: 'e.g. https://example.com/image.png',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Flags',\n\t\t\t\tname: 'flags',\n\t\t\t\ttype: 'multiOptions',\n\t\t\t\tdefault: [],\n\t\t\t\tdescription:\n\t\t\t\t\t'Message flags. <a href=\"https://discord.com/developers/docs/resources/channel#message-object-message-flags\" target=\"_blank\">More info</a>.‚Äù.',\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Suppress Embeds',\n\t\t\t\t\t\tvalue: 'SUPPRESS_EMBEDS',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Suppress Notifications',\n\t\t\t\t\t\tvalue: 'SUPPRESS_NOTIFICATIONS',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Text-to-Speech (TTS)',\n\t\t\t\tname: 'tts',\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdefault: false,\n\t\t\t\tdescription: 'Whether to have a bot reading the message directly in the channel',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Username',\n\t\t\t\tname: 'username',\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: '',\n\t\t\t\tdescription: 'Override the default username of the webhook',\n\t\t\t\tplaceholder: 'e.g. My Username',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Wait',\n\t\t\t\tname: 'wait',\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdefault: false,\n\t\t\t\tdescription: 'Whether wait for the message to be created before returning its response',\n\t\t\t},\n\t\t],\n\t},\n\tembedsFixedCollection,\n\tfilesFixedCollection,\n];\n\nconst displayOptions = {\n\tshow: {\n\t\toperation: ['sendLegacy'],\n\t},\n\thide: {\n\t\tauthentication: ['botToken', 'oAuth2'],\n\t},\n};\n\nexport const description = updateDisplayOptions(displayOptions, properties);\n\nexport async function execute(this: IExecuteFunctions): Promise<INodeExecutionData[]> {\n\tconst returnData: INodeExecutionData[] = [];\n\tconst items = this.getInputData();\n\n\tfor (let i = 0; i < items.length; i++) {\n\t\tconst content = this.getNodeParameter('content', i) as string;\n\t\tconst options = prepareOptions(this.getNodeParameter('options', i, {}));\n\n\t\tconst embeds = (this.getNodeParameter('embeds', i, undefined) as IDataObject)\n\t\t\t?.values as IDataObject[];\n\t\tconst files = (this.getNodeParameter('files', i, undefined) as IDataObject)\n\t\t\t?.values as IDataObject[];\n\n\t\tlet qs: IDataObject | undefined = undefined;\n\n\t\tif (options.wait) {\n\t\t\tqs = {\n\t\t\t\twait: options.wait,\n\t\t\t};\n\n\t\t\tdelete options.wait;\n\t\t}\n\n\t\tconst body: IDataObject = {\n\t\t\tcontent,\n\t\t\t...options,\n\t\t};\n\n\t\tif (embeds) {\n\t\t\tbody.embeds = prepareEmbeds.call(this, embeds);\n\t\t}\n\n\t\ttry {\n\t\t\tlet response: IDataObject[] = [];\n\n\t\t\tif (files?.length) {\n\t\t\t\tconst multiPartBody = await prepareMultiPartForm.call(this, items, files, body, i);\n\n\t\t\t\tresponse = await discordApiMultiPartRequest.call(this, 'POST', '', multiPartBody);\n\t\t\t} else {\n\t\t\t\tresponse = await discordApiRequest.call(this, 'POST', '', body, qs);\n\t\t\t}\n\n\t\t\tconst executionData = this.helpers.constructExecutionMetaData(\n\t\t\t\tthis.helpers.returnJsonArray(response),\n\t\t\t\t{ itemData: { item: i } },\n\t\t\t);\n\n\t\t\treturnData.push(...executionData);\n\t\t} catch (error) {\n\t\t\tconst err = parseDiscordError.call(this, error, i);\n\n\t\t\tif (this.continueOnFail()) {\n\t\t\t\treturnData.push(...prepareErrorData.call(this, err, i));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\treturn returnData;\n}\n"],"mappings":"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","names":[]}