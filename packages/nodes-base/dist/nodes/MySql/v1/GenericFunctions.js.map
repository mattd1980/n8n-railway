{"version":3,"sources":["../../../../nodes/MySql/v1/GenericFunctions.ts"],"sourcesContent":["import mysql2 from 'mysql2/promise';\nimport type {\n\tICredentialDataDecryptedObject,\n\tIDataObject,\n\tILoadOptionsFunctions,\n\tINodeListSearchResult,\n} from 'n8n-workflow';\n\nexport async function createConnection(\n\tcredentials: ICredentialDataDecryptedObject,\n): Promise<mysql2.Connection> {\n\tconst { ssl, caCertificate, clientCertificate, clientPrivateKey, ...baseCredentials } =\n\t\tcredentials;\n\n\tif (ssl) {\n\t\tbaseCredentials.ssl = {};\n\n\t\tif (caCertificate) {\n\t\t\tbaseCredentials.ssl.ca = caCertificate;\n\t\t}\n\n\t\tif (clientCertificate || clientPrivateKey) {\n\t\t\tbaseCredentials.ssl.cert = clientCertificate;\n\t\t\tbaseCredentials.ssl.key = clientPrivateKey;\n\t\t}\n\t}\n\n\treturn await mysql2.createConnection(baseCredentials);\n}\n\nexport async function searchTables(\n\tthis: ILoadOptionsFunctions,\n\ttableName?: string,\n): Promise<INodeListSearchResult> {\n\tconst credentials = await this.getCredentials('mySql');\n\tconst connection = await createConnection(credentials);\n\tconst sql = `SELECT table_name\nFROM   information_schema.tables\nWHERE  table_schema = ?\nAND table_name LIKE ?\nORDER  BY table_name`;\n\n\tconst values = [credentials.database, `%${tableName ?? ''}%`];\n\tconst [rows] = await connection.query(sql, values);\n\tconst results = (rows as IDataObject[]).map((table) => ({\n\t\tname: (table.table_name as string) || (table.TABLE_NAME as string),\n\t\tvalue: (table.table_name as string) || (table.TABLE_NAME as string),\n\t}));\n\tawait connection.end();\n\treturn { results };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAAmB;AAQnB,eAAsB,iBACrB,aAC6B;AAC7B,QAAM,EAAE,KAAK,eAAe,mBAAmB,kBAAkB,GAAG,gBAAgB,IACnF;AAED,MAAI,KAAK;AACR,oBAAgB,MAAM,CAAC;AAEvB,QAAI,eAAe;AAClB,sBAAgB,IAAI,KAAK;AAAA,IAC1B;AAEA,QAAI,qBAAqB,kBAAkB;AAC1C,sBAAgB,IAAI,OAAO;AAC3B,sBAAgB,IAAI,MAAM;AAAA,IAC3B;AAAA,EACD;AAEA,SAAO,MAAM,eAAAA,QAAO,iBAAiB,eAAe;AACrD;AAEA,eAAsB,aAErB,WACiC;AACjC,QAAM,cAAc,MAAM,KAAK,eAAe,OAAO;AACrD,QAAM,aAAa,MAAM,iBAAiB,WAAW;AACrD,QAAM,MAAM;AAAA;AAAA;AAAA;AAAA;AAMZ,QAAM,SAAS,CAAC,YAAY,UAAU,IAAI,aAAa,EAAE,GAAG;AAC5D,QAAM,CAAC,IAAI,IAAI,MAAM,WAAW,MAAM,KAAK,MAAM;AACjD,QAAM,UAAW,KAAuB,IAAI,CAAC,WAAW;AAAA,IACvD,MAAO,MAAM,cAA0B,MAAM;AAAA,IAC7C,OAAQ,MAAM,cAA0B,MAAM;AAAA,EAC/C,EAAE;AACF,QAAM,WAAW,IAAI;AACrB,SAAO,EAAE,QAAQ;AAClB;","names":["mysql2"]}