{"version":3,"sources":["../../../../../../nodes/SeaTable/v2/actions/row/create.operation.ts"],"sourcesContent":["import {\n\ttype IDataObject,\n\ttype INodeExecutionData,\n\ttype INodeProperties,\n\ttype IExecuteFunctions,\n\tupdateDisplayOptions,\n} from 'n8n-workflow';\n\nimport {\n\tseaTableApiRequest,\n\tgetTableColumns,\n\tsplit,\n\trowExport,\n\tupdateAble,\n\tsplitStringColumnsToArrays,\n} from '../../GenericFunctions';\nimport type { TColumnValue, TColumnsUiValues } from '../../types';\nimport type { IRowObject } from '../Interfaces';\n\nexport const properties: INodeProperties[] = [\n\t{\n\t\tdisplayName: 'Data to Send',\n\t\tname: 'fieldsToSend',\n\t\ttype: 'options',\n\t\toptions: [\n\t\t\t{\n\t\t\t\tname: 'Auto-Map Input Data to Columns',\n\t\t\t\tvalue: 'autoMapInputData',\n\t\t\t\tdescription: 'Use when node input properties match destination column names',\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: 'Define Below for Each Column',\n\t\t\t\tvalue: 'defineBelow',\n\t\t\t\tdescription: 'Set the value for each destination column',\n\t\t\t},\n\t\t],\n\t\tdefault: 'defineBelow',\n\t\tdescription: 'Whether to insert the input data this node receives in the new row',\n\t},\n\t{\n\t\tdisplayName: 'Apply Column Default Values',\n\t\tname: 'apply_default',\n\t\ttype: 'boolean',\n\t\tdefault: false,\n\t\tdescription:\n\t\t\t'Whether to use the column default values to populate new rows during creation (only available for normal backend)',\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\tbigdata: [false],\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tdisplayName:\n\t\t\t'In this mode, make sure the incoming data fields are named the same as the columns in SeaTable. (Use an \"Edit Fields\" node before this node to change them if required.)',\n\t\tname: 'notice',\n\t\ttype: 'notice',\n\t\tdefault: '',\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\t'/fieldsToSend': ['autoMapInputData'],\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tdisplayName: 'Inputs to Ignore',\n\t\tname: 'inputsToIgnore',\n\t\ttype: 'string',\n\t\tdefault: '',\n\t\tdescription:\n\t\t\t'List of input properties to avoid sending, separated by commas. Leave empty to send all properties.',\n\t\tplaceholder: 'Enter properties...',\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\t'/fieldsToSend': ['autoMapInputData'],\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tdisplayName: 'Columns to Send',\n\t\tname: 'columnsUi',\n\t\tplaceholder: 'Add Column',\n\t\ttype: 'fixedCollection',\n\t\ttypeOptions: {\n\t\t\tmultipleValueButtonText: 'Add Column to Send',\n\t\t\tmultipleValues: true,\n\t\t},\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\t'/fieldsToSend': ['defineBelow'],\n\t\t\t},\n\t\t},\n\t\toptions: [\n\t\t\t{\n\t\t\t\tdisplayName: 'Column',\n\t\t\t\tname: 'columnValues',\n\t\t\t\tvalues: [\n\t\t\t\t\t{\n\t\t\t\t\t\tdisplayName: 'Column Name or ID',\n\t\t\t\t\t\tname: 'columnName',\n\t\t\t\t\t\ttype: 'options',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'Choose from the list, or specify an ID using an <a href=\"https://docs.n8n.io/code/expressions/\">expression</a>',\n\t\t\t\t\t\ttypeOptions: {\n\t\t\t\t\t\t\tloadOptionsDependsOn: ['tableName'],\n\t\t\t\t\t\t\tloadOptionsMethod: 'getTableUpdateAbleColumns',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tdisplayName: 'Column Value',\n\t\t\t\t\t\tname: 'columnValue',\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t],\n\t\tdefault: {},\n\t\tdescription:\n\t\t\t'Add destination column with its value. Provide the value in this way. Date: YYYY-MM-DD or YYYY-MM-DD hh:mm. Duration: time in seconds. Checkbox: true, on or 1. Multi-Select: comma-separated list.',\n\t},\n\t{\n\t\tdisplayName: 'Save to \"Big Data\" Backend',\n\t\tname: 'bigdata',\n\t\ttype: 'boolean',\n\t\tdefault: false,\n\t\tdescription:\n\t\t\t'Whether write to Big Data backend (true) or not (false). True requires the activation of the Big Data backend in the base.',\n\t},\n\t{\n\t\tdisplayName:\n\t\t\t'Hint: Link, files, images or digital signatures have to be added separately. These column types cannot be set with this node.',\n\t\tname: 'notice',\n\t\ttype: 'notice',\n\t\tdefault: '',\n\t},\n];\n\nconst displayOptions = {\n\tshow: {\n\t\tresource: ['row'],\n\t\toperation: ['create'],\n\t},\n};\n\nexport const description = updateDisplayOptions(displayOptions, properties);\n\nexport async function execute(\n\tthis: IExecuteFunctions,\n\tindex: number,\n): Promise<INodeExecutionData[]> {\n\tconst tableName = this.getNodeParameter('tableName', index) as string;\n\tconst tableColumns = await getTableColumns.call(this, tableName);\n\tconst fieldsToSend = this.getNodeParameter('fieldsToSend', index) as\n\t\t| 'defineBelow'\n\t\t| 'autoMapInputData';\n\tconst bigdata = this.getNodeParameter('bigdata', index) as boolean;\n\tconst apply_default = this.getNodeParameter('apply_default', index, false) as boolean;\n\n\tconst body = {\n\t\ttable_name: tableName,\n\t\trows: {},\n\t} as IDataObject;\n\tlet rowInput = {} as IRowObject;\n\n\t// get rowInput, an object of key:value pairs like { Name: 'Promo Action 1', Status: \"Draft\" }.\n\tif (fieldsToSend === 'autoMapInputData') {\n\t\tconst items = this.getInputData();\n\t\tconst incomingKeys = Object.keys(items[index].json);\n\t\tconst inputDataToIgnore = split(this.getNodeParameter('inputsToIgnore', index, '') as string);\n\t\tfor (const key of incomingKeys) {\n\t\t\tif (inputDataToIgnore.includes(key)) continue;\n\t\t\trowInput[key] = items[index].json[key] as TColumnValue;\n\t\t}\n\t} else {\n\t\tconst columns = this.getNodeParameter('columnsUi.columnValues', index, []) as TColumnsUiValues;\n\t\tfor (const column of columns) {\n\t\t\trowInput[column.columnName] = column.columnValue;\n\t\t}\n\t}\n\n\t// only keep key:value pairs for columns that are allowed to update.\n\trowInput = rowExport(rowInput, updateAble(tableColumns));\n\n\t// string to array: multi-select and collaborators\n\trowInput = splitStringColumnsToArrays(rowInput, tableColumns);\n\n\t// save to big data backend\n\tif (bigdata) {\n\t\tbody.rows = [rowInput];\n\t\tconst responseData = await seaTableApiRequest.call(\n\t\t\tthis,\n\t\t\t{},\n\t\t\t'POST',\n\t\t\t'/api-gateway/api/v2/dtables/{{dtable_uuid}}/add-archived-rows/',\n\t\t\tbody,\n\t\t);\n\t\treturn this.helpers.returnJsonArray(responseData as IDataObject[]);\n\t}\n\t// save to normal backend\n\telse {\n\t\tbody.rows = [rowInput];\n\t\tif (apply_default) {\n\t\t\tbody.apply_default = true;\n\t\t}\n\t\tconst responseData = await seaTableApiRequest.call(\n\t\t\tthis,\n\t\t\t{},\n\t\t\t'POST',\n\t\t\t'/api-gateway/api/v2/dtables/{{dtable_uuid}}/rows/',\n\t\t\tbody,\n\t\t);\n\t\tif (responseData.first_row) {\n\t\t\treturn this.helpers.returnJsonArray(responseData.first_row as IDataObject[]);\n\t\t}\n\t\treturn this.helpers.returnJsonArray(responseData as IDataObject[]);\n\t}\n}\n"],"mappings":"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","names":[]}