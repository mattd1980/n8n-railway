{"version":3,"sources":["../../../nodes/Brevo/BrevoTrigger.node.ts"],"sourcesContent":["/* eslint-disable n8n-nodes-base/node-filename-against-convention */\nimport {\n\tNodeConnectionTypes,\n\ttype IHookFunctions,\n\ttype INodeType,\n\ttype INodeTypeDescription,\n\ttype IWebhookFunctions,\n\ttype IWebhookResponseData,\n} from 'n8n-workflow';\n\nimport { BrevoWebhookApi } from './GenericFunctions';\n\nexport class BrevoTrigger implements INodeType {\n\tdescription: INodeTypeDescription = {\n\t\tcredentials: [\n\t\t\t{\n\t\t\t\tname: 'sendInBlueApi',\n\t\t\t\trequired: true,\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {},\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\tdisplayName: 'Brevo Trigger',\n\t\tdefaults: {\n\t\t\tname: 'Brevo Trigger',\n\t\t},\n\t\tdescription: 'Starts the workflow when Brevo events occur',\n\t\tgroup: ['trigger'],\n\t\ticon: 'file:brevo.svg',\n\t\tinputs: [],\n\t\t// keep sendinblue name for backward compatibility\n\t\tname: 'sendInBlueTrigger',\n\t\toutputs: [NodeConnectionTypes.Main],\n\t\tversion: 1,\n\t\twebhooks: [\n\t\t\t{\n\t\t\t\tname: 'default',\n\t\t\t\thttpMethod: 'POST',\n\t\t\t\tresponseMode: 'onReceived',\n\t\t\t\tpath: 'webhooks',\n\t\t\t},\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tdisplayName: 'Resource',\n\t\t\t\tdefault: 'transactional',\n\t\t\t\tname: 'type',\n\t\t\t\toptions: [\n\t\t\t\t\t{ name: 'Inbound', value: 'inbound' },\n\t\t\t\t\t{ name: 'Marketing', value: 'marketing' },\n\t\t\t\t\t{ name: 'Transactional', value: 'transactional' },\n\t\t\t\t],\n\t\t\t\trequired: true,\n\t\t\t\ttype: 'options',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Trigger On',\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\ttype: ['transactional'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tname: 'events',\n\t\t\t\tplaceholder: 'Add Event',\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Email Blocked',\n\t\t\t\t\t\tvalue: 'blocked',\n\t\t\t\t\t\tdescription: 'Triggers when transactional email is blocked',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Email Clicked',\n\t\t\t\t\t\tvalue: 'click',\n\t\t\t\t\t\tdescription: 'Triggers when transactional email is clicked',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Email Deferred',\n\t\t\t\t\t\tvalue: 'deferred',\n\t\t\t\t\t\tdescription: 'Triggers when transactional email is deferred',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Email Delivered',\n\t\t\t\t\t\tvalue: 'delivered',\n\t\t\t\t\t\tdescription: 'Triggers when transactional email is delivered',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Email Hard Bounce',\n\t\t\t\t\t\tvalue: 'hardBounce',\n\t\t\t\t\t\tdescription: 'Triggers when transactional email is hard bounced',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Email Invalid',\n\t\t\t\t\t\tvalue: 'invalid',\n\t\t\t\t\t\tdescription: 'Triggers when transactional email is invalid',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Email Marked Spam',\n\t\t\t\t\t\tvalue: 'spam',\n\t\t\t\t\t\tdescription: 'Triggers when transactional email is set to spam',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Email Opened',\n\t\t\t\t\t\tvalue: 'opened',\n\t\t\t\t\t\tdescription: 'Triggers when transactional email is opened',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Email Sent',\n\t\t\t\t\t\tvalue: 'request',\n\t\t\t\t\t\tdescription: 'Triggers when transactional email is sent',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Email Soft-Bounce',\n\t\t\t\t\t\tvalue: 'softBounce',\n\t\t\t\t\t\tdescription: 'Triggers when transactional email is soft bounced',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Email Unique Open',\n\t\t\t\t\t\tvalue: 'uniqueOpened',\n\t\t\t\t\t\tdescription: 'Triggers when transactional email is unique opened',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Email Unsubscribed',\n\t\t\t\t\t\tvalue: 'unsubscribed',\n\t\t\t\t\t\tdescription: 'Triggers when transactional email is unsubscribed',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdefault: [],\n\t\t\t\trequired: true,\n\t\t\t\ttype: 'multiOptions',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Trigger On',\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\ttype: ['marketing'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tname: 'events',\n\t\t\t\tplaceholder: 'Add Event',\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Marketing Email Clicked',\n\t\t\t\t\t\tvalue: 'click',\n\t\t\t\t\t\tdescription: 'Triggers when marketing email is clicked',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Marketing Email Delivered',\n\t\t\t\t\t\tvalue: 'delivered',\n\t\t\t\t\t\tdescription: 'Triggers when marketing email is delivered',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Marketing Email Hard Bounce',\n\t\t\t\t\t\tvalue: 'hardBounce',\n\t\t\t\t\t\tdescription: 'Triggers when marketing email is hard bounced',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Marketing Email List Addition',\n\t\t\t\t\t\tvalue: 'listAddition',\n\t\t\t\t\t\tdescription: 'Triggers when marketing email is clicked',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Marketing Email Opened',\n\t\t\t\t\t\tvalue: 'opened',\n\t\t\t\t\t\tdescription: 'Triggers when marketing email is opened',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Marketing Email Soft Bounce',\n\t\t\t\t\t\tvalue: 'softBounce',\n\t\t\t\t\t\tdescription: 'Triggers when marketing email is soft bounced',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Marketing Email Spam',\n\t\t\t\t\t\tvalue: 'spam',\n\t\t\t\t\t\tdescription: 'Triggers when marketing email is spam',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Marketing Email Unsubscribed',\n\t\t\t\t\t\tvalue: 'unsubscribed',\n\t\t\t\t\t\tdescription: 'Triggers when marketing email is unsubscribed',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdefault: [],\n\t\t\t\trequired: true,\n\t\t\t\ttype: 'multiOptions',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Trigger On',\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\ttype: ['inbound'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tname: 'events',\n\t\t\t\tplaceholder: 'Add Event',\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Inbound Email Processed',\n\t\t\t\t\t\tvalue: 'inboundEmailProcessed',\n\t\t\t\t\t\tdescription: 'Triggers when inbound email is processed',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdefault: [],\n\t\t\t\trequired: true,\n\t\t\t\ttype: 'multiOptions',\n\t\t\t},\n\t\t],\n\t};\n\n\twebhookMethods = {\n\t\tdefault: {\n\t\t\tasync checkExists(this: IHookFunctions): Promise<boolean> {\n\t\t\t\tconst webhookData = this.getWorkflowStaticData('node');\n\n\t\t\t\tconst webhookUrl = this.getNodeWebhookUrl('default') as string;\n\n\t\t\t\tconst type = this.getNodeParameter('type') as string;\n\n\t\t\t\tconst events = this.getNodeParameter('events') as string[];\n\n\t\t\t\ttry {\n\t\t\t\t\tconst { webhooks } = await BrevoWebhookApi.fetchWebhooks(this, type);\n\n\t\t\t\t\tfor (const webhook of webhooks) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\twebhook.type === type &&\n\t\t\t\t\t\t\twebhook.events.every((event) => events.includes(event)) &&\n\t\t\t\t\t\t\twebhookUrl === webhook.url\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\twebhookData.webhookId = webhook.id;\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// If it did not error then the webhook exists\n\t\t\t\t\treturn false;\n\t\t\t\t} catch (err) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync create(this: IHookFunctions): Promise<boolean> {\n\t\t\t\tconst webhookData = this.getWorkflowStaticData('node');\n\n\t\t\t\tconst webhookUrl = this.getNodeWebhookUrl('default') as string;\n\n\t\t\t\tconst type = this.getNodeParameter('type') as string;\n\n\t\t\t\tconst events = this.getNodeParameter('events') as string[];\n\n\t\t\t\tconst responseData = await BrevoWebhookApi.createWebHook(this, type, events, webhookUrl);\n\n\t\t\t\tif (responseData?.id === undefined) {\n\t\t\t\t\t// Required data is missing so was not successful\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\twebhookData.webhookId = responseData.id;\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tasync delete(this: IHookFunctions): Promise<boolean> {\n\t\t\t\tconst webhookData = this.getWorkflowStaticData('node');\n\n\t\t\t\tif (webhookData.webhookId !== undefined) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait BrevoWebhookApi.deleteWebhook(this, webhookData.webhookId as string);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove from the static workflow data so that it is clear\n\t\t\t\t\t// that no webhooks are registered anymore\n\t\t\t\t\tdelete webhookData.webhookId;\n\t\t\t\t\tdelete webhookData.webhookEvents;\n\t\t\t\t\tdelete webhookData.hookSecret;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t},\n\t};\n\n\tasync webhook(this: IWebhookFunctions): Promise<IWebhookResponseData> {\n\t\t// The data to return and so start the workflow with\n\t\tconst bodyData = this.getBodyData();\n\n\t\treturn {\n\t\t\tworkflowData: [this.helpers.returnJsonArray(bodyData)],\n\t\t};\n\t}\n}\n"],"mappings":"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","names":[]}