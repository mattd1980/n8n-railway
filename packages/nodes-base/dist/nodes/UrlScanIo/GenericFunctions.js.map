{"version":3,"sources":["../../../nodes/UrlScanIo/GenericFunctions.ts"],"sourcesContent":["import type { IExecuteFunctions, IDataObject, IRequestOptions } from 'n8n-workflow';\n\nexport async function urlScanIoApiRequest(\n\tthis: IExecuteFunctions,\n\tmethod: 'GET' | 'POST',\n\tendpoint: string,\n\tbody: IDataObject = {},\n\tqs: IDataObject = {},\n) {\n\tconst options: IRequestOptions = {\n\t\tmethod,\n\t\tbody,\n\t\tqs,\n\t\turi: `https://urlscan.io/api/v1${endpoint}`,\n\t\tjson: true,\n\t};\n\n\tif (!Object.keys(body).length) {\n\t\tdelete options.body;\n\t}\n\n\tif (!Object.keys(qs).length) {\n\t\tdelete options.qs;\n\t}\n\n\treturn await this.helpers.requestWithAuthentication.call(this, 'urlScanIoApi', options);\n}\n\nexport async function handleListing(\n\tthis: IExecuteFunctions,\n\tendpoint: string,\n\tqs: IDataObject = {},\n): Promise<IDataObject[]> {\n\tconst returnData: IDataObject[] = [];\n\tlet responseData;\n\n\tqs.size = 100;\n\n\tconst returnAll = this.getNodeParameter('returnAll', 0, false);\n\tconst limit = this.getNodeParameter('limit', 0, 0);\n\n\tdo {\n\t\tresponseData = await urlScanIoApiRequest.call(this, 'GET', endpoint, {}, qs);\n\t\treturnData.push(...(responseData.results as IDataObject[]));\n\n\t\tif (!returnAll && returnData.length > limit) {\n\t\t\treturn returnData.slice(0, limit);\n\t\t}\n\n\t\tif (responseData.results.length) {\n\t\t\tconst lastResult = responseData.results[responseData.results.length - 1];\n\t\t\tqs.search_after = lastResult.sort;\n\t\t}\n\t} while (responseData.total > returnData.length);\n\n\treturn returnData;\n}\n\nexport const normalizeId = ({ _id, uuid, ...rest }: IDataObject) => {\n\tif (_id) return { scanId: _id, ...rest };\n\tif (uuid) return { scanId: uuid, ...rest };\n\treturn rest;\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,eAAsB,oBAErB,QACA,UACA,OAAoB,CAAC,GACrB,KAAkB,CAAC,GAClB;AACD,QAAM,UAA2B;AAAA,IAChC;AAAA,IACA;AAAA,IACA;AAAA,IACA,KAAK,4BAA4B,QAAQ;AAAA,IACzC,MAAM;AAAA,EACP;AAEA,MAAI,CAAC,OAAO,KAAK,IAAI,EAAE,QAAQ;AAC9B,WAAO,QAAQ;AAAA,EAChB;AAEA,MAAI,CAAC,OAAO,KAAK,EAAE,EAAE,QAAQ;AAC5B,WAAO,QAAQ;AAAA,EAChB;AAEA,SAAO,MAAM,KAAK,QAAQ,0BAA0B,KAAK,MAAM,gBAAgB,OAAO;AACvF;AAEA,eAAsB,cAErB,UACA,KAAkB,CAAC,GACM;AACzB,QAAM,aAA4B,CAAC;AACnC,MAAI;AAEJ,KAAG,OAAO;AAEV,QAAM,YAAY,KAAK,iBAAiB,aAAa,GAAG,KAAK;AAC7D,QAAM,QAAQ,KAAK,iBAAiB,SAAS,GAAG,CAAC;AAEjD,KAAG;AACF,mBAAe,MAAM,oBAAoB,KAAK,MAAM,OAAO,UAAU,CAAC,GAAG,EAAE;AAC3E,eAAW,KAAK,GAAI,aAAa,OAAyB;AAE1D,QAAI,CAAC,aAAa,WAAW,SAAS,OAAO;AAC5C,aAAO,WAAW,MAAM,GAAG,KAAK;AAAA,IACjC;AAEA,QAAI,aAAa,QAAQ,QAAQ;AAChC,YAAM,aAAa,aAAa,QAAQ,aAAa,QAAQ,SAAS,CAAC;AACvE,SAAG,eAAe,WAAW;AAAA,IAC9B;AAAA,EACD,SAAS,aAAa,QAAQ,WAAW;AAEzC,SAAO;AACR;AAEO,MAAM,cAAc,CAAC,EAAE,KAAK,MAAM,GAAG,KAAK,MAAmB;AACnE,MAAI,IAAK,QAAO,EAAE,QAAQ,KAAK,GAAG,KAAK;AACvC,MAAI,KAAM,QAAO,EAAE,QAAQ,MAAM,GAAG,KAAK;AACzC,SAAO;AACR;","names":[]}