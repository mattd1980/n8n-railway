{"version":3,"sources":["../../../../../../../nodes/Microsoft/Outlook/v2/actions/message/reply.operation.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tINodeExecutionData,\n\tINodeProperties,\n} from 'n8n-workflow';\nimport { NodeOperationError } from 'n8n-workflow';\n\nimport { updateDisplayOptions } from '@utils/utilities';\n\nimport { messageRLC } from '../../descriptions';\nimport { createMessage } from '../../helpers/utils';\nimport { microsoftApiRequest } from '../../transport';\n\nexport const properties: INodeProperties[] = [\n\tmessageRLC,\n\t{\n\t\tdisplayName: 'Reply to Sender Only',\n\t\tname: 'replyToSenderOnly',\n\t\ttype: 'boolean',\n\t\tdefault: false,\n\t\tdescription: 'Whether to reply to the sender only or to the entire list of recipients',\n\t},\n\t{\n\t\tdisplayName: 'Message',\n\t\tname: 'message',\n\t\t// name: 'bodyContent',\n\t\tdescription: 'Message body content',\n\t\ttype: 'string',\n\t\ttypeOptions: {\n\t\t\trows: 2,\n\t\t},\n\t\tdefault: '',\n\t},\n\t{\n\t\tdisplayName: 'Additional Fields',\n\t\tname: 'additionalFields',\n\t\ttype: 'collection',\n\t\tplaceholder: 'Add Field',\n\t\tdefault: {},\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\treplyToSenderOnly: [true],\n\t\t\t},\n\t\t},\n\t\toptions: [\n\t\t\t{\n\t\t\t\tdisplayName: 'Attachments',\n\t\t\t\tname: 'attachments',\n\t\t\t\ttype: 'fixedCollection',\n\t\t\t\tplaceholder: 'Add Attachment',\n\t\t\t\tdefault: {},\n\t\t\t\ttypeOptions: {\n\t\t\t\t\tmultipleValues: true,\n\t\t\t\t},\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'attachments',\n\t\t\t\t\t\tdisplayName: 'Attachment',\n\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdisplayName: 'Input Data Field Name',\n\t\t\t\t\t\t\t\tname: 'binaryPropertyName',\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t\t\t\tplaceholder: 'e.g. data',\n\t\t\t\t\t\t\t\thint: 'The name of the input field containing the binary file data to be attached',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'BCC Recipients',\n\t\t\t\tname: 'bccRecipients',\n\t\t\t\tdescription: 'Comma-separated list of email addresses of BCC recipients',\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: '',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'CC Recipients',\n\t\t\t\tname: 'ccRecipients',\n\t\t\t\tdescription: 'Comma-separated list of email addresses of CC recipients',\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: '',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Custom Headers',\n\t\t\t\tname: 'internetMessageHeaders',\n\t\t\t\tplaceholder: 'Add Header',\n\t\t\t\ttype: 'fixedCollection',\n\t\t\t\ttypeOptions: {\n\t\t\t\t\tmultipleValues: true,\n\t\t\t\t},\n\t\t\t\tdefault: {},\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'headers',\n\t\t\t\t\t\tdisplayName: 'Header',\n\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdisplayName: 'Name',\n\t\t\t\t\t\t\t\tname: 'name',\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t\t\t\tdescription: 'Name of the header',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdisplayName: 'Value',\n\t\t\t\t\t\t\t\tname: 'value',\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t\t\t\tdescription: 'Value to set for the header',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'From',\n\t\t\t\tname: 'from',\n\t\t\t\tdescription:\n\t\t\t\t\t'The owner of the mailbox from which the message is sent. Must correspond to the actual mailbox used.',\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: '',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Importance',\n\t\t\t\tname: 'importance',\n\t\t\t\tdescription: 'The importance of the message',\n\t\t\t\ttype: 'options',\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Low',\n\t\t\t\t\t\tvalue: 'Low',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Normal',\n\t\t\t\t\t\tvalue: 'Normal',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'High',\n\t\t\t\t\t\tvalue: 'High',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdefault: 'Normal',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Message Type',\n\t\t\t\tname: 'bodyContentType',\n\t\t\t\tdescription: 'Message body content type',\n\t\t\t\ttype: 'options',\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'HTML',\n\t\t\t\t\t\tvalue: 'html',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Text',\n\t\t\t\t\t\tvalue: 'Text',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdefault: 'html',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Read Receipt Requested',\n\t\t\t\tname: 'isReadReceiptRequested',\n\t\t\t\tdescription: 'Whether a read receipt is requested for the message',\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdefault: false,\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'To',\n\t\t\t\tname: 'toRecipients',\n\t\t\t\tdescription: 'Comma-separated list of email addresses of recipients',\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: '',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Reply To',\n\t\t\t\tname: 'replyTo',\n\t\t\t\tdescription: 'Email address to use when replying',\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: '',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Subject',\n\t\t\t\tname: 'subject',\n\t\t\t\tdescription: 'The subject of the message',\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: '',\n\t\t\t},\n\t\t],\n\t},\n\t{\n\t\tdisplayName: 'Options',\n\t\tname: 'options',\n\t\ttype: 'collection',\n\t\tplaceholder: 'Add Field',\n\t\tdefault: {},\n\t\toptions: [\n\t\t\t{\n\t\t\t\tdisplayName: 'Save as Draft',\n\t\t\t\tname: 'saveAsDraft',\n\t\t\t\tdescription:\n\t\t\t\t\t'Whether to save the message as a draft. If false, the message is sent immediately.',\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdefault: false,\n\t\t\t},\n\t\t],\n\t},\n];\n\nconst displayOptions = {\n\tshow: {\n\t\tresource: ['message'],\n\t\toperation: ['reply'],\n\t},\n};\n\nexport const description = updateDisplayOptions(displayOptions, properties);\n\nexport async function execute(this: IExecuteFunctions, index: number, items: INodeExecutionData[]) {\n\tconst messageId = this.getNodeParameter('messageId', index, undefined, {\n\t\textractValue: true,\n\t}) as string;\n\tconst replyToSenderOnly = this.getNodeParameter('replyToSenderOnly', index, false) as string;\n\tconst message = this.getNodeParameter('message', index) as string;\n\tconst saveAsDraft = this.getNodeParameter('options.saveAsDraft', index, false) as boolean;\n\tconst additionalFields = this.getNodeParameter('additionalFields', index, {});\n\n\tconst body: IDataObject = {};\n\n\tlet action = 'createReply';\n\n\tif (!replyToSenderOnly) {\n\t\tbody.comment = message;\n\t\taction = 'createReplyAll';\n\t} else {\n\t\t// body.comment = comment;\n\t\tbody.message = {} as IDataObject;\n\t\tadditionalFields.bodyContent = message;\n\t\tObject.assign(body.message, createMessage(additionalFields));\n\n\t\tdelete (body.message as IDataObject).attachments;\n\t}\n\n\tconst responseData = await microsoftApiRequest.call(\n\t\tthis,\n\t\t'POST',\n\t\t`/messages/${messageId}/${action}`,\n\t\tbody,\n\t);\n\n\tif (additionalFields.attachments) {\n\t\tconst attachments = (additionalFields.attachments as IDataObject).attachments as IDataObject[];\n\t\t// // Handle attachments\n\t\tconst data: IDataObject[] = [];\n\n\t\tfor (const attachment of attachments) {\n\t\t\tconst binaryPropertyName = attachment.binaryPropertyName as string;\n\n\t\t\tif (items[index].binary === undefined) {\n\t\t\t\tthrow new NodeOperationError(this.getNode(), 'No binary data exists on item!', {\n\t\t\t\t\titemIndex: index,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\titems[index].binary &&\n\t\t\t\t(items[index].binary as IDataObject)[binaryPropertyName] === undefined\n\t\t\t) {\n\t\t\t\tthrow new NodeOperationError(\n\t\t\t\t\tthis.getNode(),\n\t\t\t\t\t`No binary data property \"${binaryPropertyName}\" does not exists on item!`,\n\t\t\t\t\t{ itemIndex: index },\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst binaryData = this.helpers.assertBinaryData(index, binaryPropertyName);\n\n\t\t\tlet fileBase64;\n\t\t\tif (binaryData.id) {\n\t\t\t\tconst chunkSize = 256 * 1024;\n\t\t\t\tconst stream = await this.helpers.getBinaryStream(binaryData.id, chunkSize);\n\t\t\t\tconst buffer = await this.helpers.binaryToBuffer(stream);\n\t\t\t\tfileBase64 = buffer.toString('base64');\n\t\t\t} else {\n\t\t\t\tfileBase64 = binaryData.data;\n\t\t\t}\n\n\t\t\tdata.push({\n\t\t\t\t'@odata.type': '#microsoft.graph.fileAttachment',\n\t\t\t\tname: binaryData.fileName,\n\t\t\t\tcontentBytes: fileBase64,\n\t\t\t});\n\t\t}\n\n\t\tfor (const attachment of data) {\n\t\t\tawait microsoftApiRequest.call(\n\t\t\t\tthis,\n\t\t\t\t'POST',\n\t\t\t\t`/messages/${responseData.id}/attachments`,\n\t\t\t\tattachment,\n\t\t\t\t{},\n\t\t\t);\n\t\t}\n\t}\n\n\tif (!saveAsDraft) {\n\t\tawait microsoftApiRequest.call(this, 'POST', `/messages/${responseData.id}/send`);\n\t}\n\n\tconst executionData = this.helpers.constructExecutionMetaData(\n\t\tthis.helpers.returnJsonArray(responseData as IDataObject),\n\t\t{ itemData: { item: index } },\n\t);\n\n\treturn executionData;\n}\n"],"mappings":"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","names":[]}