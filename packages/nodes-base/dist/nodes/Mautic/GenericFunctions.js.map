{"version":3,"sources":["../../../nodes/Mautic/GenericFunctions.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tIHookFunctions,\n\tIHttpRequestMethods,\n\tILoadOptionsFunctions,\n\tIRequestOptions,\n\tJsonObject,\n} from 'n8n-workflow';\nimport { NodeApiError } from 'n8n-workflow';\n\nexport async function mauticApiRequest(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions,\n\tmethod: IHttpRequestMethods,\n\tendpoint: string,\n\n\tbody: any = {},\n\tquery?: IDataObject,\n\turi?: string,\n): Promise<any> {\n\tconst authenticationMethod = this.getNodeParameter('authentication', 0, 'credentials') as string;\n\n\tconst options: IRequestOptions = {\n\t\theaders: {},\n\t\tmethod,\n\t\tqs: query,\n\t\turi: uri || `/api${endpoint}`,\n\t\tbody,\n\t\tjson: true,\n\t};\n\n\ttry {\n\t\tlet returnData;\n\n\t\tif (authenticationMethod === 'credentials') {\n\t\t\tconst credentials = await this.getCredentials('mauticApi');\n\t\t\tconst baseUrl = credentials.url as string;\n\n\t\t\toptions.uri = `${baseUrl.endsWith('/') ? baseUrl.slice(0, -1) : baseUrl}${options.uri}`;\n\t\t\treturnData = await this.helpers.requestWithAuthentication.call(this, 'mauticApi', options);\n\t\t} else {\n\t\t\tconst credentials = await this.getCredentials('mauticOAuth2Api');\n\t\t\tconst baseUrl = credentials.url as string;\n\n\t\t\toptions.uri = `${baseUrl.endsWith('/') ? baseUrl.slice(0, -1) : baseUrl}${options.uri}`;\n\t\t\treturnData = await this.helpers.requestOAuth2.call(this, 'mauticOAuth2Api', options, {\n\t\t\t\tincludeCredentialsOnRefreshOnBody: true,\n\t\t\t});\n\t\t}\n\n\t\tif (returnData.errors) {\n\t\t\t// They seem to sometimes return 200 status but still error.\n\t\t\tthrow new NodeApiError(this.getNode(), returnData as JsonObject);\n\t\t}\n\n\t\treturn returnData;\n\t} catch (error) {\n\t\tthrow new NodeApiError(this.getNode(), error as JsonObject);\n\t}\n}\n\n/**\n * Make an API request to paginated mautic endpoint\n * and return all results\n */\nexport async function mauticApiRequestAllItems(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions,\n\tpropertyName: string,\n\tmethod: IHttpRequestMethods,\n\tendpoint: string,\n\n\tbody: any = {},\n\tquery: IDataObject = {},\n): Promise<any> {\n\tconst returnData: IDataObject[] = [];\n\n\tlet responseData;\n\tquery.limit = 30;\n\tquery.start = 0;\n\n\tdo {\n\t\tresponseData = await mauticApiRequest.call(this, method, endpoint, body, query);\n\t\tconst values = Object.values(responseData[propertyName] as IDataObject[]);\n\t\treturnData.push.apply(returnData, values);\n\t\tquery.start += query.limit;\n\t} while (\n\t\tresponseData.total !== undefined &&\n\t\treturnData.length - parseInt(responseData.total as string, 10) < 0\n\t);\n\n\treturn returnData;\n}\n\nexport function validateJSON(json: string | undefined): any {\n\tlet result;\n\ttry {\n\t\tresult = JSON.parse(json!);\n\t} catch (exception) {\n\t\tresult = undefined;\n\t}\n\treturn result;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA,0BAA6B;AAE7B,eAAsB,iBAErB,QACA,UAEA,OAAY,CAAC,GACb,OACA,KACe;AACf,QAAM,uBAAuB,KAAK,iBAAiB,kBAAkB,GAAG,aAAa;AAErF,QAAM,UAA2B;AAAA,IAChC,SAAS,CAAC;AAAA,IACV;AAAA,IACA,IAAI;AAAA,IACJ,KAAK,OAAO,OAAO,QAAQ;AAAA,IAC3B;AAAA,IACA,MAAM;AAAA,EACP;AAEA,MAAI;AACH,QAAI;AAEJ,QAAI,yBAAyB,eAAe;AAC3C,YAAM,cAAc,MAAM,KAAK,eAAe,WAAW;AACzD,YAAM,UAAU,YAAY;AAE5B,cAAQ,MAAM,GAAG,QAAQ,SAAS,GAAG,IAAI,QAAQ,MAAM,GAAG,EAAE,IAAI,OAAO,GAAG,QAAQ,GAAG;AACrF,mBAAa,MAAM,KAAK,QAAQ,0BAA0B,KAAK,MAAM,aAAa,OAAO;AAAA,IAC1F,OAAO;AACN,YAAM,cAAc,MAAM,KAAK,eAAe,iBAAiB;AAC/D,YAAM,UAAU,YAAY;AAE5B,cAAQ,MAAM,GAAG,QAAQ,SAAS,GAAG,IAAI,QAAQ,MAAM,GAAG,EAAE,IAAI,OAAO,GAAG,QAAQ,GAAG;AACrF,mBAAa,MAAM,KAAK,QAAQ,cAAc,KAAK,MAAM,mBAAmB,SAAS;AAAA,QACpF,mCAAmC;AAAA,MACpC,CAAC;AAAA,IACF;AAEA,QAAI,WAAW,QAAQ;AAEtB,YAAM,IAAI,iCAAa,KAAK,QAAQ,GAAG,UAAwB;AAAA,IAChE;AAEA,WAAO;AAAA,EACR,SAAS,OAAO;AACf,UAAM,IAAI,iCAAa,KAAK,QAAQ,GAAG,KAAmB;AAAA,EAC3D;AACD;AAMA,eAAsB,yBAErB,cACA,QACA,UAEA,OAAY,CAAC,GACb,QAAqB,CAAC,GACP;AACf,QAAM,aAA4B,CAAC;AAEnC,MAAI;AACJ,QAAM,QAAQ;AACd,QAAM,QAAQ;AAEd,KAAG;AACF,mBAAe,MAAM,iBAAiB,KAAK,MAAM,QAAQ,UAAU,MAAM,KAAK;AAC9E,UAAM,SAAS,OAAO,OAAO,aAAa,YAAY,CAAkB;AACxE,eAAW,KAAK,MAAM,YAAY,MAAM;AACxC,UAAM,SAAS,MAAM;AAAA,EACtB,SACC,aAAa,UAAU,UACvB,WAAW,SAAS,SAAS,aAAa,OAAiB,EAAE,IAAI;AAGlE,SAAO;AACR;AAEO,SAAS,aAAa,MAA+B;AAC3D,MAAI;AACJ,MAAI;AACH,aAAS,KAAK,MAAM,IAAK;AAAA,EAC1B,SAAS,WAAW;AACnB,aAAS;AAAA,EACV;AACA,SAAO;AACR;","names":[]}