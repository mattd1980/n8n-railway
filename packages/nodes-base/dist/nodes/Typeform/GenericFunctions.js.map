{"version":3,"sources":["../../../nodes/Typeform/GenericFunctions.ts"],"sourcesContent":["import type {\n\tIExecuteFunctions,\n\tIHookFunctions,\n\tILoadOptionsFunctions,\n\tIDataObject,\n\tINodePropertyOptions,\n\tJsonObject,\n\tIRequestOptions,\n\tIHttpRequestMethods,\n} from 'n8n-workflow';\nimport { NodeApiError, NodeOperationError } from 'n8n-workflow';\n\n// Interface in Typeform\nexport interface ITypeformDefinition {\n\tfields: ITypeformDefinitionField[];\n}\n\nexport interface ITypeformDefinitionField {\n\tid: string;\n\ttitle: string;\n}\n\nexport interface ITypeformAnswer {\n\tfield: ITypeformAnswerField;\n\ttype: string;\n\t[key: string]: string | ITypeformAnswerField | object;\n}\n\nexport interface ITypeformAnswerField {\n\tid: string;\n\ttype: string;\n\tref: string;\n\t[key: string]: string | object;\n}\n\n/**\n * Make an API request to Typeform\n *\n */\nexport async function apiRequest(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions,\n\tmethod: IHttpRequestMethods,\n\tendpoint: string,\n\tbody: object,\n\tquery?: IDataObject,\n): Promise<any> {\n\tconst authenticationMethod = this.getNodeParameter('authentication', 0);\n\n\tconst options: IRequestOptions = {\n\t\theaders: {},\n\t\tmethod,\n\t\tbody,\n\t\tqs: query,\n\t\turi: `https://api.typeform.com/${endpoint}`,\n\t\tjson: true,\n\t};\n\n\tquery = query || {};\n\n\ttry {\n\t\tif (authenticationMethod === 'accessToken') {\n\t\t\treturn await this.helpers.requestWithAuthentication.call(this, 'typeformApi', options);\n\t\t} else {\n\t\t\treturn await this.helpers.requestOAuth2.call(this, 'typeformOAuth2Api', options);\n\t\t}\n\t} catch (error) {\n\t\tthrow new NodeApiError(this.getNode(), error as JsonObject);\n\t}\n}\n\n/**\n * Make an API request to paginated Typeform endpoint\n * and return all results\n *\n * @param {(IHookFunctions | IExecuteFunctions)} this\n */\nexport async function apiRequestAllItems(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions,\n\tmethod: IHttpRequestMethods,\n\tendpoint: string,\n\tbody: IDataObject,\n\tquery?: IDataObject,\n\t_dataKey?: string,\n): Promise<any> {\n\tif (query === undefined) {\n\t\tquery = {};\n\t}\n\n\tquery.page_size = 200;\n\tquery.page = 0;\n\n\tconst returnData = {\n\t\titems: [] as IDataObject[],\n\t};\n\n\tlet responseData;\n\n\tdo {\n\t\tquery.page += 1;\n\n\t\tresponseData = await apiRequest.call(this, method, endpoint, body, query);\n\n\t\treturnData.items.push.apply(returnData.items, responseData.items as IDataObject[]);\n\t} while (responseData.page_count !== undefined && responseData.page_count > query.page);\n\n\treturn returnData;\n}\n\n/**\n * Returns all the available forms\n *\n */\nexport async function getForms(this: ILoadOptionsFunctions): Promise<INodePropertyOptions[]> {\n\tconst endpoint = 'forms';\n\tconst responseData = await apiRequestAllItems.call(this, 'GET', endpoint, {});\n\n\tif (responseData.items === undefined) {\n\t\tthrow new NodeOperationError(this.getNode(), 'No data got returned');\n\t}\n\n\tconst returnData: INodePropertyOptions[] = [];\n\tfor (const baseData of responseData.items) {\n\t\treturnData.push({\n\t\t\tname: baseData.title,\n\t\t\tvalue: baseData.id,\n\t\t});\n\t}\n\n\treturn returnData;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA,0BAAiD;AA6BjD,eAAsB,WAErB,QACA,UACA,MACA,OACe;AACf,QAAM,uBAAuB,KAAK,iBAAiB,kBAAkB,CAAC;AAEtE,QAAM,UAA2B;AAAA,IAChC,SAAS,CAAC;AAAA,IACV;AAAA,IACA;AAAA,IACA,IAAI;AAAA,IACJ,KAAK,4BAA4B,QAAQ;AAAA,IACzC,MAAM;AAAA,EACP;AAEA,UAAQ,SAAS,CAAC;AAElB,MAAI;AACH,QAAI,yBAAyB,eAAe;AAC3C,aAAO,MAAM,KAAK,QAAQ,0BAA0B,KAAK,MAAM,eAAe,OAAO;AAAA,IACtF,OAAO;AACN,aAAO,MAAM,KAAK,QAAQ,cAAc,KAAK,MAAM,qBAAqB,OAAO;AAAA,IAChF;AAAA,EACD,SAAS,OAAO;AACf,UAAM,IAAI,iCAAa,KAAK,QAAQ,GAAG,KAAmB;AAAA,EAC3D;AACD;AAQA,eAAsB,mBAErB,QACA,UACA,MACA,OACA,UACe;AACf,MAAI,UAAU,QAAW;AACxB,YAAQ,CAAC;AAAA,EACV;AAEA,QAAM,YAAY;AAClB,QAAM,OAAO;AAEb,QAAM,aAAa;AAAA,IAClB,OAAO,CAAC;AAAA,EACT;AAEA,MAAI;AAEJ,KAAG;AACF,UAAM,QAAQ;AAEd,mBAAe,MAAM,WAAW,KAAK,MAAM,QAAQ,UAAU,MAAM,KAAK;AAExE,eAAW,MAAM,KAAK,MAAM,WAAW,OAAO,aAAa,KAAsB;AAAA,EAClF,SAAS,aAAa,eAAe,UAAa,aAAa,aAAa,MAAM;AAElF,SAAO;AACR;AAMA,eAAsB,WAAuE;AAC5F,QAAM,WAAW;AACjB,QAAM,eAAe,MAAM,mBAAmB,KAAK,MAAM,OAAO,UAAU,CAAC,CAAC;AAE5E,MAAI,aAAa,UAAU,QAAW;AACrC,UAAM,IAAI,uCAAmB,KAAK,QAAQ,GAAG,sBAAsB;AAAA,EACpE;AAEA,QAAM,aAAqC,CAAC;AAC5C,aAAW,YAAY,aAAa,OAAO;AAC1C,eAAW,KAAK;AAAA,MACf,MAAM,SAAS;AAAA,MACf,OAAO,SAAS;AAAA,IACjB,CAAC;AAAA,EACF;AAEA,SAAO;AACR;","names":[]}