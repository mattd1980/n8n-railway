{"version":3,"sources":["../../../nodes/WhatsApp/MediaFunctions.ts"],"sourcesContent":["import FormData from 'form-data';\nimport type { IDataObject, IExecuteSingleFunctions, IHttpRequestOptions } from 'n8n-workflow';\nimport { NodeOperationError } from 'n8n-workflow';\n\nexport async function getUploadFormData(\n\tthis: IExecuteSingleFunctions,\n): Promise<{ fileName: string; formData: FormData }> {\n\tconst mediaPropertyName = ((this.getNodeParameter('mediaPropertyName') as string) || '').trim();\n\tif (!mediaPropertyName)\n\t\tthrow new NodeOperationError(this.getNode(), 'Parameter \"mediaPropertyName\" is not defined');\n\n\tconst binaryData = this.helpers.assertBinaryData(mediaPropertyName);\n\n\tconst mediaFileName = (this.getNodeParameter('additionalFields') as IDataObject).mediaFileName as\n\t\t| string\n\t\t| undefined;\n\n\tconst fileName = mediaFileName || binaryData.fileName;\n\tif (!fileName)\n\t\tthrow new NodeOperationError(this.getNode(), 'No file name given for media upload.');\n\n\tconst buffer = await this.helpers.getBinaryDataBuffer(mediaPropertyName);\n\n\tconst formData = new FormData();\n\tformData.append('file', buffer, { contentType: binaryData.mimeType, filename: fileName });\n\tformData.append('messaging_product', 'whatsapp');\n\n\treturn { fileName, formData };\n}\n\nexport async function setupUpload(\n\tthis: IExecuteSingleFunctions,\n\trequestOptions: IHttpRequestOptions,\n) {\n\tconst uploadData = await getUploadFormData.call(this);\n\trequestOptions.body = uploadData.formData;\n\treturn requestOptions;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAAqB;AAErB,0BAAmC;AAEnC,eAAsB,oBAE+B;AACpD,QAAM,qBAAsB,KAAK,iBAAiB,mBAAmB,KAAgB,IAAI,KAAK;AAC9F,MAAI,CAAC;AACJ,UAAM,IAAI,uCAAmB,KAAK,QAAQ,GAAG,8CAA8C;AAE5F,QAAM,aAAa,KAAK,QAAQ,iBAAiB,iBAAiB;AAElE,QAAM,gBAAiB,KAAK,iBAAiB,kBAAkB,EAAkB;AAIjF,QAAM,WAAW,iBAAiB,WAAW;AAC7C,MAAI,CAAC;AACJ,UAAM,IAAI,uCAAmB,KAAK,QAAQ,GAAG,sCAAsC;AAEpF,QAAM,SAAS,MAAM,KAAK,QAAQ,oBAAoB,iBAAiB;AAEvE,QAAM,WAAW,IAAI,iBAAAA,QAAS;AAC9B,WAAS,OAAO,QAAQ,QAAQ,EAAE,aAAa,WAAW,UAAU,UAAU,SAAS,CAAC;AACxF,WAAS,OAAO,qBAAqB,UAAU;AAE/C,SAAO,EAAE,UAAU,SAAS;AAC7B;AAEA,eAAsB,YAErB,gBACC;AACD,QAAM,aAAa,MAAM,kBAAkB,KAAK,IAAI;AACpD,iBAAe,OAAO,WAAW;AACjC,SAAO;AACR;","names":["FormData"]}