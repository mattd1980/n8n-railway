{"version":3,"sources":["../../../../../nodes/TheHiveProject/actions/case/addAttachment.operation.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tINodeExecutionData,\n\tINodeProperties,\n} from 'n8n-workflow';\n\nimport { updateDisplayOptions, wrapData } from '@utils/utilities';\n\nimport { attachmentsUi, caseRLC } from '../../descriptions';\nimport { theHiveApiRequest } from '../../transport';\n\nconst properties: INodeProperties[] = [\n\tcaseRLC,\n\tattachmentsUi,\n\t{\n\t\tdisplayName: 'Options',\n\t\tname: 'options',\n\t\ttype: 'collection',\n\t\tplaceholder: 'Add option',\n\t\tdefault: {},\n\t\toptions: [\n\t\t\t{\n\t\t\t\tdisplayName: 'Rename Files',\n\t\t\t\tname: 'canRename',\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdescription: 'Whether to rename the file in case a file with the same name already exists',\n\t\t\t\tdefault: false,\n\t\t\t},\n\t\t],\n\t},\n];\n\nconst displayOptions = {\n\tshow: {\n\t\tresource: ['case'],\n\t\toperation: ['addAttachment'],\n\t},\n};\n\nexport const description = updateDisplayOptions(displayOptions, properties);\n\nexport async function execute(this: IExecuteFunctions, i: number): Promise<INodeExecutionData[]> {\n\tlet responseData: IDataObject | IDataObject[] = [];\n\n\tconst caseId = this.getNodeParameter('caseId', i, '', { extractValue: true }) as string;\n\tconst canRename = this.getNodeParameter('options.canRename', i, false) as boolean;\n\n\tconst inputDataFields = (\n\t\tthis.getNodeParameter('attachmentsUi.values', i, []) as IDataObject[]\n\t).map((entry) => (entry.field as string).trim());\n\n\tconst attachments = [];\n\n\tfor (const inputDataField of inputDataFields) {\n\t\tconst binaryData = this.helpers.assertBinaryData(i, inputDataField);\n\t\tconst dataBuffer = await this.helpers.getBinaryDataBuffer(i, inputDataField);\n\n\t\tattachments.push({\n\t\t\tvalue: dataBuffer,\n\t\t\toptions: {\n\t\t\t\tcontentType: binaryData.mimeType,\n\t\t\t\tfilename: binaryData.fileName,\n\t\t\t},\n\t\t});\n\t}\n\n\tresponseData = await theHiveApiRequest.call(\n\t\tthis,\n\t\t'POST',\n\t\t`/v1/case/${caseId}/attachments`,\n\t\tundefined,\n\t\tundefined,\n\t\tundefined,\n\t\t{\n\t\t\tHeaders: {\n\t\t\t\t'Content-Type': 'multipart/form-data',\n\t\t\t},\n\t\t\tformData: {\n\t\t\t\tattachments,\n\t\t\t\tcanRename: JSON.stringify(canRename),\n\t\t\t},\n\t\t},\n\t);\n\n\tconst executionData = this.helpers.constructExecutionMetaData(wrapData(responseData), {\n\t\titemData: { item: i },\n\t});\n\n\treturn executionData;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA,uBAA+C;AAE/C,0BAAuC;AACvC,uBAAkC;AAElC,MAAM,aAAgC;AAAA,EACrC;AAAA,EACA;AAAA,EACA;AAAA,IACC,aAAa;AAAA,IACb,MAAM;AAAA,IACN,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS,CAAC;AAAA,IACV,SAAS;AAAA,MACR;AAAA,QACC,aAAa;AAAA,QACb,MAAM;AAAA,QACN,MAAM;AAAA,QACN,aAAa;AAAA,QACb,SAAS;AAAA,MACV;AAAA,IACD;AAAA,EACD;AACD;AAEA,MAAM,iBAAiB;AAAA,EACtB,MAAM;AAAA,IACL,UAAU,CAAC,MAAM;AAAA,IACjB,WAAW,CAAC,eAAe;AAAA,EAC5B;AACD;AAEO,MAAM,kBAAc,uCAAqB,gBAAgB,UAAU;AAE1E,eAAsB,QAAiC,GAA0C;AAChG,MAAI,eAA4C,CAAC;AAEjD,QAAM,SAAS,KAAK,iBAAiB,UAAU,GAAG,IAAI,EAAE,cAAc,KAAK,CAAC;AAC5E,QAAM,YAAY,KAAK,iBAAiB,qBAAqB,GAAG,KAAK;AAErE,QAAM,kBACL,KAAK,iBAAiB,wBAAwB,GAAG,CAAC,CAAC,EAClD,IAAI,CAAC,UAAW,MAAM,MAAiB,KAAK,CAAC;AAE/C,QAAM,cAAc,CAAC;AAErB,aAAW,kBAAkB,iBAAiB;AAC7C,UAAM,aAAa,KAAK,QAAQ,iBAAiB,GAAG,cAAc;AAClE,UAAM,aAAa,MAAM,KAAK,QAAQ,oBAAoB,GAAG,cAAc;AAE3E,gBAAY,KAAK;AAAA,MAChB,OAAO;AAAA,MACP,SAAS;AAAA,QACR,aAAa,WAAW;AAAA,QACxB,UAAU,WAAW;AAAA,MACtB;AAAA,IACD,CAAC;AAAA,EACF;AAEA,iBAAe,MAAM,mCAAkB;AAAA,IACtC;AAAA,IACA;AAAA,IACA,YAAY,MAAM;AAAA,IAClB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACC,SAAS;AAAA,QACR,gBAAgB;AAAA,MACjB;AAAA,MACA,UAAU;AAAA,QACT;AAAA,QACA,WAAW,KAAK,UAAU,SAAS;AAAA,MACpC;AAAA,IACD;AAAA,EACD;AAEA,QAAM,gBAAgB,KAAK,QAAQ,+BAA2B,2BAAS,YAAY,GAAG;AAAA,IACrF,UAAU,EAAE,MAAM,EAAE;AAAA,EACrB,CAAC;AAED,SAAO;AACR;","names":[]}