{"version":3,"sources":["../../../../nodes/TheHiveProject/methods/listSearch.ts"],"sourcesContent":["import type { IDataObject, ILoadOptionsFunctions, INodeListSearchResult } from 'n8n-workflow';\n\nimport { theHiveApiRequest } from '../transport';\n\nasync function listResource(\n\tthis: ILoadOptionsFunctions,\n\tresource: string,\n\tfilterField: string,\n\tnameField: string,\n\turlPlaceholder: string | undefined,\n\tfilter?: string,\n\tpaginationToken?: string,\n): Promise<INodeListSearchResult> {\n\tconst query: IDataObject[] = [\n\t\t{\n\t\t\t_name: resource,\n\t\t},\n\t];\n\n\tif (filter) {\n\t\tquery.push({\n\t\t\t_name: 'filter',\n\t\t\t_like: {\n\t\t\t\t_field: filterField,\n\t\t\t\t_value: filter,\n\t\t\t},\n\t\t});\n\t}\n\n\tconst from = paginationToken !== undefined ? parseInt(paginationToken, 10) : 0;\n\tconst to = from + 100;\n\tquery.push({\n\t\t_name: 'page',\n\t\tfrom,\n\t\tto,\n\t});\n\n\tconst response = await theHiveApiRequest.call(this, 'POST', '/v1/query', { query });\n\n\tif (response.length === 0) {\n\t\treturn {\n\t\t\tresults: [],\n\t\t\tpaginationToken: undefined,\n\t\t};\n\t}\n\n\tconst credentials = await this.getCredentials('theHiveProjectApi');\n\tconst url = credentials?.url as string;\n\n\treturn {\n\t\tresults: response.map((entry: IDataObject) => ({\n\t\t\tname: entry[nameField],\n\t\t\tvalue: entry._id,\n\t\t\turl:\n\t\t\t\turlPlaceholder !== undefined ? `${url}/${urlPlaceholder}/${entry._id}/details` : undefined,\n\t\t})),\n\t\tpaginationToken: to,\n\t};\n}\n\nexport async function caseSearch(\n\tthis: ILoadOptionsFunctions,\n\tfilter?: string,\n\tpaginationToken?: string,\n): Promise<INodeListSearchResult> {\n\treturn await listResource.call(\n\t\tthis,\n\t\t'listCase',\n\t\t'title',\n\t\t'title',\n\t\t'cases',\n\t\tfilter,\n\t\tpaginationToken,\n\t);\n}\n\nexport async function commentSearch(\n\tthis: ILoadOptionsFunctions,\n\tfilter?: string,\n\tpaginationToken?: string,\n): Promise<INodeListSearchResult> {\n\treturn await listResource.call(\n\t\tthis,\n\t\t'listComment',\n\t\t'message',\n\t\t'message',\n\t\tundefined,\n\t\tfilter,\n\t\tpaginationToken,\n\t);\n}\n\nexport async function alertSearch(\n\tthis: ILoadOptionsFunctions,\n\tfilter?: string,\n\tpaginationToken?: string,\n): Promise<INodeListSearchResult> {\n\treturn await listResource.call(\n\t\tthis,\n\t\t'listAlert',\n\t\t'title',\n\t\t'title',\n\t\t'alerts',\n\t\tfilter,\n\t\tpaginationToken,\n\t);\n}\n\nexport async function taskSearch(\n\tthis: ILoadOptionsFunctions,\n\tfilter?: string,\n\tpaginationToken?: string,\n): Promise<INodeListSearchResult> {\n\treturn await listResource.call(\n\t\tthis,\n\t\t'listTask',\n\t\t'title',\n\t\t'title',\n\t\tundefined,\n\t\tfilter,\n\t\tpaginationToken,\n\t);\n}\n\nexport async function pageSearch(\n\tthis: ILoadOptionsFunctions,\n\tfilter?: string,\n\tpaginationToken?: string,\n): Promise<INodeListSearchResult> {\n\tlet caseId;\n\n\ttry {\n\t\tcaseId = this.getNodeParameter('caseId', '', { extractValue: true }) as string;\n\t} catch (error) {\n\t\tcaseId = undefined;\n\t}\n\n\tlet query: IDataObject[];\n\n\tif (caseId) {\n\t\tquery = [\n\t\t\t{\n\t\t\t\t_name: 'getCase',\n\t\t\t\tidOrName: caseId,\n\t\t\t},\n\t\t\t{\n\t\t\t\t_name: 'pages',\n\t\t\t},\n\t\t];\n\t} else {\n\t\tquery = [\n\t\t\t{\n\t\t\t\t_name: 'listOrganisationPage',\n\t\t\t},\n\t\t];\n\t}\n\n\tif (filter) {\n\t\tquery.push({\n\t\t\t_name: 'filter',\n\t\t\t_like: {\n\t\t\t\t_field: 'title',\n\t\t\t\t_value: filter,\n\t\t\t},\n\t\t});\n\t}\n\n\tconst from = paginationToken !== undefined ? parseInt(paginationToken, 10) : 0;\n\tconst to = from + 100;\n\tquery.push({\n\t\t_name: 'page',\n\t\tfrom,\n\t\tto,\n\t});\n\n\tconst response = await theHiveApiRequest.call(this, 'POST', '/v1/query', { query });\n\n\tif (response.length === 0) {\n\t\treturn {\n\t\t\tresults: [],\n\t\t\tpaginationToken: undefined,\n\t\t};\n\t}\n\n\treturn {\n\t\tresults: response.map((entry: IDataObject) => ({\n\t\t\tname: entry.title,\n\t\t\tvalue: entry._id,\n\t\t})),\n\t\tpaginationToken: to,\n\t};\n}\n\nexport async function logSearch(\n\tthis: ILoadOptionsFunctions,\n\tfilter?: string,\n\tpaginationToken?: string,\n): Promise<INodeListSearchResult> {\n\treturn await listResource.call(\n\t\tthis,\n\t\t'listLog',\n\t\t'message',\n\t\t'message',\n\t\tundefined,\n\t\tfilter,\n\t\tpaginationToken,\n\t);\n}\n\nexport async function observableSearch(\n\tthis: ILoadOptionsFunctions,\n\tfilter?: string,\n\tpaginationToken?: string,\n): Promise<INodeListSearchResult> {\n\tconst query: IDataObject[] = [\n\t\t{\n\t\t\t_name: 'listObservable',\n\t\t},\n\t];\n\n\tif (filter) {\n\t\tquery.push({\n\t\t\t_name: 'filter',\n\t\t\t_or: [\n\t\t\t\t{\n\t\t\t\t\t_like: {\n\t\t\t\t\t\t_field: 'data',\n\t\t\t\t\t\t_value: filter,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t_like: {\n\t\t\t\t\t\t_field: 'message',\n\t\t\t\t\t\t_value: filter,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t_like: {\n\t\t\t\t\t\t_field: 'attachment.name',\n\t\t\t\t\t\t_value: filter,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t}\n\n\tconst from = paginationToken !== undefined ? parseInt(paginationToken, 10) : 0;\n\tconst to = from + 100;\n\tquery.push({\n\t\t_name: 'page',\n\t\tfrom,\n\t\tto,\n\t});\n\n\tconst response = await theHiveApiRequest.call(this, 'POST', '/v1/query', { query });\n\n\tif (response.length === 0) {\n\t\treturn {\n\t\t\tresults: [],\n\t\t\tpaginationToken: undefined,\n\t\t};\n\t}\n\n\treturn {\n\t\tresults: response.map((entry: IDataObject) => ({\n\t\t\tname: entry.data || (entry.attachment as IDataObject)?.name || entry.message || entry._id,\n\t\t\tvalue: entry._id,\n\t\t})),\n\t\tpaginationToken: to,\n\t};\n}\n"],"mappings":"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","names":[]}