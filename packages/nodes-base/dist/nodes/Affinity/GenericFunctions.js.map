{"version":3,"sources":["../../../nodes/Affinity/GenericFunctions.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tILoadOptionsFunctions,\n\tIHookFunctions,\n\tIWebhookFunctions,\n\tJsonObject,\n\tIRequestOptions,\n\tIHttpRequestMethods,\n} from 'n8n-workflow';\nimport { BINARY_ENCODING, NodeApiError } from 'n8n-workflow';\n\nexport async function affinityApiRequest(\n\tthis: IExecuteFunctions | IWebhookFunctions | IHookFunctions | ILoadOptionsFunctions,\n\tmethod: IHttpRequestMethods,\n\tresource: string,\n\tbody: any = {},\n\tquery: IDataObject = {},\n\turi?: string,\n\toption: IDataObject = {},\n): Promise<any> {\n\tconst credentials = await this.getCredentials('affinityApi');\n\n\tconst apiKey = `:${credentials.apiKey}`;\n\n\tconst endpoint = 'https://api.affinity.co';\n\n\tlet options: IRequestOptions = {\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Basic ${Buffer.from(apiKey).toString(BINARY_ENCODING)}`,\n\t\t},\n\t\tmethod,\n\t\tbody,\n\t\tqs: query,\n\t\turi: uri || `${endpoint}${resource}`,\n\t\tjson: true,\n\t};\n\tif (!Object.keys(body as IDataObject).length) {\n\t\tdelete options.body;\n\t}\n\tif (!Object.keys(query).length) {\n\t\tdelete options.qs;\n\t}\n\toptions = Object.assign({}, options, option);\n\ttry {\n\t\treturn await this.helpers.request(options);\n\t} catch (error) {\n\t\tthrow new NodeApiError(this.getNode(), error as JsonObject);\n\t}\n}\n\nexport async function affinityApiRequestAllItems(\n\tthis: IHookFunctions | ILoadOptionsFunctions | IExecuteFunctions,\n\tpropertyName: string,\n\tmethod: IHttpRequestMethods,\n\tresource: string,\n\tbody: any = {},\n\tquery: IDataObject = {},\n): Promise<any> {\n\tconst returnData: IDataObject[] = [];\n\n\tlet responseData;\n\n\tquery.page_size = 500;\n\n\tdo {\n\t\tresponseData = await affinityApiRequest.call(this, method, resource, body, query);\n\t\tquery.page_token = responseData.page_token;\n\t\treturnData.push.apply(returnData, responseData[propertyName] as IDataObject[]);\n\t} while (responseData.page_token !== undefined && responseData.page_token !== null);\n\n\treturn returnData;\n}\n\nexport function eventsExist(subscriptions: string[], currentSubsriptions: string[]) {\n\tfor (const subscription of currentSubsriptions) {\n\t\tif (!subscriptions.includes(subscription)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\nexport function mapResource(key: string) {\n\treturn {\n\t\tperson: 'persons',\n\t\tlist: 'lists',\n\t\tnote: 'notes',\n\t\torganization: 'organizatitons',\n\t\tlist_entry: 'list-entries',\n\t\tfield: 'fields',\n\t\tfile: 'files',\n\t}[key];\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA,0BAA8C;AAE9C,eAAsB,mBAErB,QACA,UACA,OAAY,CAAC,GACb,QAAqB,CAAC,GACtB,KACA,SAAsB,CAAC,GACR;AACf,QAAM,cAAc,MAAM,KAAK,eAAe,aAAa;AAE3D,QAAM,SAAS,IAAI,YAAY,MAAM;AAErC,QAAM,WAAW;AAEjB,MAAI,UAA2B;AAAA,IAC9B,SAAS;AAAA,MACR,gBAAgB;AAAA,MAChB,eAAe,SAAS,OAAO,KAAK,MAAM,EAAE,SAAS,mCAAe,CAAC;AAAA,IACtE;AAAA,IACA;AAAA,IACA;AAAA,IACA,IAAI;AAAA,IACJ,KAAK,OAAO,GAAG,QAAQ,GAAG,QAAQ;AAAA,IAClC,MAAM;AAAA,EACP;AACA,MAAI,CAAC,OAAO,KAAK,IAAmB,EAAE,QAAQ;AAC7C,WAAO,QAAQ;AAAA,EAChB;AACA,MAAI,CAAC,OAAO,KAAK,KAAK,EAAE,QAAQ;AAC/B,WAAO,QAAQ;AAAA,EAChB;AACA,YAAU,OAAO,OAAO,CAAC,GAAG,SAAS,MAAM;AAC3C,MAAI;AACH,WAAO,MAAM,KAAK,QAAQ,QAAQ,OAAO;AAAA,EAC1C,SAAS,OAAO;AACf,UAAM,IAAI,iCAAa,KAAK,QAAQ,GAAG,KAAmB;AAAA,EAC3D;AACD;AAEA,eAAsB,2BAErB,cACA,QACA,UACA,OAAY,CAAC,GACb,QAAqB,CAAC,GACP;AACf,QAAM,aAA4B,CAAC;AAEnC,MAAI;AAEJ,QAAM,YAAY;AAElB,KAAG;AACF,mBAAe,MAAM,mBAAmB,KAAK,MAAM,QAAQ,UAAU,MAAM,KAAK;AAChF,UAAM,aAAa,aAAa;AAChC,eAAW,KAAK,MAAM,YAAY,aAAa,YAAY,CAAkB;AAAA,EAC9E,SAAS,aAAa,eAAe,UAAa,aAAa,eAAe;AAE9E,SAAO;AACR;AAEO,SAAS,YAAY,eAAyB,qBAA+B;AACnF,aAAW,gBAAgB,qBAAqB;AAC/C,QAAI,CAAC,cAAc,SAAS,YAAY,GAAG;AAC1C,aAAO;AAAA,IACR;AAAA,EACD;AACA,SAAO;AACR;AAEO,SAAS,YAAY,KAAa;AACxC,SAAO;AAAA,IACN,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,MAAM;AAAA,IACN,cAAc;AAAA,IACd,YAAY;AAAA,IACZ,OAAO;AAAA,IACP,MAAM;AAAA,EACP,EAAE,GAAG;AACN;","names":[]}