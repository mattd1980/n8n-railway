{"version":3,"sources":["../../../../../../nodes/Airtable/v2/actions/record/get.operation.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tINodeExecutionData,\n\tINodeProperties,\n\tNodeApiError,\n\tIExecuteFunctions,\n} from 'n8n-workflow';\n\nimport { updateDisplayOptions, wrapData } from '../../../../../utils/utilities';\nimport type { IRecord } from '../../helpers/interfaces';\nimport { flattenOutput, processAirtableError } from '../../helpers/utils';\nimport { apiRequest, downloadRecordAttachments } from '../../transport';\n\nconst properties: INodeProperties[] = [\n\t{\n\t\tdisplayName: 'Record ID',\n\t\tname: 'id',\n\t\ttype: 'string',\n\t\tdefault: '',\n\t\tplaceholder: 'e.g. recf7EaZp707CEc8g',\n\t\trequired: true,\n\t\t// eslint-disable-next-line n8n-nodes-base/node-param-description-miscased-id\n\t\tdescription:\n\t\t\t'ID of the record to get. <a href=\"https://support.airtable.com/docs/record-id\" target=\"_blank\">More info</a>.',\n\t},\n\t{\n\t\tdisplayName: 'Options',\n\t\tname: 'options',\n\t\ttype: 'collection',\n\t\tdefault: {},\n\t\tdescription: 'Additional options which decide which records should be returned',\n\t\tplaceholder: 'Add option',\n\t\toptions: [\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line n8n-nodes-base/node-param-display-name-wrong-for-dynamic-multi-options\n\t\t\t\tdisplayName: 'Download Attachments',\n\t\t\t\tname: 'downloadFields',\n\t\t\t\ttype: 'multiOptions',\n\t\t\t\ttypeOptions: {\n\t\t\t\t\tloadOptionsMethod: 'getAttachmentColumns',\n\t\t\t\t\tloadOptionsDependsOn: ['base.value', 'table.value'],\n\t\t\t\t},\n\t\t\t\tdefault: [],\n\t\t\t\t// eslint-disable-next-line n8n-nodes-base/node-param-description-wrong-for-dynamic-multi-options\n\t\t\t\tdescription: \"The fields of type 'attachment' that should be downloaded\",\n\t\t\t},\n\t\t],\n\t},\n];\n\nconst displayOptions = {\n\tshow: {\n\t\tresource: ['record'],\n\t\toperation: ['get'],\n\t},\n};\n\nexport const description = updateDisplayOptions(displayOptions, properties);\n\nexport async function execute(\n\tthis: IExecuteFunctions,\n\titems: INodeExecutionData[],\n\tbase: string,\n\ttable: string,\n): Promise<INodeExecutionData[]> {\n\tconst returnData: INodeExecutionData[] = [];\n\n\tfor (let i = 0; i < items.length; i++) {\n\t\tlet id;\n\t\ttry {\n\t\t\tid = this.getNodeParameter('id', i) as string;\n\n\t\t\tconst responseData = await apiRequest.call(this, 'GET', `${base}/${table}/${id}`);\n\n\t\t\tconst options = this.getNodeParameter('options', 0, {});\n\n\t\t\tif (options.downloadFields) {\n\t\t\t\tconst itemWithAttachments = await downloadRecordAttachments.call(\n\t\t\t\t\tthis,\n\t\t\t\t\t[responseData] as IRecord[],\n\t\t\t\t\toptions.downloadFields as string[],\n\t\t\t\t);\n\t\t\t\treturnData.push(...itemWithAttachments);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst executionData = this.helpers.constructExecutionMetaData(\n\t\t\t\twrapData(flattenOutput(responseData as IDataObject)),\n\t\t\t\t{ itemData: { item: i } },\n\t\t\t);\n\n\t\t\treturnData.push(...executionData);\n\t\t} catch (error) {\n\t\t\terror = processAirtableError(error as NodeApiError, id, i);\n\t\t\tif (this.continueOnFail()) {\n\t\t\t\treturnData.push({ json: { error: error.message } });\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\treturn returnData;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA,uBAA+C;AAE/C,mBAAoD;AACpD,uBAAsD;AAEtD,MAAM,aAAgC;AAAA,EACrC;AAAA,IACC,aAAa;AAAA,IACb,MAAM;AAAA,IACN,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,UAAU;AAAA;AAAA,IAEV,aACC;AAAA,EACF;AAAA,EACA;AAAA,IACC,aAAa;AAAA,IACb,MAAM;AAAA,IACN,MAAM;AAAA,IACN,SAAS,CAAC;AAAA,IACV,aAAa;AAAA,IACb,aAAa;AAAA,IACb,SAAS;AAAA,MACR;AAAA;AAAA,QAEC,aAAa;AAAA,QACb,MAAM;AAAA,QACN,MAAM;AAAA,QACN,aAAa;AAAA,UACZ,mBAAmB;AAAA,UACnB,sBAAsB,CAAC,cAAc,aAAa;AAAA,QACnD;AAAA,QACA,SAAS,CAAC;AAAA;AAAA,QAEV,aAAa;AAAA,MACd;AAAA,IACD;AAAA,EACD;AACD;AAEA,MAAM,iBAAiB;AAAA,EACtB,MAAM;AAAA,IACL,UAAU,CAAC,QAAQ;AAAA,IACnB,WAAW,CAAC,KAAK;AAAA,EAClB;AACD;AAEO,MAAM,kBAAc,uCAAqB,gBAAgB,UAAU;AAE1E,eAAsB,QAErB,OACA,MACA,OACgC;AAChC,QAAM,aAAmC,CAAC;AAE1C,WAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACtC,QAAI;AACJ,QAAI;AACH,WAAK,KAAK,iBAAiB,MAAM,CAAC;AAElC,YAAM,eAAe,MAAM,4BAAW,KAAK,MAAM,OAAO,GAAG,IAAI,IAAI,KAAK,IAAI,EAAE,EAAE;AAEhF,YAAM,UAAU,KAAK,iBAAiB,WAAW,GAAG,CAAC,CAAC;AAEtD,UAAI,QAAQ,gBAAgB;AAC3B,cAAM,sBAAsB,MAAM,2CAA0B;AAAA,UAC3D;AAAA,UACA,CAAC,YAAY;AAAA,UACb,QAAQ;AAAA,QACT;AACA,mBAAW,KAAK,GAAG,mBAAmB;AACtC;AAAA,MACD;AAEA,YAAM,gBAAgB,KAAK,QAAQ;AAAA,YAClC,+BAAS,4BAAc,YAA2B,CAAC;AAAA,QACnD,EAAE,UAAU,EAAE,MAAM,EAAE,EAAE;AAAA,MACzB;AAEA,iBAAW,KAAK,GAAG,aAAa;AAAA,IACjC,SAAS,OAAO;AACf,kBAAQ,mCAAqB,OAAuB,IAAI,CAAC;AACzD,UAAI,KAAK,eAAe,GAAG;AAC1B,mBAAW,KAAK,EAAE,MAAM,EAAE,OAAO,MAAM,QAAQ,EAAE,CAAC;AAClD;AAAA,MACD;AACA,YAAM;AAAA,IACP;AAAA,EACD;AAEA,SAAO;AACR;","names":[]}