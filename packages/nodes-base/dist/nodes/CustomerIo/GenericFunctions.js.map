{"version":3,"sources":["../../../nodes/CustomerIo/GenericFunctions.ts"],"sourcesContent":["import get from 'lodash/get';\nimport type {\n\tIExecuteFunctions,\n\tIHookFunctions,\n\tILoadOptionsFunctions,\n\tIDataObject,\n\tIHttpRequestMethods,\n\tIHttpRequestOptions,\n} from 'n8n-workflow';\n\nexport async function customerIoApiRequest(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions,\n\tmethod: IHttpRequestMethods,\n\tendpoint: string,\n\tbody: object,\n\tbaseApi?: string,\n\t_query?: IDataObject,\n) {\n\tconst credentials = await this.getCredentials('customerIoApi');\n\tconst options: IHttpRequestOptions = {\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t},\n\t\tmethod,\n\t\tbody,\n\t\turl: '',\n\t\tjson: true,\n\t};\n\n\tif (baseApi === 'tracking') {\n\t\tconst region = credentials.region;\n\t\toptions.url = `https://${region}/api/v1${endpoint}`;\n\t} else if (baseApi === 'api') {\n\t\tconst region = credentials.region;\n\t\t// Special handling for EU region\n\t\tif (region === 'track-eu.customer.io') {\n\t\t\toptions.url = `https://api-eu.customer.io/v1/api${endpoint}`;\n\t\t} else {\n\t\t\toptions.url = `https://api.customer.io/v1/api${endpoint}`;\n\t\t}\n\t} else if (baseApi === 'beta') {\n\t\toptions.url = `https://beta-api.customer.io/v1/api${endpoint}`;\n\t}\n\n\treturn await this.helpers.requestWithAuthentication.call(this, 'customerIoApi', options);\n}\n\nexport function eventExists(currentEvents: string[], webhookEvents: IDataObject) {\n\tfor (const currentEvent of currentEvents) {\n\t\tif (get(webhookEvents, [currentEvent.split('.')[0], currentEvent.split('.')[1]]) !== true) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\nexport function validateJSON(json: string | undefined): any {\n\tlet result;\n\ttry {\n\t\tresult = JSON.parse(json!);\n\t} catch (exception) {\n\t\tresult = undefined;\n\t}\n\treturn result;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAgB;AAUhB,eAAsB,qBAErB,QACA,UACA,MACA,SACA,QACC;AACD,QAAM,cAAc,MAAM,KAAK,eAAe,eAAe;AAC7D,QAAM,UAA+B;AAAA,IACpC,SAAS;AAAA,MACR,gBAAgB;AAAA,IACjB;AAAA,IACA;AAAA,IACA;AAAA,IACA,KAAK;AAAA,IACL,MAAM;AAAA,EACP;AAEA,MAAI,YAAY,YAAY;AAC3B,UAAM,SAAS,YAAY;AAC3B,YAAQ,MAAM,WAAW,MAAM,UAAU,QAAQ;AAAA,EAClD,WAAW,YAAY,OAAO;AAC7B,UAAM,SAAS,YAAY;AAE3B,QAAI,WAAW,wBAAwB;AACtC,cAAQ,MAAM,oCAAoC,QAAQ;AAAA,IAC3D,OAAO;AACN,cAAQ,MAAM,iCAAiC,QAAQ;AAAA,IACxD;AAAA,EACD,WAAW,YAAY,QAAQ;AAC9B,YAAQ,MAAM,sCAAsC,QAAQ;AAAA,EAC7D;AAEA,SAAO,MAAM,KAAK,QAAQ,0BAA0B,KAAK,MAAM,iBAAiB,OAAO;AACxF;AAEO,SAAS,YAAY,eAAyB,eAA4B;AAChF,aAAW,gBAAgB,eAAe;AACzC,YAAI,WAAAA,SAAI,eAAe,CAAC,aAAa,MAAM,GAAG,EAAE,CAAC,GAAG,aAAa,MAAM,GAAG,EAAE,CAAC,CAAC,CAAC,MAAM,MAAM;AAC1F,aAAO;AAAA,IACR;AAAA,EACD;AACA,SAAO;AACR;AAEO,SAAS,aAAa,MAA+B;AAC3D,MAAI;AACJ,MAAI;AACH,aAAS,KAAK,MAAM,IAAK;AAAA,EAC1B,SAAS,WAAW;AACnB,aAAS;AAAA,EACV;AACA,SAAO;AACR;","names":["get"]}