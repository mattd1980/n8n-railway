{"version":3,"sources":["../../../nodes/MondayCom/GenericFunctions.ts"],"sourcesContent":["import get from 'lodash/get';\nimport type {\n\tIExecuteFunctions,\n\tILoadOptionsFunctions,\n\tIDataObject,\n\tIHookFunctions,\n\tIWebhookFunctions,\n\tJsonObject,\n\tIRequestOptions,\n} from 'n8n-workflow';\nimport { NodeApiError } from 'n8n-workflow';\n\nexport async function mondayComApiRequest(\n\tthis: IExecuteFunctions | IWebhookFunctions | IHookFunctions | ILoadOptionsFunctions,\n\tbody: any = {},\n\toption: IDataObject = {},\n): Promise<any> {\n\tconst authenticationMethod = this.getNodeParameter('authentication', 0) as string;\n\n\tlet options: IRequestOptions = {\n\t\theaders: {\n\t\t\t'API-Version': '2023-10',\n\t\t\t'Content-Type': 'application/json',\n\t\t},\n\t\tmethod: 'POST',\n\t\tbody,\n\t\turi: 'https://api.monday.com/v2/',\n\t\tjson: true,\n\t};\n\n\toptions = Object.assign({}, options, option);\n\n\ttry {\n\t\tlet credentialType = 'mondayComApi';\n\n\t\tif (authenticationMethod === 'oAuth2') {\n\t\t\tcredentialType = 'mondayComOAuth2Api';\n\t\t}\n\t\treturn await this.helpers.requestWithAuthentication.call(this, credentialType, options);\n\t} catch (error) {\n\t\tthrow new NodeApiError(this.getNode(), error as JsonObject);\n\t}\n}\n\nexport async function mondayComApiRequestAllItems(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions,\n\tpropertyName: string,\n\tbody: any = {},\n): Promise<any> {\n\tconst returnData: IDataObject[] = [];\n\n\tlet responseData;\n\tbody.variables.limit = 50;\n\tbody.variables.page = 1;\n\n\tdo {\n\t\tresponseData = await mondayComApiRequest.call(this, body);\n\t\treturnData.push.apply(returnData, get(responseData, propertyName) as IDataObject[]);\n\t\tbody.variables.page++;\n\t} while (get(responseData, propertyName).length > 0);\n\treturn returnData;\n}\n\nexport async function mondayComApiPaginatedRequest(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions,\n\titemsPath: string,\n\tfieldsToReturn: string,\n\tbody: IDataObject = {},\n) {\n\tconst returnData: IDataObject[] = [];\n\n\tconst initialResponse = await mondayComApiRequest.call(this, body);\n\tconst data = get(initialResponse, itemsPath) as IDataObject;\n\n\tif (data) {\n\t\treturnData.push.apply(returnData, data.items as IDataObject[]);\n\n\t\tlet cursor: null | string = data.cursor as string;\n\n\t\twhile (cursor) {\n\t\t\tconst responseData = (\n\t\t\t\t(await mondayComApiRequest.call(this, {\n\t\t\t\t\tquery: `query ( $cursor: String!) { next_items_page (cursor: $cursor, limit: 100) { cursor items ${fieldsToReturn} } }`,\n\t\t\t\t\tvariables: {\n\t\t\t\t\t\tcursor,\n\t\t\t\t\t},\n\t\t\t\t})) as IDataObject\n\t\t\t).data as { next_items_page: { cursor: string; items: IDataObject[] } };\n\n\t\t\tif (responseData && responseData.next_items_page) {\n\t\t\t\treturnData.push.apply(returnData, responseData.next_items_page.items);\n\t\t\t\tcursor = responseData.next_items_page.cursor;\n\t\t\t} else {\n\t\t\t\tcursor = null;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn returnData;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAgB;AAUhB,0BAA6B;AAE7B,eAAsB,oBAErB,OAAY,CAAC,GACb,SAAsB,CAAC,GACR;AACf,QAAM,uBAAuB,KAAK,iBAAiB,kBAAkB,CAAC;AAEtE,MAAI,UAA2B;AAAA,IAC9B,SAAS;AAAA,MACR,eAAe;AAAA,MACf,gBAAgB;AAAA,IACjB;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,IACA,KAAK;AAAA,IACL,MAAM;AAAA,EACP;AAEA,YAAU,OAAO,OAAO,CAAC,GAAG,SAAS,MAAM;AAE3C,MAAI;AACH,QAAI,iBAAiB;AAErB,QAAI,yBAAyB,UAAU;AACtC,uBAAiB;AAAA,IAClB;AACA,WAAO,MAAM,KAAK,QAAQ,0BAA0B,KAAK,MAAM,gBAAgB,OAAO;AAAA,EACvF,SAAS,OAAO;AACf,UAAM,IAAI,iCAAa,KAAK,QAAQ,GAAG,KAAmB;AAAA,EAC3D;AACD;AAEA,eAAsB,4BAErB,cACA,OAAY,CAAC,GACE;AACf,QAAM,aAA4B,CAAC;AAEnC,MAAI;AACJ,OAAK,UAAU,QAAQ;AACvB,OAAK,UAAU,OAAO;AAEtB,KAAG;AACF,mBAAe,MAAM,oBAAoB,KAAK,MAAM,IAAI;AACxD,eAAW,KAAK,MAAM,gBAAY,WAAAA,SAAI,cAAc,YAAY,CAAkB;AAClF,SAAK,UAAU;AAAA,EAChB,aAAS,WAAAA,SAAI,cAAc,YAAY,EAAE,SAAS;AAClD,SAAO;AACR;AAEA,eAAsB,6BAErB,WACA,gBACA,OAAoB,CAAC,GACpB;AACD,QAAM,aAA4B,CAAC;AAEnC,QAAM,kBAAkB,MAAM,oBAAoB,KAAK,MAAM,IAAI;AACjE,QAAM,WAAO,WAAAA,SAAI,iBAAiB,SAAS;AAE3C,MAAI,MAAM;AACT,eAAW,KAAK,MAAM,YAAY,KAAK,KAAsB;AAE7D,QAAI,SAAwB,KAAK;AAEjC,WAAO,QAAQ;AACd,YAAM,gBACJ,MAAM,oBAAoB,KAAK,MAAM;AAAA,QACrC,OAAO,4FAA4F,cAAc;AAAA,QACjH,WAAW;AAAA,UACV;AAAA,QACD;AAAA,MACD,CAAC,GACA;AAEF,UAAI,gBAAgB,aAAa,iBAAiB;AACjD,mBAAW,KAAK,MAAM,YAAY,aAAa,gBAAgB,KAAK;AACpE,iBAAS,aAAa,gBAAgB;AAAA,MACvC,OAAO;AACN,iBAAS;AAAA,MACV;AAAA,IACD;AAAA,EACD;AAEA,SAAO;AACR;","names":["get"]}