{"version":3,"sources":["../../../nodes/FacebookLeadAds/GenericFunctions.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tIHookFunctions,\n\tIHttpRequestMethods,\n\tILoadOptionsFunctions,\n\tIRequestOptions,\n\tIWebhookFunctions,\n\tJsonObject,\n} from 'n8n-workflow';\nimport { NodeApiError } from 'n8n-workflow';\n\nimport type {\n\tCreateFacebookAppWebhookSubscription,\n\tFacebookAppWebhookSubscription,\n\tFacebookAppWebhookSubscriptionsResponse,\n\tFacebookFormListResponse,\n\tFacebookPage,\n\tFacebookPageListResponse,\n} from './types';\n\nexport async function facebookApiRequest(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n\tmethod: IHttpRequestMethods,\n\tresource: string,\n\tbody = {},\n\tqs: IDataObject = {},\n): Promise<any> {\n\tconst options: IRequestOptions = {\n\t\theaders: {\n\t\t\taccept: 'application/json',\n\t\t},\n\t\tmethod,\n\t\tqs,\n\t\tbody,\n\t\tgzip: true,\n\t\turi: `https://graph.facebook.com/v21.0${resource}`,\n\t\tjson: true,\n\t};\n\n\ttry {\n\t\treturn await this.helpers.requestOAuth2.call(this, 'facebookLeadAdsOAuth2Api', options);\n\t} catch (error) {\n\t\tthrow new NodeApiError(this.getNode(), error as JsonObject, {\n\t\t\tmessage: error?.error?.error?.message,\n\t\t});\n\t}\n}\n\nexport async function appAccessTokenRead(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n): Promise<{ access_token: string }> {\n\tconst credentials = await this.getCredentials('facebookLeadAdsOAuth2Api');\n\n\tconst options: IRequestOptions = {\n\t\theaders: {\n\t\t\t'content-type': 'application/x-www-form-urlencoded',\n\t\t},\n\t\tmethod: 'POST',\n\t\tform: {\n\t\t\tclient_id: credentials.clientId,\n\t\t\tclient_secret: credentials.clientSecret,\n\t\t\tgrant_type: 'client_credentials',\n\t\t},\n\t\turi: credentials.accessTokenUrl as string,\n\t\tjson: true,\n\t};\n\ttry {\n\t\treturn await this.helpers.request(options);\n\t} catch (error) {\n\t\tthrow new NodeApiError(this.getNode(), error as JsonObject);\n\t}\n}\n\nexport async function facebookAppApiRequest(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n\tmethod: IHttpRequestMethods,\n\tresource: string,\n\tbody?: { type: 'json'; payload: IDataObject } | { type: 'form'; payload: IDataObject },\n\tqs: IDataObject = {},\n): Promise<any> {\n\tconst tokenResponse = await appAccessTokenRead.call(this);\n\tconst appAccessToken = tokenResponse.access_token;\n\n\tconst options: IRequestOptions = {\n\t\theaders: {\n\t\t\taccept: 'application/json',\n\t\t\tauthorization: `Bearer ${appAccessToken}`,\n\t\t},\n\t\tmethod,\n\t\tqs,\n\t\tgzip: true,\n\t\turi: `https://graph.facebook.com/v21.0${resource}`,\n\t\tjson: true,\n\t};\n\n\tif (body?.type === 'json') {\n\t\toptions.body = body.payload;\n\t} else if (body?.type === 'form') {\n\t\toptions.form = body.payload;\n\t}\n\n\ttry {\n\t\treturn await this.helpers.request(options);\n\t} catch (error) {\n\t\tthrow new NodeApiError(this.getNode(), error as JsonObject);\n\t}\n}\n\nexport async function appWebhookSubscriptionList(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n\tappId: string,\n): Promise<FacebookAppWebhookSubscription[]> {\n\tconst response = (await facebookAppApiRequest.call(\n\t\tthis,\n\t\t'GET',\n\t\t`/${appId}/subscriptions`,\n\t)) as FacebookAppWebhookSubscriptionsResponse;\n\treturn response.data;\n}\n\nexport async function appWebhookSubscriptionCreate(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n\tappId: string,\n\tsubscription: CreateFacebookAppWebhookSubscription,\n) {\n\treturn await facebookAppApiRequest.call(this, 'POST', `/${appId}/subscriptions`, {\n\t\ttype: 'form',\n\t\tpayload: { ...subscription },\n\t});\n}\n\nexport async function appWebhookSubscriptionDelete(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n\tappId: string,\n\tobject: string,\n) {\n\treturn await facebookAppApiRequest.call(this, 'DELETE', `/${appId}/subscriptions`, {\n\t\ttype: 'form',\n\t\tpayload: { object },\n\t});\n}\n\nexport async function facebookPageList(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n\tcursor?: string,\n): Promise<FacebookPageListResponse> {\n\tconst response = (await facebookApiRequest.call(\n\t\tthis,\n\t\t'GET',\n\t\t'/me/accounts',\n\t\t{},\n\t\t{ cursor, fields: 'id,name' },\n\t)) as FacebookPageListResponse;\n\treturn response;\n}\n\nexport async function facebookEntityDetail(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n\tentityId: string,\n\tfields = 'id,name,access_token',\n): Promise<any> {\n\treturn await facebookApiRequest.call(this, 'GET', `/${entityId}`, {}, { fields });\n}\n\nexport async function facebookPageApiRequest(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n\tmethod: IHttpRequestMethods,\n\tresource: string,\n\tbody = {},\n\tqs: IDataObject = {},\n): Promise<any> {\n\tconst pageId = this.getNodeParameter('page', '', { extractValue: true }) as string;\n\tconst page = (await facebookEntityDetail.call(this, pageId)) as FacebookPage;\n\tconst pageAccessToken = page.access_token;\n\tconst options: IRequestOptions = {\n\t\theaders: {\n\t\t\taccept: 'application/json',\n\t\t\tauthorization: `Bearer ${pageAccessToken}`,\n\t\t},\n\t\tmethod,\n\t\tqs,\n\t\tbody,\n\t\tgzip: true,\n\t\turi: `https://graph.facebook.com/v21.0${resource}`,\n\t\tjson: true,\n\t};\n\n\ttry {\n\t\treturn await this.helpers.request.call(this, options);\n\t} catch (error) {\n\t\tthrow new NodeApiError(this.getNode(), error as JsonObject);\n\t}\n}\n\nexport async function installAppOnPage(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n\tpageId: string,\n\tfields: string,\n) {\n\treturn await facebookPageApiRequest.call(\n\t\tthis,\n\t\t'POST',\n\t\t`/${pageId}/subscribed_apps`,\n\t\t{},\n\t\t{ subscribed_fields: fields },\n\t);\n}\n\nexport async function facebookFormList(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n\tpageId: string,\n\tcursor?: string,\n): Promise<FacebookFormListResponse> {\n\tconst response = (await facebookPageApiRequest.call(\n\t\tthis,\n\t\t'GET',\n\t\t`/${pageId}/leadgen_forms`,\n\t\t{},\n\t\t{ cursor, fields: 'id,name' },\n\t)) as FacebookFormListResponse;\n\treturn response;\n}\n"],"mappings":"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","names":[]}