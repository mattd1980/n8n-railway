{"version":3,"sources":["../../../../../nodes/Airtop/actions/session/create.operation.ts"],"sourcesContent":["import {\n\ttype IDataObject,\n\ttype IExecuteFunctions,\n\ttype INodeExecutionData,\n\ttype INodeProperties,\n} from 'n8n-workflow';\n\nimport { INTEGRATION_URL } from '../../constants';\nimport {\n\tvalidateAirtopApiResponse,\n\tvalidateProfileName,\n\tvalidateProxyUrl,\n\tvalidateSaveProfileOnTermination,\n\tvalidateTimeoutMinutes,\n} from '../../GenericFunctions';\nimport { apiRequest } from '../../transport';\nimport { profileNameField } from '../common/fields';\n\nexport const description: INodeProperties[] = [\n\t{\n\t\t...profileNameField,\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\tresource: ['session'],\n\t\t\t\toperation: ['create'],\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tdisplayName: 'Save Profile',\n\t\tname: 'saveProfileOnTermination',\n\t\ttype: 'boolean',\n\t\tdefault: false,\n\t\tdescription:\n\t\t\t'Whether to automatically save the <a href=\"https://docs.airtop.ai/guides/how-to/saving-a-profile\" target=\"_blank\">Airtop profile</a> for this session upon termination',\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\tresource: ['session'],\n\t\t\t\toperation: ['create'],\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tdisplayName: 'Idle Timeout',\n\t\tname: 'timeoutMinutes',\n\t\ttype: 'number',\n\t\tdefault: 10,\n\t\tvalidateType: 'number',\n\t\tdescription: 'Minutes to wait before the session is terminated due to inactivity',\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\tresource: ['session'],\n\t\t\t\toperation: ['create'],\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tdisplayName: 'Proxy',\n\t\tname: 'proxy',\n\t\ttype: 'options',\n\t\tdefault: 'none',\n\t\tdescription: 'Choose how to configure the proxy for this session',\n\t\toptions: [\n\t\t\t{\n\t\t\t\tname: 'None',\n\t\t\t\tvalue: 'none',\n\t\t\t\tdescription: 'No proxy will be used',\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: 'Integrated',\n\t\t\t\tvalue: 'integrated',\n\t\t\t\tdescription: 'Use Airtop-provided proxy',\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: 'Custom',\n\t\t\t\tvalue: 'custom',\n\t\t\t\tdescription: 'Configure a custom proxy',\n\t\t\t},\n\t\t],\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\tresource: ['session'],\n\t\t\t\toperation: ['create'],\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tdisplayName: 'Proxy URL',\n\t\tname: 'proxyUrl',\n\t\ttype: 'string',\n\t\tdefault: '',\n\t\tdescription: 'The URL of the proxy to use',\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\tproxy: ['custom'],\n\t\t\t},\n\t\t},\n\t},\n];\n\nexport async function execute(\n\tthis: IExecuteFunctions,\n\tindex: number,\n): Promise<INodeExecutionData[]> {\n\tconst url = `${INTEGRATION_URL}/create-session`;\n\n\tconst profileName = validateProfileName.call(this, index);\n\tconst timeoutMinutes = validateTimeoutMinutes.call(this, index);\n\tconst saveProfileOnTermination = validateSaveProfileOnTermination.call(this, index, profileName);\n\tconst proxyParam = this.getNodeParameter('proxy', index, 'none') as string;\n\tconst proxyUrl = validateProxyUrl.call(this, index, proxyParam);\n\n\tconst body: IDataObject = {\n\t\tconfiguration: {\n\t\t\tprofileName,\n\t\t\ttimeoutMinutes,\n\t\t\tproxy: proxyParam === 'custom' ? proxyUrl : Boolean(proxyParam === 'integrated'),\n\t\t},\n\t};\n\n\tconst response = await apiRequest.call(this, 'POST', url, body);\n\tconst sessionId = response.sessionId;\n\n\t// validate response\n\tvalidateAirtopApiResponse(this.getNode(), response);\n\n\tif (saveProfileOnTermination) {\n\t\tawait apiRequest.call(\n\t\t\tthis,\n\t\t\t'PUT',\n\t\t\t`/sessions/${sessionId}/save-profile-on-termination/${profileName}`,\n\t\t);\n\t}\n\n\treturn this.helpers.returnJsonArray({ sessionId } as IDataObject);\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA,uBAAgC;AAChC,8BAMO;AACP,uBAA2B;AAC3B,oBAAiC;AAE1B,MAAM,cAAiC;AAAA,EAC7C;AAAA,IACC,GAAG;AAAA,IACH,gBAAgB;AAAA,MACf,MAAM;AAAA,QACL,UAAU,CAAC,SAAS;AAAA,QACpB,WAAW,CAAC,QAAQ;AAAA,MACrB;AAAA,IACD;AAAA,EACD;AAAA,EACA;AAAA,IACC,aAAa;AAAA,IACb,MAAM;AAAA,IACN,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aACC;AAAA,IACD,gBAAgB;AAAA,MACf,MAAM;AAAA,QACL,UAAU,CAAC,SAAS;AAAA,QACpB,WAAW,CAAC,QAAQ;AAAA,MACrB;AAAA,IACD;AAAA,EACD;AAAA,EACA;AAAA,IACC,aAAa;AAAA,IACb,MAAM;AAAA,IACN,MAAM;AAAA,IACN,SAAS;AAAA,IACT,cAAc;AAAA,IACd,aAAa;AAAA,IACb,gBAAgB;AAAA,MACf,MAAM;AAAA,QACL,UAAU,CAAC,SAAS;AAAA,QACpB,WAAW,CAAC,QAAQ;AAAA,MACrB;AAAA,IACD;AAAA,EACD;AAAA,EACA;AAAA,IACC,aAAa;AAAA,IACb,MAAM;AAAA,IACN,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,SAAS;AAAA,MACR;AAAA,QACC,MAAM;AAAA,QACN,OAAO;AAAA,QACP,aAAa;AAAA,MACd;AAAA,MACA;AAAA,QACC,MAAM;AAAA,QACN,OAAO;AAAA,QACP,aAAa;AAAA,MACd;AAAA,MACA;AAAA,QACC,MAAM;AAAA,QACN,OAAO;AAAA,QACP,aAAa;AAAA,MACd;AAAA,IACD;AAAA,IACA,gBAAgB;AAAA,MACf,MAAM;AAAA,QACL,UAAU,CAAC,SAAS;AAAA,QACpB,WAAW,CAAC,QAAQ;AAAA,MACrB;AAAA,IACD;AAAA,EACD;AAAA,EACA;AAAA,IACC,aAAa;AAAA,IACb,MAAM;AAAA,IACN,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,gBAAgB;AAAA,MACf,MAAM;AAAA,QACL,OAAO,CAAC,QAAQ;AAAA,MACjB;AAAA,IACD;AAAA,EACD;AACD;AAEA,eAAsB,QAErB,OACgC;AAChC,QAAM,MAAM,GAAG,gCAAe;AAE9B,QAAM,cAAc,4CAAoB,KAAK,MAAM,KAAK;AACxD,QAAM,iBAAiB,+CAAuB,KAAK,MAAM,KAAK;AAC9D,QAAM,2BAA2B,yDAAiC,KAAK,MAAM,OAAO,WAAW;AAC/F,QAAM,aAAa,KAAK,iBAAiB,SAAS,OAAO,MAAM;AAC/D,QAAM,WAAW,yCAAiB,KAAK,MAAM,OAAO,UAAU;AAE9D,QAAM,OAAoB;AAAA,IACzB,eAAe;AAAA,MACd;AAAA,MACA;AAAA,MACA,OAAO,eAAe,WAAW,WAAW,QAAQ,eAAe,YAAY;AAAA,IAChF;AAAA,EACD;AAEA,QAAM,WAAW,MAAM,4BAAW,KAAK,MAAM,QAAQ,KAAK,IAAI;AAC9D,QAAM,YAAY,SAAS;AAG3B,yDAA0B,KAAK,QAAQ,GAAG,QAAQ;AAElD,MAAI,0BAA0B;AAC7B,UAAM,4BAAW;AAAA,MAChB;AAAA,MACA;AAAA,MACA,aAAa,SAAS,gCAAgC,WAAW;AAAA,IAClE;AAAA,EACD;AAEA,SAAO,KAAK,QAAQ,gBAAgB,EAAE,UAAU,CAAgB;AACjE;","names":[]}