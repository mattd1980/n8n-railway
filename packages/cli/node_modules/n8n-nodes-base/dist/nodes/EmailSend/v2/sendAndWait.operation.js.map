{"version":3,"sources":["../../../../nodes/EmailSend/v2/sendAndWait.operation.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tINodeExecutionData,\n\tINodeProperties,\n} from 'n8n-workflow';\n\nimport { fromEmailProperty, toEmailProperty } from './descriptions';\nimport { configureTransport } from './utils';\nimport { configureWaitTillDate } from '../../../utils/sendAndWait/configureWaitTillDate.util';\nimport {\n\tcreateEmailBodyWithN8nAttribution,\n\tcreateEmailBodyWithoutN8nAttribution,\n} from '../../../utils/sendAndWait/email-templates';\nimport {\n\tcreateButton,\n\tgetSendAndWaitConfig,\n\tgetSendAndWaitProperties,\n} from '../../../utils/sendAndWait/utils';\n\nexport const description: INodeProperties[] = getSendAndWaitProperties(\n\t[fromEmailProperty, toEmailProperty],\n\t'email',\n);\n\nexport async function execute(this: IExecuteFunctions): Promise<INodeExecutionData[][]> {\n\tconst fromEmail = this.getNodeParameter('fromEmail', 0) as string;\n\tconst toEmail = this.getNodeParameter('toEmail', 0) as string;\n\n\tconst config = getSendAndWaitConfig(this);\n\tconst buttons: string[] = [];\n\tfor (const option of config.options) {\n\t\tbuttons.push(createButton(config.url, option.label, option.value, option.style));\n\t}\n\n\tlet htmlBody: string;\n\n\tif (config.appendAttribution !== false) {\n\t\tconst instanceId = this.getInstanceId();\n\t\thtmlBody = createEmailBodyWithN8nAttribution(config.message, buttons.join('\\n'), instanceId);\n\t} else {\n\t\thtmlBody = createEmailBodyWithoutN8nAttribution(config.message, buttons.join('\\n'));\n\t}\n\n\tconst mailOptions: IDataObject = {\n\t\tfrom: fromEmail,\n\t\tto: toEmail,\n\t\tsubject: config.title,\n\t\thtml: htmlBody,\n\t};\n\n\tconst credentials = await this.getCredentials('smtp');\n\tconst transporter = configureTransport(credentials, {});\n\n\tawait transporter.sendMail(mailOptions);\n\n\tconst waitTill = configureWaitTillDate(this);\n\n\tawait this.putExecutionToWait(waitTill);\n\treturn [this.getInputData()];\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA,0BAAmD;AACnD,mBAAmC;AACnC,mCAAsC;AACtC,6BAGO;AACP,IAAAA,gBAIO;AAEA,MAAM,kBAAiC;AAAA,EAC7C,CAAC,uCAAmB,mCAAe;AAAA,EACnC;AACD;AAEA,eAAsB,UAAkE;AACvF,QAAM,YAAY,KAAK,iBAAiB,aAAa,CAAC;AACtD,QAAM,UAAU,KAAK,iBAAiB,WAAW,CAAC;AAElD,QAAM,aAAS,oCAAqB,IAAI;AACxC,QAAM,UAAoB,CAAC;AAC3B,aAAW,UAAU,OAAO,SAAS;AACpC,YAAQ,SAAK,4BAAa,OAAO,KAAK,OAAO,OAAO,OAAO,OAAO,OAAO,KAAK,CAAC;AAAA,EAChF;AAEA,MAAI;AAEJ,MAAI,OAAO,sBAAsB,OAAO;AACvC,UAAM,aAAa,KAAK,cAAc;AACtC,mBAAW,0DAAkC,OAAO,SAAS,QAAQ,KAAK,IAAI,GAAG,UAAU;AAAA,EAC5F,OAAO;AACN,mBAAW,6DAAqC,OAAO,SAAS,QAAQ,KAAK,IAAI,CAAC;AAAA,EACnF;AAEA,QAAM,cAA2B;AAAA,IAChC,MAAM;AAAA,IACN,IAAI;AAAA,IACJ,SAAS,OAAO;AAAA,IAChB,MAAM;AAAA,EACP;AAEA,QAAM,cAAc,MAAM,KAAK,eAAe,MAAM;AACpD,QAAM,kBAAc,iCAAmB,aAAa,CAAC,CAAC;AAEtD,QAAM,YAAY,SAAS,WAAW;AAEtC,QAAM,eAAW,oDAAsB,IAAI;AAE3C,QAAM,KAAK,mBAAmB,QAAQ;AACtC,SAAO,CAAC,KAAK,aAAa,CAAC;AAC5B;","names":["import_utils"]}