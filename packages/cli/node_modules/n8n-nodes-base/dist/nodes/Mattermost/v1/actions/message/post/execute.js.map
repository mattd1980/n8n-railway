{"version":3,"sources":["../../../../../../../nodes/Mattermost/v1/actions/message/post/execute.ts"],"sourcesContent":["import type { IExecuteFunctions, IDataObject, INodeExecutionData } from 'n8n-workflow';\n\nimport { apiRequest } from '../../../transport';\nimport type { IAttachment } from '../../Interfaces';\n\nexport async function post(this: IExecuteFunctions, index: number): Promise<INodeExecutionData[]> {\n\tconst body = {} as IDataObject;\n\tconst qs = {} as IDataObject;\n\tconst requestMethod = 'POST';\n\tconst endpoint = 'posts';\n\n\tbody.channel_id = this.getNodeParameter('channelId', index) as string;\n\tbody.message = this.getNodeParameter('message', index) as string;\n\n\tconst attachments = this.getNodeParameter('attachments', index, []) as unknown as IAttachment[];\n\t// The node does save the fields data differently than the API\n\t// expects so fix the data befre we send the request\n\tfor (const attachment of attachments) {\n\t\tif (attachment.fields !== undefined) {\n\t\t\tif (attachment.fields.item !== undefined) {\n\t\t\t\t// Move the field-content up\n\t\t\t\t// @ts-ignore\n\t\t\t\tattachment.fields = attachment.fields.item;\n\t\t\t} else {\n\t\t\t\t// If it does not have any items set remove it\n\t\t\t\t// @ts-ignore\n\t\t\t\tdelete attachment.fields;\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (const attachment of attachments) {\n\t\tif (attachment.actions !== undefined) {\n\t\t\tif (attachment.actions.item !== undefined) {\n\t\t\t\t// Move the field-content up\n\t\t\t\t// @ts-ignore\n\t\t\t\tattachment.actions = attachment.actions.item;\n\t\t\t} else {\n\t\t\t\t// If it does not have any items set remove it\n\t\t\t\t// @ts-ignore\n\t\t\t\tdelete attachment.actions;\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (const attachment of attachments) {\n\t\tif (Array.isArray(attachment.actions)) {\n\t\t\tfor (const attaction of attachment.actions) {\n\t\t\t\tif (attaction.type === 'button') {\n\t\t\t\t\tdelete attaction.type;\n\t\t\t\t}\n\t\t\t\tif (attaction.data_source === 'custom') {\n\t\t\t\t\tdelete attaction.data_source;\n\t\t\t\t}\n\t\t\t\tif (attaction.options) {\n\t\t\t\t\tattaction.options = attaction.options.option;\n\t\t\t\t}\n\n\t\t\t\tif (attaction.integration.item !== undefined) {\n\t\t\t\t\tattaction.integration = attaction.integration.item;\n\t\t\t\t\tif (Array.isArray(attaction.integration.context.property)) {\n\t\t\t\t\t\tconst tmpcontex = {};\n\t\t\t\t\t\tfor (const attactionintegprop of attaction.integration.context.property) {\n\t\t\t\t\t\t\tObject.assign(tmpcontex, { [attactionintegprop.name]: attactionintegprop.value });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdelete attaction.integration.context;\n\t\t\t\t\t\tattaction.integration.context = tmpcontex;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tbody.props = {\n\t\tattachments,\n\t};\n\n\t// Add all the other options to the request\n\tconst otherOptions = this.getNodeParameter('otherOptions', index) as IDataObject;\n\tObject.assign(body, otherOptions);\n\n\tconst responseData = await apiRequest.call(this, requestMethod, endpoint, body, qs);\n\n\treturn this.helpers.returnJsonArray(responseData as IDataObject[]);\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,uBAA2B;AAG3B,eAAsB,KAA8B,OAA8C;AACjG,QAAM,OAAO,CAAC;AACd,QAAM,KAAK,CAAC;AACZ,QAAM,gBAAgB;AACtB,QAAM,WAAW;AAEjB,OAAK,aAAa,KAAK,iBAAiB,aAAa,KAAK;AAC1D,OAAK,UAAU,KAAK,iBAAiB,WAAW,KAAK;AAErD,QAAM,cAAc,KAAK,iBAAiB,eAAe,OAAO,CAAC,CAAC;AAGlE,aAAW,cAAc,aAAa;AACrC,QAAI,WAAW,WAAW,QAAW;AACpC,UAAI,WAAW,OAAO,SAAS,QAAW;AAGzC,mBAAW,SAAS,WAAW,OAAO;AAAA,MACvC,OAAO;AAGN,eAAO,WAAW;AAAA,MACnB;AAAA,IACD;AAAA,EACD;AAEA,aAAW,cAAc,aAAa;AACrC,QAAI,WAAW,YAAY,QAAW;AACrC,UAAI,WAAW,QAAQ,SAAS,QAAW;AAG1C,mBAAW,UAAU,WAAW,QAAQ;AAAA,MACzC,OAAO;AAGN,eAAO,WAAW;AAAA,MACnB;AAAA,IACD;AAAA,EACD;AAEA,aAAW,cAAc,aAAa;AACrC,QAAI,MAAM,QAAQ,WAAW,OAAO,GAAG;AACtC,iBAAW,aAAa,WAAW,SAAS;AAC3C,YAAI,UAAU,SAAS,UAAU;AAChC,iBAAO,UAAU;AAAA,QAClB;AACA,YAAI,UAAU,gBAAgB,UAAU;AACvC,iBAAO,UAAU;AAAA,QAClB;AACA,YAAI,UAAU,SAAS;AACtB,oBAAU,UAAU,UAAU,QAAQ;AAAA,QACvC;AAEA,YAAI,UAAU,YAAY,SAAS,QAAW;AAC7C,oBAAU,cAAc,UAAU,YAAY;AAC9C,cAAI,MAAM,QAAQ,UAAU,YAAY,QAAQ,QAAQ,GAAG;AAC1D,kBAAM,YAAY,CAAC;AACnB,uBAAW,sBAAsB,UAAU,YAAY,QAAQ,UAAU;AACxE,qBAAO,OAAO,WAAW,EAAE,CAAC,mBAAmB,IAAI,GAAG,mBAAmB,MAAM,CAAC;AAAA,YACjF;AACA,mBAAO,UAAU,YAAY;AAC7B,sBAAU,YAAY,UAAU;AAAA,UACjC;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAEA,OAAK,QAAQ;AAAA,IACZ;AAAA,EACD;AAGA,QAAM,eAAe,KAAK,iBAAiB,gBAAgB,KAAK;AAChE,SAAO,OAAO,MAAM,YAAY;AAEhC,QAAM,eAAe,MAAM,4BAAW,KAAK,MAAM,eAAe,UAAU,MAAM,EAAE;AAElF,SAAO,KAAK,QAAQ,gBAAgB,YAA6B;AAClE;","names":[]}