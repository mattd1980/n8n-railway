{"version":3,"sources":["../../../nodes/NextCloud/GenericFunctions.ts"],"sourcesContent":["import {\n\tNodeOperationError,\n\ttype IExecuteFunctions,\n\ttype IHookFunctions,\n\ttype IHttpRequestMethods,\n\ttype IRequestOptions,\n\ttype IDataObject,\n} from 'n8n-workflow';\n\n/**\n * Make an API request to NextCloud\n *\n */\nexport async function nextCloudApiRequest(\n\tthis: IHookFunctions | IExecuteFunctions,\n\tmethod: IHttpRequestMethods,\n\tendpoint: string,\n\tbody: object | string | Buffer,\n\theaders?: IDataObject,\n\tencoding?: null | undefined,\n\tquery?: IDataObject,\n) {\n\tconst resource = this.getNodeParameter('resource', 0);\n\tconst operation = this.getNodeParameter('operation', 0);\n\tconst authenticationMethod = this.getNodeParameter('authentication', 0);\n\n\tlet credentials;\n\n\tif (authenticationMethod === 'accessToken') {\n\t\tcredentials = await this.getCredentials<{ webDavUrl: string }>('nextCloudApi');\n\t} else {\n\t\tcredentials = await this.getCredentials<{ webDavUrl: string }>('nextCloudOAuth2Api');\n\t}\n\n\tconst options: IRequestOptions = {\n\t\theaders,\n\t\tmethod,\n\t\tbody,\n\t\tqs: query ?? {},\n\t\turi: '',\n\t\tjson: false,\n\t};\n\n\tif (encoding === null) {\n\t\toptions.encoding = null;\n\t}\n\n\toptions.uri = `${credentials.webDavUrl}/${encodeURI(endpoint)}`;\n\n\tif (resource === 'user' && operation === 'create') {\n\t\toptions.uri = options.uri.replace('/remote.php/webdav', '');\n\t}\n\n\tif (resource === 'file' && operation === 'share') {\n\t\toptions.uri = options.uri.replace('/remote.php/webdav', '');\n\t}\n\n\tconst credentialType =\n\t\tauthenticationMethod === 'accessToken' ? 'nextCloudApi' : 'nextCloudOAuth2Api';\n\n\tconst response = await this.helpers.requestWithAuthentication.call(this, credentialType, options);\n\n\tif (typeof response === 'string' && response.includes('<b>Fatal error</b>')) {\n\t\tthrow new NodeOperationError(\n\t\t\tthis.getNode(),\n\t\t\t\"NextCloud responded with a 'Fatal error', check description for more details\",\n\t\t\t{\n\t\t\t\tdescription: `Server response:\\n${response}`,\n\t\t\t},\n\t\t);\n\t}\n\n\treturn response;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAOO;AAMP,eAAsB,oBAErB,QACA,UACA,MACA,SACA,UACA,OACC;AACD,QAAM,WAAW,KAAK,iBAAiB,YAAY,CAAC;AACpD,QAAM,YAAY,KAAK,iBAAiB,aAAa,CAAC;AACtD,QAAM,uBAAuB,KAAK,iBAAiB,kBAAkB,CAAC;AAEtE,MAAI;AAEJ,MAAI,yBAAyB,eAAe;AAC3C,kBAAc,MAAM,KAAK,eAAsC,cAAc;AAAA,EAC9E,OAAO;AACN,kBAAc,MAAM,KAAK,eAAsC,oBAAoB;AAAA,EACpF;AAEA,QAAM,UAA2B;AAAA,IAChC;AAAA,IACA;AAAA,IACA;AAAA,IACA,IAAI,SAAS,CAAC;AAAA,IACd,KAAK;AAAA,IACL,MAAM;AAAA,EACP;AAEA,MAAI,aAAa,MAAM;AACtB,YAAQ,WAAW;AAAA,EACpB;AAEA,UAAQ,MAAM,GAAG,YAAY,SAAS,IAAI,UAAU,QAAQ,CAAC;AAE7D,MAAI,aAAa,UAAU,cAAc,UAAU;AAClD,YAAQ,MAAM,QAAQ,IAAI,QAAQ,sBAAsB,EAAE;AAAA,EAC3D;AAEA,MAAI,aAAa,UAAU,cAAc,SAAS;AACjD,YAAQ,MAAM,QAAQ,IAAI,QAAQ,sBAAsB,EAAE;AAAA,EAC3D;AAEA,QAAM,iBACL,yBAAyB,gBAAgB,iBAAiB;AAE3D,QAAM,WAAW,MAAM,KAAK,QAAQ,0BAA0B,KAAK,MAAM,gBAAgB,OAAO;AAEhG,MAAI,OAAO,aAAa,YAAY,SAAS,SAAS,oBAAoB,GAAG;AAC5E,UAAM,IAAI;AAAA,MACT,KAAK,QAAQ;AAAA,MACb;AAAA,MACA;AAAA,QACC,aAAa;AAAA,EAAqB,QAAQ;AAAA,MAC3C;AAAA,IACD;AAAA,EACD;AAEA,SAAO;AACR;","names":[]}