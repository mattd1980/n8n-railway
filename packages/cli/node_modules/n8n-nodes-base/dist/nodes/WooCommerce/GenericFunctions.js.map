{"version":3,"sources":["../../../nodes/WooCommerce/GenericFunctions.ts"],"sourcesContent":["import { snakeCase } from 'change-case';\nimport { createHash } from 'crypto';\nimport omit from 'lodash/omit';\nimport type {\n\tICredentialDataDecryptedObject,\n\tIDataObject,\n\tIExecuteFunctions,\n\tIHookFunctions,\n\tILoadOptionsFunctions,\n\tIWebhookFunctions,\n\tIHttpRequestMethods,\n\tIRequestOptions,\n} from 'n8n-workflow';\n\nimport type { ICouponLine, IFeeLine, ILineItem, IShoppingLine } from './OrderInterface';\n\nexport async function woocommerceApiRequest(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n\tmethod: IHttpRequestMethods,\n\tresource: string,\n\n\tbody: any = {},\n\tqs: IDataObject = {},\n\turi?: string,\n\toption: IDataObject = {},\n): Promise<any> {\n\tconst credentials = await this.getCredentials('wooCommerceApi');\n\n\tlet options: IRequestOptions = {\n\t\tmethod,\n\t\tqs,\n\t\tbody,\n\t\turi: uri || `${credentials.url}/wp-json/wc/v3${resource}`,\n\t\tjson: true,\n\t};\n\n\tif (!Object.keys(body as IDataObject).length) {\n\t\tdelete options.form;\n\t}\n\toptions = Object.assign({}, options, option);\n\treturn await this.helpers.requestWithAuthentication.call(this, 'wooCommerceApi', options);\n}\n\nexport async function woocommerceApiRequestAllItems(\n\tthis: IExecuteFunctions | ILoadOptionsFunctions | IHookFunctions,\n\tmethod: IHttpRequestMethods,\n\tendpoint: string,\n\n\tbody: any = {},\n\tquery: IDataObject = {},\n): Promise<any> {\n\tconst returnData: IDataObject[] = [];\n\n\tlet responseData;\n\tlet uri: string | undefined;\n\tquery.per_page = 100;\n\tdo {\n\t\tresponseData = await woocommerceApiRequest.call(this, method, endpoint, body, query, uri, {\n\t\t\tresolveWithFullResponse: true,\n\t\t});\n\t\tconst links = responseData.headers.link.split(',');\n\t\tconst nextLink = links.find((link: string) => link.indexOf('rel=\"next\"') !== -1);\n\t\tif (nextLink) {\n\t\t\turi = nextLink.split(';')[0].replace(/<(.*)>/, '$1');\n\t\t}\n\t\treturnData.push.apply(returnData, responseData.body as IDataObject[]);\n\t} while (responseData.headers.link?.includes('rel=\"next\"'));\n\n\treturn returnData;\n}\n\n/**\n * Creates a secret from the credentials\n *\n */\nexport function getAutomaticSecret(credentials: ICredentialDataDecryptedObject) {\n\tconst data = `${credentials.consumerKey},${credentials.consumerSecret}`;\n\treturn createHash('md5').update(data).digest('hex');\n}\n\nexport function setMetadata(data: IShoppingLine[] | IFeeLine[] | ILineItem[] | ICouponLine[]) {\n\tfor (let i = 0; i < data.length; i++) {\n\t\t//@ts-ignore\\\n\t\tif (data[i].metadataUi?.metadataValues) {\n\t\t\t//@ts-ignore\n\t\t\tdata[i].meta_data = data[i].metadataUi.metadataValues;\n\t\t\t//@ts-ignore\n\t\t\tdelete data[i].metadataUi;\n\t\t} else {\n\t\t\t//@ts-ignore\n\t\t\tdelete data[i].metadataUi;\n\t\t}\n\t}\n}\n\nexport function toSnakeCase(\n\tdata: IShoppingLine[] | IFeeLine[] | ILineItem[] | ICouponLine[] | IDataObject,\n) {\n\tif (!Array.isArray(data)) {\n\t\tdata = [data];\n\t}\n\tlet remove = false;\n\tfor (let i = 0; i < data.length; i++) {\n\t\tfor (const key of Object.keys(data[i])) {\n\t\t\t//@ts-ignore\n\t\t\tif (data[i][snakeCase(key)] === undefined) {\n\t\t\t\tremove = true;\n\t\t\t}\n\t\t\t//@ts-ignore\n\t\t\tdata[i][snakeCase(key)] = data[i][key];\n\t\t\tif (remove) {\n\t\t\t\t//@ts-ignore\n\t\t\t\tdelete data[i][key];\n\t\t\t\tremove = false;\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport function setFields(fieldsToSet: IDataObject, body: IDataObject) {\n\tfor (const fields in fieldsToSet) {\n\t\tif (fields === 'tags') {\n\t\t\tbody.tags = (fieldsToSet[fields] as string[]).map((tag) => ({ id: parseInt(tag, 10) }));\n\t\t} else {\n\t\t\tbody[snakeCase(fields.toString())] = fieldsToSet[fields];\n\t\t}\n\t}\n}\n\nexport function adjustMetadata(fields: IDataObject & Metadata) {\n\tif (!fields.meta_data) return fields;\n\n\treturn {\n\t\t...omit(fields, ['meta_data']),\n\t\tmeta_data: fields.meta_data.meta_data_fields,\n\t};\n}\n\ntype Metadata = {\n\tmeta_data?: {\n\t\tmeta_data_fields: Array<{ key: string; value: string }>;\n\t};\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAA0B;AAC1B,oBAA2B;AAC3B,kBAAiB;AAcjB,eAAsB,sBAErB,QACA,UAEA,OAAY,CAAC,GACb,KAAkB,CAAC,GACnB,KACA,SAAsB,CAAC,GACR;AACf,QAAM,cAAc,MAAM,KAAK,eAAe,gBAAgB;AAE9D,MAAI,UAA2B;AAAA,IAC9B;AAAA,IACA;AAAA,IACA;AAAA,IACA,KAAK,OAAO,GAAG,YAAY,GAAG,iBAAiB,QAAQ;AAAA,IACvD,MAAM;AAAA,EACP;AAEA,MAAI,CAAC,OAAO,KAAK,IAAmB,EAAE,QAAQ;AAC7C,WAAO,QAAQ;AAAA,EAChB;AACA,YAAU,OAAO,OAAO,CAAC,GAAG,SAAS,MAAM;AAC3C,SAAO,MAAM,KAAK,QAAQ,0BAA0B,KAAK,MAAM,kBAAkB,OAAO;AACzF;AAEA,eAAsB,8BAErB,QACA,UAEA,OAAY,CAAC,GACb,QAAqB,CAAC,GACP;AACf,QAAM,aAA4B,CAAC;AAEnC,MAAI;AACJ,MAAI;AACJ,QAAM,WAAW;AACjB,KAAG;AACF,mBAAe,MAAM,sBAAsB,KAAK,MAAM,QAAQ,UAAU,MAAM,OAAO,KAAK;AAAA,MACzF,yBAAyB;AAAA,IAC1B,CAAC;AACD,UAAM,QAAQ,aAAa,QAAQ,KAAK,MAAM,GAAG;AACjD,UAAM,WAAW,MAAM,KAAK,CAAC,SAAiB,KAAK,QAAQ,YAAY,MAAM,EAAE;AAC/E,QAAI,UAAU;AACb,YAAM,SAAS,MAAM,GAAG,EAAE,CAAC,EAAE,QAAQ,UAAU,IAAI;AAAA,IACpD;AACA,eAAW,KAAK,MAAM,YAAY,aAAa,IAAqB;AAAA,EACrE,SAAS,aAAa,QAAQ,MAAM,SAAS,YAAY;AAEzD,SAAO;AACR;AAMO,SAAS,mBAAmB,aAA6C;AAC/E,QAAM,OAAO,GAAG,YAAY,WAAW,IAAI,YAAY,cAAc;AACrE,aAAO,0BAAW,KAAK,EAAE,OAAO,IAAI,EAAE,OAAO,KAAK;AACnD;AAEO,SAAS,YAAY,MAAkE;AAC7F,WAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AAErC,QAAI,KAAK,CAAC,EAAE,YAAY,gBAAgB;AAEvC,WAAK,CAAC,EAAE,YAAY,KAAK,CAAC,EAAE,WAAW;AAEvC,aAAO,KAAK,CAAC,EAAE;AAAA,IAChB,OAAO;AAEN,aAAO,KAAK,CAAC,EAAE;AAAA,IAChB;AAAA,EACD;AACD;AAEO,SAAS,YACf,MACC;AACD,MAAI,CAAC,MAAM,QAAQ,IAAI,GAAG;AACzB,WAAO,CAAC,IAAI;AAAA,EACb;AACA,MAAI,SAAS;AACb,WAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACrC,eAAW,OAAO,OAAO,KAAK,KAAK,CAAC,CAAC,GAAG;AAEvC,UAAI,KAAK,CAAC,MAAE,8BAAU,GAAG,CAAC,MAAM,QAAW;AAC1C,iBAAS;AAAA,MACV;AAEA,WAAK,CAAC,MAAE,8BAAU,GAAG,CAAC,IAAI,KAAK,CAAC,EAAE,GAAG;AACrC,UAAI,QAAQ;AAEX,eAAO,KAAK,CAAC,EAAE,GAAG;AAClB,iBAAS;AAAA,MACV;AAAA,IACD;AAAA,EACD;AACD;AAEO,SAAS,UAAU,aAA0B,MAAmB;AACtE,aAAW,UAAU,aAAa;AACjC,QAAI,WAAW,QAAQ;AACtB,WAAK,OAAQ,YAAY,MAAM,EAAe,IAAI,CAAC,SAAS,EAAE,IAAI,SAAS,KAAK,EAAE,EAAE,EAAE;AAAA,IACvF,OAAO;AACN,eAAK,8BAAU,OAAO,SAAS,CAAC,CAAC,IAAI,YAAY,MAAM;AAAA,IACxD;AAAA,EACD;AACD;AAEO,SAAS,eAAe,QAAgC;AAC9D,MAAI,CAAC,OAAO,UAAW,QAAO;AAE9B,SAAO;AAAA,IACN,OAAG,YAAAA,SAAK,QAAQ,CAAC,WAAW,CAAC;AAAA,IAC7B,WAAW,OAAO,UAAU;AAAA,EAC7B;AACD;","names":["omit"]}