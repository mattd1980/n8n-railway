{"version":3,"sources":["../../../nodes/Egoi/GenericFunctions.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tIHookFunctions,\n\tILoadOptionsFunctions,\n\tJsonObject,\n\tIRequestOptions,\n\tIHttpRequestMethods,\n} from 'n8n-workflow';\nimport { NodeApiError } from 'n8n-workflow';\n\ninterface IContact {\n\ttags: [];\n\tbase: IDataObject;\n\textra: IDataObject[];\n}\n\nconst fieldCache: {\n\t[key: string]: IDataObject[];\n} = {};\n\nexport async function egoiApiRequest(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions,\n\tmethod: IHttpRequestMethods,\n\tendpoint: string,\n\n\tbody: any = {},\n\tqs: IDataObject = {},\n\t_headers?: object,\n): Promise<any> {\n\tconst credentials = await this.getCredentials('egoiApi');\n\n\tconst options: IRequestOptions = {\n\t\theaders: {\n\t\t\taccept: 'application/json',\n\t\t\tApikey: `${credentials.apiKey}`,\n\t\t},\n\t\tmethod,\n\t\tqs,\n\t\tbody,\n\t\turl: `https://api.egoiapp.com${endpoint}`,\n\t\tjson: true,\n\t};\n\n\tif (Object.keys(body as IDataObject).length === 0) {\n\t\tdelete options.body;\n\t}\n\n\ttry {\n\t\treturn await this.helpers.request(options);\n\t} catch (error) {\n\t\tthrow new NodeApiError(this.getNode(), error as JsonObject);\n\t}\n}\n\nexport async function getFields(this: IExecuteFunctions, listId: string) {\n\tif (fieldCache[listId]) {\n\t\treturn fieldCache[listId];\n\t}\n\tfieldCache[listId] = await egoiApiRequest.call(this, 'GET', `/lists/${listId}/fields`);\n\treturn fieldCache[listId];\n}\n\nexport async function egoiApiRequestAllItems(\n\tthis: IExecuteFunctions | ILoadOptionsFunctions,\n\tpropertyName: string,\n\tmethod: IHttpRequestMethods,\n\tendpoint: string,\n\n\tbody: any = {},\n\tquery: IDataObject = {},\n): Promise<any> {\n\tconst returnData: IDataObject[] = [];\n\n\tlet responseData;\n\n\tquery.offset = 0;\n\tquery.count = 500;\n\n\tdo {\n\t\tresponseData = await egoiApiRequest.call(this, method, endpoint, body, query);\n\t\treturnData.push.apply(returnData, responseData[propertyName] as IDataObject[]);\n\t\tquery.offset += query.count;\n\t} while (responseData[propertyName] && responseData[propertyName].length !== 0);\n\n\treturn returnData;\n}\n\nexport async function simplify(this: IExecuteFunctions, contacts: IContact[], listId: string) {\n\tlet fields = await getFields.call(this, listId);\n\n\tfields = fields.filter((element: IDataObject) => element.type === 'extra');\n\tconst fieldsKeyValue: IDataObject = {};\n\tfor (const field of fields) {\n\t\tfieldsKeyValue[field.field_id as string] = field.name;\n\t}\n\n\tconst data: IDataObject[] = [];\n\n\tfor (const contact of contacts) {\n\t\tconst extras = contact.extra.reduce(\n\t\t\t(accumulator: IDataObject, currentValue: IDataObject): any => {\n\t\t\t\tconst key = fieldsKeyValue[currentValue.field_id as string] as string;\n\t\t\t\treturn { [key]: currentValue.value, ...accumulator };\n\t\t\t},\n\t\t\t{},\n\t\t);\n\t\tdata.push({\n\t\t\t...contact.base,\n\t\t\t...extras,\n\t\t\ttags: contact.tags,\n\t\t});\n\t}\n\n\treturn data;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA,0BAA6B;AAQ7B,MAAM,aAEF,CAAC;AAEL,eAAsB,eAErB,QACA,UAEA,OAAY,CAAC,GACb,KAAkB,CAAC,GACnB,UACe;AACf,QAAM,cAAc,MAAM,KAAK,eAAe,SAAS;AAEvD,QAAM,UAA2B;AAAA,IAChC,SAAS;AAAA,MACR,QAAQ;AAAA,MACR,QAAQ,GAAG,YAAY,MAAM;AAAA,IAC9B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,KAAK,0BAA0B,QAAQ;AAAA,IACvC,MAAM;AAAA,EACP;AAEA,MAAI,OAAO,KAAK,IAAmB,EAAE,WAAW,GAAG;AAClD,WAAO,QAAQ;AAAA,EAChB;AAEA,MAAI;AACH,WAAO,MAAM,KAAK,QAAQ,QAAQ,OAAO;AAAA,EAC1C,SAAS,OAAO;AACf,UAAM,IAAI,iCAAa,KAAK,QAAQ,GAAG,KAAmB;AAAA,EAC3D;AACD;AAEA,eAAsB,UAAmC,QAAgB;AACxE,MAAI,WAAW,MAAM,GAAG;AACvB,WAAO,WAAW,MAAM;AAAA,EACzB;AACA,aAAW,MAAM,IAAI,MAAM,eAAe,KAAK,MAAM,OAAO,UAAU,MAAM,SAAS;AACrF,SAAO,WAAW,MAAM;AACzB;AAEA,eAAsB,uBAErB,cACA,QACA,UAEA,OAAY,CAAC,GACb,QAAqB,CAAC,GACP;AACf,QAAM,aAA4B,CAAC;AAEnC,MAAI;AAEJ,QAAM,SAAS;AACf,QAAM,QAAQ;AAEd,KAAG;AACF,mBAAe,MAAM,eAAe,KAAK,MAAM,QAAQ,UAAU,MAAM,KAAK;AAC5E,eAAW,KAAK,MAAM,YAAY,aAAa,YAAY,CAAkB;AAC7E,UAAM,UAAU,MAAM;AAAA,EACvB,SAAS,aAAa,YAAY,KAAK,aAAa,YAAY,EAAE,WAAW;AAE7E,SAAO;AACR;AAEA,eAAsB,SAAkC,UAAsB,QAAgB;AAC7F,MAAI,SAAS,MAAM,UAAU,KAAK,MAAM,MAAM;AAE9C,WAAS,OAAO,OAAO,CAAC,YAAyB,QAAQ,SAAS,OAAO;AACzE,QAAM,iBAA8B,CAAC;AACrC,aAAW,SAAS,QAAQ;AAC3B,mBAAe,MAAM,QAAkB,IAAI,MAAM;AAAA,EAClD;AAEA,QAAM,OAAsB,CAAC;AAE7B,aAAW,WAAW,UAAU;AAC/B,UAAM,SAAS,QAAQ,MAAM;AAAA,MAC5B,CAAC,aAA0B,iBAAmC;AAC7D,cAAM,MAAM,eAAe,aAAa,QAAkB;AAC1D,eAAO,EAAE,CAAC,GAAG,GAAG,aAAa,OAAO,GAAG,YAAY;AAAA,MACpD;AAAA,MACA,CAAC;AAAA,IACF;AACA,SAAK,KAAK;AAAA,MACT,GAAG,QAAQ;AAAA,MACX,GAAG;AAAA,MACH,MAAM,QAAQ;AAAA,IACf,CAAC;AAAA,EACF;AAEA,SAAO;AACR;","names":[]}