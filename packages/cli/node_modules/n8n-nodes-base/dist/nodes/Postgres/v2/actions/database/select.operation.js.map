{"version":3,"sources":["../../../../../../nodes/Postgres/v2/actions/database/select.operation.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tINodeExecutionData,\n\tINodeProperties,\n} from 'n8n-workflow';\n\nimport { updateDisplayOptions } from '@utils/utilities';\n\nimport type {\n\tPgpDatabase,\n\tPostgresNodeOptions,\n\tQueriesRunner,\n\tQueryValues,\n\tQueryWithValues,\n\tSortRule,\n\tWhereClause,\n} from '../../helpers/interfaces';\nimport { addSortRules, addWhereClauses, replaceEmptyStringsByNulls } from '../../helpers/utils';\nimport {\n\tcombineConditionsCollection,\n\toptionsCollection,\n\tsortFixedCollection,\n\twhereFixedCollection,\n} from '../common.descriptions';\n\nconst properties: INodeProperties[] = [\n\t{\n\t\tdisplayName: 'Return All',\n\t\tname: 'returnAll',\n\t\ttype: 'boolean',\n\t\tdefault: false,\n\t\tdescription: 'Whether to return all results or only up to a given limit',\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\tresource: ['event'],\n\t\t\t\toperation: ['getAll'],\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tdisplayName: 'Limit',\n\t\tname: 'limit',\n\t\ttype: 'number',\n\t\tdefault: 50,\n\t\tdescription: 'Max number of results to return',\n\t\ttypeOptions: {\n\t\t\tminValue: 1,\n\t\t},\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\treturnAll: [false],\n\t\t\t},\n\t\t},\n\t},\n\twhereFixedCollection,\n\tcombineConditionsCollection,\n\tsortFixedCollection,\n\toptionsCollection,\n];\n\nconst displayOptions = {\n\tshow: {\n\t\tresource: ['database'],\n\t\toperation: ['select'],\n\t},\n\thide: {\n\t\ttable: [''],\n\t},\n};\n\nexport const description = updateDisplayOptions(displayOptions, properties);\n\nexport async function execute(\n\tthis: IExecuteFunctions,\n\trunQueries: QueriesRunner,\n\titems: INodeExecutionData[],\n\tnodeOptions: PostgresNodeOptions,\n\t_db?: PgpDatabase,\n): Promise<INodeExecutionData[]> {\n\titems = replaceEmptyStringsByNulls(items, nodeOptions.replaceEmptyStrings as boolean);\n\n\tconst queries: QueryWithValues[] = [];\n\n\tfor (let i = 0; i < items.length; i++) {\n\t\tconst schema = this.getNodeParameter('schema', i, undefined, {\n\t\t\textractValue: true,\n\t\t}) as string;\n\n\t\tconst table = this.getNodeParameter('table', i, undefined, {\n\t\t\textractValue: true,\n\t\t}) as string;\n\n\t\tlet values: QueryValues = [schema, table];\n\n\t\tconst outputColumns = this.getNodeParameter('options.outputColumns', i, ['*']) as string[];\n\n\t\tlet query = '';\n\n\t\tif (outputColumns.includes('*')) {\n\t\t\tquery = 'SELECT * FROM $1:name.$2:name';\n\t\t} else {\n\t\t\tvalues.push(outputColumns);\n\t\t\tquery = `SELECT $${values.length}:name FROM $1:name.$2:name`;\n\t\t}\n\n\t\tconst whereClauses =\n\t\t\t((this.getNodeParameter('where', i, []) as IDataObject).values as WhereClause[]) || [];\n\n\t\tconst combineConditions = this.getNodeParameter('combineConditions', i, 'AND') as string;\n\n\t\t[query, values] = addWhereClauses(\n\t\t\tthis.getNode(),\n\t\t\ti,\n\t\t\tquery,\n\t\t\twhereClauses,\n\t\t\tvalues,\n\t\t\tcombineConditions,\n\t\t);\n\n\t\tconst sortRules =\n\t\t\t((this.getNodeParameter('sort', i, []) as IDataObject).values as SortRule[]) || [];\n\n\t\t[query, values] = addSortRules(query, sortRules, values);\n\n\t\tconst returnAll = this.getNodeParameter('returnAll', i, false);\n\t\tif (!returnAll) {\n\t\t\tconst limit = this.getNodeParameter('limit', i, 50);\n\t\t\tquery += ` LIMIT ${limit}`;\n\t\t}\n\n\t\tconst queryWithValues = { query, values };\n\t\tqueries.push(queryWithValues);\n\t}\n\n\treturn await runQueries(queries, items, nodeOptions);\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA,uBAAqC;AAWrC,mBAA0E;AAC1E,oBAKO;AAEP,MAAM,aAAgC;AAAA,EACrC;AAAA,IACC,aAAa;AAAA,IACb,MAAM;AAAA,IACN,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,gBAAgB;AAAA,MACf,MAAM;AAAA,QACL,UAAU,CAAC,OAAO;AAAA,QAClB,WAAW,CAAC,QAAQ;AAAA,MACrB;AAAA,IACD;AAAA,EACD;AAAA,EACA;AAAA,IACC,aAAa;AAAA,IACb,MAAM;AAAA,IACN,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,aAAa;AAAA,MACZ,UAAU;AAAA,IACX;AAAA,IACA,gBAAgB;AAAA,MACf,MAAM;AAAA,QACL,WAAW,CAAC,KAAK;AAAA,MAClB;AAAA,IACD;AAAA,EACD;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACD;AAEA,MAAM,iBAAiB;AAAA,EACtB,MAAM;AAAA,IACL,UAAU,CAAC,UAAU;AAAA,IACrB,WAAW,CAAC,QAAQ;AAAA,EACrB;AAAA,EACA,MAAM;AAAA,IACL,OAAO,CAAC,EAAE;AAAA,EACX;AACD;AAEO,MAAM,kBAAc,uCAAqB,gBAAgB,UAAU;AAE1E,eAAsB,QAErB,YACA,OACA,aACA,KACgC;AAChC,cAAQ,yCAA2B,OAAO,YAAY,mBAA8B;AAEpF,QAAM,UAA6B,CAAC;AAEpC,WAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACtC,UAAM,SAAS,KAAK,iBAAiB,UAAU,GAAG,QAAW;AAAA,MAC5D,cAAc;AAAA,IACf,CAAC;AAED,UAAM,QAAQ,KAAK,iBAAiB,SAAS,GAAG,QAAW;AAAA,MAC1D,cAAc;AAAA,IACf,CAAC;AAED,QAAI,SAAsB,CAAC,QAAQ,KAAK;AAExC,UAAM,gBAAgB,KAAK,iBAAiB,yBAAyB,GAAG,CAAC,GAAG,CAAC;AAE7E,QAAI,QAAQ;AAEZ,QAAI,cAAc,SAAS,GAAG,GAAG;AAChC,cAAQ;AAAA,IACT,OAAO;AACN,aAAO,KAAK,aAAa;AACzB,cAAQ,WAAW,OAAO,MAAM;AAAA,IACjC;AAEA,UAAM,eACH,KAAK,iBAAiB,SAAS,GAAG,CAAC,CAAC,EAAkB,UAA4B,CAAC;AAEtF,UAAM,oBAAoB,KAAK,iBAAiB,qBAAqB,GAAG,KAAK;AAE7E,KAAC,OAAO,MAAM,QAAI;AAAA,MACjB,KAAK,QAAQ;AAAA,MACb;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACD;AAEA,UAAM,YACH,KAAK,iBAAiB,QAAQ,GAAG,CAAC,CAAC,EAAkB,UAAyB,CAAC;AAElF,KAAC,OAAO,MAAM,QAAI,2BAAa,OAAO,WAAW,MAAM;AAEvD,UAAM,YAAY,KAAK,iBAAiB,aAAa,GAAG,KAAK;AAC7D,QAAI,CAAC,WAAW;AACf,YAAM,QAAQ,KAAK,iBAAiB,SAAS,GAAG,EAAE;AAClD,eAAS,UAAU,KAAK;AAAA,IACzB;AAEA,UAAM,kBAAkB,EAAE,OAAO,OAAO;AACxC,YAAQ,KAAK,eAAe;AAAA,EAC7B;AAEA,SAAO,MAAM,WAAW,SAAS,OAAO,WAAW;AACpD;","names":[]}