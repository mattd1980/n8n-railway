{"version":3,"sources":["../../../nodes/Webflow/GenericFunctions.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tIHookFunctions,\n\tILoadOptionsFunctions,\n\tIWebhookFunctions,\n\tIHttpRequestMethods,\n\tIHttpRequestOptions,\n\tINodePropertyOptions,\n} from 'n8n-workflow';\n\nexport async function webflowApiRequest(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n\tmethod: IHttpRequestMethods,\n\tresource: string,\n\tbody: IDataObject = {},\n\tqs: IDataObject = {},\n\turi?: string,\n\toption: IDataObject = {},\n) {\n\tlet credentialsType = 'webflowOAuth2Api';\n\n\tlet options: IHttpRequestOptions = {\n\t\tmethod,\n\t\tqs,\n\t\tbody,\n\t\turl: uri || `https://api.webflow.com${resource}`,\n\t\tjson: true,\n\t};\n\toptions = Object.assign({}, options, option);\n\n\t// Keep support for v1 node\n\tif (this.getNode().typeVersion === 1) {\n\t\tconst authenticationMethod = this.getNodeParameter('authentication', 0, 'accessToken');\n\t\tif (authenticationMethod === 'accessToken') {\n\t\t\tcredentialsType = 'webflowApi';\n\t\t}\n\t\toptions.headers = { 'accept-version': '1.0.0' };\n\t} else {\n\t\toptions.returnFullResponse = true;\n\t\toptions.url = `https://api.webflow.com/v2${resource}`;\n\t}\n\n\tif (Object.keys(options.qs as IDataObject).length === 0) {\n\t\tdelete options.qs;\n\t}\n\n\tif (Object.keys(options.body as IDataObject).length === 0) {\n\t\tdelete options.body;\n\t}\n\treturn await this.helpers.httpRequestWithAuthentication.call(this, credentialsType, options);\n}\n\nexport async function webflowApiRequestAllItems(\n\tthis: IExecuteFunctions | ILoadOptionsFunctions,\n\tmethod: IHttpRequestMethods,\n\tendpoint: string,\n\tbody: IDataObject = {},\n\tquery: IDataObject = {},\n): Promise<IDataObject[]> {\n\tconst returnData: IDataObject[] = [];\n\tlet responseData;\n\n\tquery.limit = 100;\n\tquery.offset = 0;\n\n\tconst isTypeVersion1 = this.getNode().typeVersion === 1;\n\n\tdo {\n\t\tresponseData = await webflowApiRequest.call(this, method, endpoint, body, query);\n\t\tconst items = isTypeVersion1 ? responseData.items : responseData.body.items;\n\t\treturnData.push(...(items as IDataObject[]));\n\n\t\tif (responseData.offset !== undefined || responseData?.body?.pagination?.offset !== undefined) {\n\t\t\tquery.offset += query.limit;\n\t\t}\n\t} while (\n\t\tisTypeVersion1\n\t\t\t? returnData.length < responseData.total\n\t\t\t: returnData.length < responseData.body.pagination.total\n\t);\n\n\treturn returnData;\n}\n// Load Options\nexport async function getSites(this: ILoadOptionsFunctions): Promise<INodePropertyOptions[]> {\n\tconst returnData: INodePropertyOptions[] = [];\n\tconst response = await webflowApiRequest.call(this, 'GET', '/sites');\n\n\tconst sites = response.body?.sites || response;\n\n\tfor (const site of sites) {\n\t\treturnData.push({\n\t\t\tname: site.displayName || site.name,\n\t\t\tvalue: site.id || site._id,\n\t\t});\n\t}\n\treturn returnData;\n}\nexport async function getCollections(this: ILoadOptionsFunctions): Promise<INodePropertyOptions[]> {\n\tconst returnData: INodePropertyOptions[] = [];\n\tconst siteId = this.getCurrentNodeParameter('siteId');\n\tconst response = await webflowApiRequest.call(this, 'GET', `/sites/${siteId}/collections`);\n\n\tconst collections = response.body?.collections || response;\n\n\tfor (const collection of collections) {\n\t\treturnData.push({\n\t\t\tname: collection.displayName || collection.name,\n\t\t\tvalue: collection.id || collection._id,\n\t\t});\n\t}\n\treturn returnData;\n}\nexport async function getFields(this: ILoadOptionsFunctions): Promise<INodePropertyOptions[]> {\n\tconst returnData: INodePropertyOptions[] = [];\n\tconst collectionId = this.getCurrentNodeParameter('collectionId');\n\tconst response = await webflowApiRequest.call(this, 'GET', `/collections/${collectionId}`);\n\n\tconst fields = response.body?.fields || response;\n\n\tfor (const field of fields) {\n\t\treturnData.push({\n\t\t\tname: `${field.displayName || field.name} (${field.type}) ${field.isRequired || field.required ? ' (required)' : ''}`,\n\t\t\tvalue: field.slug,\n\t\t});\n\t}\n\treturn returnData;\n}\n"],"mappings":"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","names":[]}