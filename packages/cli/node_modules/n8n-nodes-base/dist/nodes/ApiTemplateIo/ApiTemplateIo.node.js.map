{"version":3,"sources":["../../../nodes/ApiTemplateIo/ApiTemplateIo.node.ts"],"sourcesContent":["import type {\n\tIExecuteFunctions,\n\tIDataObject,\n\tILoadOptionsFunctions,\n\tINodeExecutionData,\n\tINodePropertyOptions,\n\tINodeType,\n\tINodeTypeDescription,\n} from 'n8n-workflow';\nimport { NodeConnectionTypes, NodeOperationError } from 'n8n-workflow';\n\nimport {\n\tapiTemplateIoApiRequest,\n\tdownloadImage,\n\tloadResource,\n\tvalidateJSON,\n} from './GenericFunctions';\n\nexport class ApiTemplateIo implements INodeType {\n\tdescription: INodeTypeDescription = {\n\t\tdisplayName: 'APITemplate.io',\n\t\tname: 'apiTemplateIo',\n\t\ticon: 'file:apiTemplateIo.svg',\n\t\tgroup: ['transform'],\n\t\tversion: 1,\n\t\tdescription: 'Consume the APITemplate.io API',\n\t\tsubtitle: '={{$parameter[\"operation\"] + \": \" + $parameter[\"resource\"]}}',\n\t\tdefaults: {\n\t\t\tname: 'APITemplate.io',\n\t\t},\n\t\tusableAsTool: true,\n\t\tinputs: [NodeConnectionTypes.Main],\n\t\toutputs: [NodeConnectionTypes.Main],\n\t\tcredentials: [\n\t\t\t{\n\t\t\t\tname: 'apiTemplateIoApi',\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tdisplayName: 'Resource',\n\t\t\t\tname: 'resource',\n\t\t\t\ttype: 'options',\n\t\t\t\tnoDataExpression: true,\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Account',\n\t\t\t\t\t\tvalue: 'account',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Image',\n\t\t\t\t\t\tvalue: 'image',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'PDF',\n\t\t\t\t\t\tvalue: 'pdf',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdefault: 'image',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Operation',\n\t\t\t\tname: 'operation',\n\t\t\t\ttype: 'options',\n\t\t\t\tnoDataExpression: true,\n\t\t\t\tdefault: 'create',\n\t\t\t\trequired: true,\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Create',\n\t\t\t\t\t\tvalue: 'create',\n\t\t\t\t\t\taction: 'Create an image',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresource: ['image'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Operation',\n\t\t\t\tname: 'operation',\n\t\t\t\ttype: 'options',\n\t\t\t\tnoDataExpression: true,\n\t\t\t\tdefault: 'create',\n\t\t\t\trequired: true,\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Create',\n\t\t\t\t\t\tvalue: 'create',\n\t\t\t\t\t\taction: 'Create a pdf',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresource: ['pdf'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Operation',\n\t\t\t\tname: 'operation',\n\t\t\t\ttype: 'options',\n\t\t\t\tnoDataExpression: true,\n\t\t\t\tdefault: 'get',\n\t\t\t\trequired: true,\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Get',\n\t\t\t\t\t\tvalue: 'get',\n\t\t\t\t\t\taction: 'Get an account',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresource: ['account'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Template Name or ID',\n\t\t\t\tname: 'imageTemplateId',\n\t\t\t\ttype: 'options',\n\t\t\t\trequired: true,\n\t\t\t\tdefault: '',\n\t\t\t\tdescription:\n\t\t\t\t\t'ID of the image template to use. Choose from the list, or specify an ID using an <a href=\"https://docs.n8n.io/code/expressions/\">expression</a>.',\n\t\t\t\ttypeOptions: {\n\t\t\t\t\tloadOptionsMethod: 'getImageTemplates',\n\t\t\t\t},\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresource: ['image'],\n\t\t\t\t\t\toperation: ['create'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Template Name or ID',\n\t\t\t\tname: 'pdfTemplateId',\n\t\t\t\ttype: 'options',\n\t\t\t\trequired: true,\n\t\t\t\tdefault: '',\n\t\t\t\tdescription:\n\t\t\t\t\t'ID of the PDF template to use. Choose from the list, or specify an ID using an <a href=\"https://docs.n8n.io/code/expressions/\">expression</a>.',\n\t\t\t\ttypeOptions: {\n\t\t\t\t\tloadOptionsMethod: 'getPdfTemplates',\n\t\t\t\t},\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresource: ['pdf'],\n\t\t\t\t\t\toperation: ['create'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'JSON Parameters',\n\t\t\t\tname: 'jsonParameters',\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdefault: false,\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresource: ['pdf', 'image'],\n\t\t\t\t\t\toperation: ['create'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Download',\n\t\t\t\tname: 'download',\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdefault: false,\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresource: ['pdf', 'image'],\n\t\t\t\t\t\toperation: ['create'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t// eslint-disable-next-line n8n-nodes-base/node-param-description-boolean-without-whether\n\t\t\t\tdescription: 'Name of the binary property to which to write the data of the read file',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Put Output File in Field',\n\t\t\t\tname: 'binaryProperty',\n\t\t\t\ttype: 'string',\n\t\t\t\trequired: true,\n\t\t\t\tdefault: 'data',\n\t\t\t\thint: 'The name of the output binary field to put the file in',\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresource: ['pdf', 'image'],\n\t\t\t\t\t\toperation: ['create'],\n\t\t\t\t\t\tdownload: [true],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Overrides (JSON)',\n\t\t\t\tname: 'overridesJson',\n\t\t\t\ttype: 'json',\n\t\t\t\tdefault: '',\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresource: ['image'],\n\t\t\t\t\t\toperation: ['create'],\n\t\t\t\t\t\tjsonParameters: [true],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tplaceholder:\n\t\t\t\t\t'[ {\"name\": \"text_1\", \"text\": \"hello world\", \"textBackgroundColor\": \"rgba(246, 243, 243, 0)\" } ]',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Properties (JSON)',\n\t\t\t\tname: 'propertiesJson',\n\t\t\t\ttype: 'json',\n\t\t\t\tdefault: '',\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresource: ['pdf'],\n\t\t\t\t\t\toperation: ['create'],\n\t\t\t\t\t\tjsonParameters: [true],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tplaceholder: '{ \"name\": \"text_1\" }',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Overrides',\n\t\t\t\tname: 'overridesUi',\n\t\t\t\tplaceholder: 'Add Override',\n\t\t\t\ttype: 'fixedCollection',\n\t\t\t\ttypeOptions: {\n\t\t\t\t\tmultipleValues: true,\n\t\t\t\t},\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresource: ['image'],\n\t\t\t\t\t\toperation: ['create'],\n\t\t\t\t\t\tjsonParameters: [false],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdefault: {},\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'overrideValues',\n\t\t\t\t\t\tdisplayName: 'Override',\n\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdisplayName: 'Properties',\n\t\t\t\t\t\t\t\tname: 'propertiesUi',\n\t\t\t\t\t\t\t\tplaceholder: 'Add Property',\n\t\t\t\t\t\t\t\ttype: 'fixedCollection',\n\t\t\t\t\t\t\t\ttypeOptions: {\n\t\t\t\t\t\t\t\t\tmultipleValues: true,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdefault: {},\n\t\t\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'propertyValues',\n\t\t\t\t\t\t\t\t\t\tdisplayName: 'Property',\n\t\t\t\t\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tdisplayName: 'Key',\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'key',\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: 'Name of the property',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tdisplayName: 'Value',\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'value',\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: 'Value to the property',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Properties',\n\t\t\t\tname: 'propertiesUi',\n\t\t\t\tplaceholder: 'Add Property',\n\t\t\t\ttype: 'fixedCollection',\n\t\t\t\ttypeOptions: {\n\t\t\t\t\tmultipleValues: true,\n\t\t\t\t},\n\t\t\t\tdefault: {},\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresource: ['pdf'],\n\t\t\t\t\t\toperation: ['create'],\n\t\t\t\t\t\tjsonParameters: [false],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'propertyValues',\n\t\t\t\t\t\tdisplayName: 'Property',\n\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdisplayName: 'Key',\n\t\t\t\t\t\t\t\tname: 'key',\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t\t\t\tdescription: 'Name of the property',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdisplayName: 'Value',\n\t\t\t\t\t\t\t\tname: 'value',\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t\t\t\tdescription: 'Value to the property',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Options',\n\t\t\t\tname: 'options',\n\t\t\t\ttype: 'collection',\n\t\t\t\tplaceholder: 'Add Field',\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\toperation: ['create'],\n\t\t\t\t\t\tresource: ['pdf', 'image'],\n\t\t\t\t\t\tdownload: [true],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdefault: {},\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tdisplayName: 'File Name',\n\t\t\t\t\t\tname: 'fileName',\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'The name of the downloaded image/pdf. It has to include the extension. For example: report.pdf',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t],\n\t};\n\n\tmethods = {\n\t\tloadOptions: {\n\t\t\tasync getImageTemplates(this: ILoadOptionsFunctions): Promise<INodePropertyOptions[]> {\n\t\t\t\treturn await loadResource.call(this, 'image');\n\t\t\t},\n\n\t\t\tasync getPdfTemplates(this: ILoadOptionsFunctions): Promise<INodePropertyOptions[]> {\n\t\t\t\treturn await loadResource.call(this, 'pdf');\n\t\t\t},\n\t\t},\n\t};\n\n\tasync execute(this: IExecuteFunctions) {\n\t\tconst items = this.getInputData();\n\t\tconst returnData: IDataObject[] = [];\n\t\tconst length = items.length;\n\n\t\tlet responseData;\n\n\t\tconst resource = this.getNodeParameter('resource', 0);\n\t\tconst operation = this.getNodeParameter('operation', 0);\n\n\t\tif (resource === 'account') {\n\t\t\t// *********************************************************************\n\t\t\t//                               account\n\t\t\t// *********************************************************************\n\n\t\t\tif (operation === 'get') {\n\t\t\t\t// ----------------------------------\n\t\t\t\t//         account: get\n\t\t\t\t// ----------------------------------\n\n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tresponseData = await apiTemplateIoApiRequest.call(this, 'GET', '/account-information');\n\n\t\t\t\t\t\treturnData.push(responseData as IDataObject);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tif (this.continueOnFail()) {\n\t\t\t\t\t\t\treturnData.push({ json: { error: error.message } });\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthrow error;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (resource === 'image') {\n\t\t\t// *********************************************************************\n\t\t\t//                               image\n\t\t\t// *********************************************************************\n\n\t\t\tif (operation === 'create') {\n\t\t\t\t// ----------------------------------\n\t\t\t\t//          image: create\n\t\t\t\t// ----------------------------------\n\n\t\t\t\tconst download = this.getNodeParameter('download', 0);\n\n\t\t\t\t// https://docs.apitemplate.io/reference/api-reference.html#create-an-image-jpeg-and-png\n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst jsonParameters = this.getNodeParameter('jsonParameters', i);\n\n\t\t\t\t\t\tlet options: IDataObject = {};\n\t\t\t\t\t\tif (download) {\n\t\t\t\t\t\t\toptions = this.getNodeParameter('options', i);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst qs = {\n\t\t\t\t\t\t\ttemplate_id: this.getNodeParameter('imageTemplateId', i),\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tconst body = { overrides: [] } as IDataObject;\n\n\t\t\t\t\t\tif (!jsonParameters) {\n\t\t\t\t\t\t\tconst overrides =\n\t\t\t\t\t\t\t\t((this.getNodeParameter('overridesUi', i) as IDataObject)\n\t\t\t\t\t\t\t\t\t?.overrideValues as IDataObject[]) || [];\n\t\t\t\t\t\t\tif (overrides.length !== 0) {\n\t\t\t\t\t\t\t\tconst data: IDataObject[] = [];\n\t\t\t\t\t\t\t\tfor (const override of overrides) {\n\t\t\t\t\t\t\t\t\tconst properties =\n\t\t\t\t\t\t\t\t\t\t((override.propertiesUi as IDataObject)?.propertyValues as IDataObject[]) || [];\n\t\t\t\t\t\t\t\t\tdata.push(\n\t\t\t\t\t\t\t\t\t\tproperties.reduce(\n\t\t\t\t\t\t\t\t\t\t\t(obj, value) => Object.assign(obj, { [`${value.key}`]: value.value }),\n\t\t\t\t\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbody.overrides = data;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst overrideJson = this.getNodeParameter('overridesJson', i) as string;\n\t\t\t\t\t\t\tif (overrideJson !== '') {\n\t\t\t\t\t\t\t\tconst data = validateJSON(overrideJson);\n\t\t\t\t\t\t\t\tif (data === undefined) {\n\t\t\t\t\t\t\t\t\tthrow new NodeOperationError(this.getNode(), 'A valid JSON must be provided.', {\n\t\t\t\t\t\t\t\t\t\titemIndex: i,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbody.overrides = data;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresponseData = await apiTemplateIoApiRequest.call(this, 'POST', '/create', qs, body);\n\n\t\t\t\t\t\tif (download) {\n\t\t\t\t\t\t\tconst binaryProperty = this.getNodeParameter('binaryProperty', i);\n\t\t\t\t\t\t\tconst data = await downloadImage.call(this, responseData.download_url as string);\n\t\t\t\t\t\t\tconst fileName = responseData.download_url.split('/').pop();\n\t\t\t\t\t\t\tconst binaryData = await this.helpers.prepareBinaryData(\n\t\t\t\t\t\t\t\tdata as Buffer,\n\t\t\t\t\t\t\t\t(options.fileName as string) || (fileName as string),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tresponseData = {\n\t\t\t\t\t\t\t\tjson: responseData,\n\t\t\t\t\t\t\t\tbinary: {\n\t\t\t\t\t\t\t\t\t[binaryProperty]: binaryData,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturnData.push(responseData as IDataObject);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tif (this.continueOnFail()) {\n\t\t\t\t\t\t\treturnData.push({ json: { error: error.message } });\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthrow error;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (download) {\n\t\t\t\t\treturn [returnData as unknown as INodeExecutionData[]];\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (resource === 'pdf') {\n\t\t\t// *********************************************************************\n\t\t\t//                               pdf\n\t\t\t// *********************************************************************\n\n\t\t\tif (operation === 'create') {\n\t\t\t\t// ----------------------------------\n\t\t\t\t//          pdf: create\n\t\t\t\t// ----------------------------------\n\n\t\t\t\t// https://docs.apitemplate.io/reference/api-reference.html#create-a-pdf\n\t\t\t\tconst download = this.getNodeParameter('download', 0);\n\n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst jsonParameters = this.getNodeParameter('jsonParameters', i);\n\n\t\t\t\t\t\tlet options: IDataObject = {};\n\t\t\t\t\t\tif (download) {\n\t\t\t\t\t\t\toptions = this.getNodeParameter('options', i);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst qs = {\n\t\t\t\t\t\t\ttemplate_id: this.getNodeParameter('pdfTemplateId', i),\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tlet data;\n\n\t\t\t\t\t\tif (!jsonParameters) {\n\t\t\t\t\t\t\tconst properties =\n\t\t\t\t\t\t\t\t((this.getNodeParameter('propertiesUi', i) as IDataObject)\n\t\t\t\t\t\t\t\t\t?.propertyValues as IDataObject[]) || [];\n\t\t\t\t\t\t\tif (properties.length === 0) {\n\t\t\t\t\t\t\t\tthrow new NodeOperationError(\n\t\t\t\t\t\t\t\t\tthis.getNode(),\n\t\t\t\t\t\t\t\t\t'The parameter properties cannot be empty',\n\t\t\t\t\t\t\t\t\t{ itemIndex: i },\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdata = properties.reduce(\n\t\t\t\t\t\t\t\t(obj, value) => Object.assign(obj, { [`${value.key}`]: value.value }),\n\t\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst propertiesJson = this.getNodeParameter('propertiesJson', i) as string;\n\t\t\t\t\t\t\tdata = validateJSON(propertiesJson);\n\t\t\t\t\t\t\tif (data === undefined) {\n\t\t\t\t\t\t\t\tthrow new NodeOperationError(this.getNode(), 'A valid JSON must be provided.', {\n\t\t\t\t\t\t\t\t\titemIndex: i,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresponseData = await apiTemplateIoApiRequest.call(\n\t\t\t\t\t\t\tthis,\n\t\t\t\t\t\t\t'POST',\n\t\t\t\t\t\t\t'/create',\n\t\t\t\t\t\t\tqs,\n\t\t\t\t\t\t\tdata as IDataObject,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (download) {\n\t\t\t\t\t\t\tconst binaryProperty = this.getNodeParameter('binaryProperty', i);\n\t\t\t\t\t\t\tconst imageData = await downloadImage.call(this, responseData.download_url as string);\n\t\t\t\t\t\t\tconst fileName = responseData.download_url.split('/').pop();\n\t\t\t\t\t\t\tconst binaryData = await this.helpers.prepareBinaryData(\n\t\t\t\t\t\t\t\timageData as Buffer,\n\t\t\t\t\t\t\t\t(options.fileName || fileName) as string,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tresponseData = {\n\t\t\t\t\t\t\t\tjson: responseData,\n\t\t\t\t\t\t\t\tbinary: {\n\t\t\t\t\t\t\t\t\t[binaryProperty]: binaryData,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturnData.push(responseData as IDataObject);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tif (this.continueOnFail()) {\n\t\t\t\t\t\t\treturnData.push({ json: { error: error.message } });\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthrow error;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (download) {\n\t\t\t\t\treturn [returnData as unknown as INodeExecutionData[]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn [this.helpers.returnJsonArray(returnData)];\n\t}\n}\n"],"mappings":"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","names":[]}