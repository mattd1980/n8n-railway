{"version":3,"sources":["../../../../../../nodes/Google/Analytics/v2/transport/index.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tIHttpRequestMethods,\n\tILoadOptionsFunctions,\n\tIRequestOptions,\n\tJsonObject,\n} from 'n8n-workflow';\nimport { NodeApiError } from 'n8n-workflow';\n\nexport async function googleApiRequest(\n\tthis: IExecuteFunctions | ILoadOptionsFunctions,\n\tmethod: IHttpRequestMethods,\n\tendpoint: string,\n\tbody: IDataObject = {},\n\tqs: IDataObject = {},\n\turi?: string,\n\toption: IDataObject = {},\n) {\n\tconst propertyType = this.getNodeParameter('propertyType', 0, 'universal') as string;\n\tconst baseURL =\n\t\tpropertyType === 'ga4'\n\t\t\t? 'https://analyticsdata.googleapis.com'\n\t\t\t: 'https://analyticsreporting.googleapis.com';\n\n\tlet options: IRequestOptions = {\n\t\theaders: {\n\t\t\tAccept: 'application/json',\n\t\t\t'Content-Type': 'application/json',\n\t\t},\n\t\tmethod,\n\t\tbody,\n\t\tqs,\n\t\turi: uri ?? `${baseURL}${endpoint}`,\n\t\tjson: true,\n\t};\n\n\toptions = Object.assign({}, options, option);\n\n\ttry {\n\t\tif (Object.keys(body).length === 0) {\n\t\t\tdelete options.body;\n\t\t}\n\t\tif (Object.keys(qs).length === 0) {\n\t\t\tdelete options.qs;\n\t\t}\n\t\treturn await this.helpers.requestOAuth2.call(this, 'googleAnalyticsOAuth2', options);\n\t} catch (error) {\n\t\tconst errorData = (error.message || '').split(' - ')[1] as string;\n\t\tif (errorData) {\n\t\t\tconst parsedError = JSON.parse(errorData.trim());\n\t\t\tif (parsedError.error?.message) {\n\t\t\t\tconst [message, ...rest] = parsedError.error.message.split('\\n');\n\t\t\t\tconst description = rest.join('\\n');\n\t\t\t\tconst httpCode = parsedError.error.code;\n\t\t\t\tthrow new NodeApiError(this.getNode(), error as JsonObject, {\n\t\t\t\t\tmessage,\n\t\t\t\t\tdescription,\n\t\t\t\t\thttpCode,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthrow new NodeApiError(this.getNode(), error as JsonObject, { message: error.message });\n\t}\n}\n\nexport async function googleApiRequestAllItems(\n\tthis: IExecuteFunctions | ILoadOptionsFunctions,\n\tpropertyName: string,\n\tmethod: IHttpRequestMethods,\n\tendpoint: string,\n\tbody: IDataObject = {},\n\tquery: IDataObject = {},\n\turi?: string,\n) {\n\tconst propertyType = this.getNodeParameter('propertyType', 0, 'universal') as string;\n\tconst returnData: IDataObject[] = [];\n\n\tlet responseData;\n\n\tif (propertyType === 'ga4') {\n\t\tlet rows: IDataObject[] = [];\n\t\tquery.limit = 100000;\n\t\tquery.offset = 0;\n\n\t\tresponseData = await googleApiRequest.call(this, method, endpoint, body, query, uri);\n\t\trows = rows.concat(responseData.rows as IDataObject[]);\n\t\tquery.offset = rows.length;\n\n\t\twhile (responseData.rowCount > rows.length) {\n\t\t\tresponseData = await googleApiRequest.call(this, method, endpoint, body, query, uri);\n\t\t\trows = rows.concat(responseData.rows as IDataObject[]);\n\t\t\tquery.offset = rows.length;\n\t\t}\n\t\tresponseData.rows = rows;\n\t\treturnData.push(responseData as IDataObject);\n\t} else {\n\t\tdo {\n\t\t\tresponseData = await googleApiRequest.call(this, method, endpoint, body, query, uri);\n\t\t\tif (body.reportRequests && Array.isArray(body.reportRequests)) {\n\t\t\t\t(body.reportRequests as IDataObject[])[0].pageToken =\n\t\t\t\t\tresponseData[propertyName][0].nextPageToken;\n\t\t\t} else {\n\t\t\t\tbody.pageToken = responseData.nextPageToken;\n\t\t\t}\n\t\t\treturnData.push.apply(returnData, responseData[propertyName] as IDataObject[]);\n\t\t} while (\n\t\t\t(responseData.nextPageToken !== undefined && responseData.nextPageToken !== '') ||\n\t\t\tresponseData[propertyName]?.[0].nextPageToken !== undefined\n\t\t);\n\t}\n\n\treturn returnData;\n}\n"],"mappings":"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","names":[]}