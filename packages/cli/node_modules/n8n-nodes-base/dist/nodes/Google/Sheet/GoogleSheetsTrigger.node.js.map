{"version":3,"sources":["../../../../nodes/Google/Sheet/GoogleSheetsTrigger.node.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tINodeExecutionData,\n\tINodeType,\n\tINodeTypeDescription,\n\tINodeProperties,\n\tIPollFunctions,\n} from 'n8n-workflow';\nimport { NodeConnectionTypes, NodeOperationError } from 'n8n-workflow';\n\nimport {\n\tarrayOfArraysToJson,\n\tBINARY_MIME_TYPE,\n\tcompareRevisions,\n\tgetRevisionFile,\n\tsheetBinaryToArrayOfArrays,\n} from './GoogleSheetsTrigger.utils';\nimport { GoogleSheet } from './v2/helpers/GoogleSheet';\nimport type { ResourceLocator, ValueRenderOption } from './v2/helpers/GoogleSheets.types';\nimport { sheetsSearch, spreadSheetsSearch } from './v2/methods/listSearch';\nimport { getSheetHeaderRowAndSkipEmpty } from './v2/methods/loadOptions';\nimport { apiRequest } from './v2/transport';\nimport { GOOGLE_DRIVE_FILE_URL_REGEX, GOOGLE_SHEETS_SHEET_URL_REGEX } from '../constants';\n\nexport const document: INodeProperties = {\n\tdisplayName: 'Document',\n\tname: 'documentId',\n\ttype: 'resourceLocator',\n\tdefault: { mode: 'list', value: '' },\n\trequired: true,\n\tmodes: [\n\t\t{\n\t\t\tdisplayName: 'From List',\n\t\t\tname: 'list',\n\t\t\ttype: 'list',\n\t\t\ttypeOptions: {\n\t\t\t\tsearchListMethod: 'spreadSheetsSearch',\n\t\t\t\tsearchable: true,\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tdisplayName: 'By URL',\n\t\t\tname: 'url',\n\t\t\ttype: 'string',\n\t\t\textractValue: {\n\t\t\t\ttype: 'regex',\n\t\t\t\tregex: GOOGLE_DRIVE_FILE_URL_REGEX,\n\t\t\t},\n\t\t\tvalidation: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'regex',\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tregex: GOOGLE_DRIVE_FILE_URL_REGEX,\n\t\t\t\t\t\terrorMessage: 'Not a valid Google Drive File URL',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tdisplayName: 'By ID',\n\t\t\tname: 'id',\n\t\t\ttype: 'string',\n\t\t\tvalidation: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'regex',\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tregex: '[a-zA-Z0-9\\\\-_]{2,}',\n\t\t\t\t\t\terrorMessage: 'Not a valid Google Drive File ID',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\turl: '=https://docs.google.com/spreadsheets/d/{{$value}}/edit',\n\t\t},\n\t],\n};\n\nexport const sheet: INodeProperties = {\n\tdisplayName: 'Sheet',\n\tname: 'sheetName',\n\ttype: 'resourceLocator',\n\tdefault: { mode: 'list', value: '' },\n\t// default: '', //empty string set to progresivly reveal fields\n\trequired: true,\n\ttypeOptions: {\n\t\tloadOptionsDependsOn: ['documentId.value'],\n\t},\n\tmodes: [\n\t\t{\n\t\t\tdisplayName: 'From List',\n\t\t\tname: 'list',\n\t\t\ttype: 'list',\n\t\t\ttypeOptions: {\n\t\t\t\tsearchListMethod: 'sheetsSearch',\n\t\t\t\tsearchable: false,\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tdisplayName: 'By URL',\n\t\t\tname: 'url',\n\t\t\ttype: 'string',\n\t\t\textractValue: {\n\t\t\t\ttype: 'regex',\n\t\t\t\tregex: GOOGLE_SHEETS_SHEET_URL_REGEX,\n\t\t\t},\n\t\t\tvalidation: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'regex',\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tregex: GOOGLE_SHEETS_SHEET_URL_REGEX,\n\t\t\t\t\t\terrorMessage: 'Not a valid Sheet URL',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tdisplayName: 'By ID',\n\t\t\tname: 'id',\n\t\t\ttype: 'string',\n\t\t\tvalidation: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'regex',\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tregex: '((gid=)?[0-9]{1,})',\n\t\t\t\t\t\terrorMessage: 'Not a valid Sheet ID',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t],\n};\n\nexport class GoogleSheetsTrigger implements INodeType {\n\tdescription: INodeTypeDescription = {\n\t\tdisplayName: 'Google Sheets Trigger',\n\t\tname: 'googleSheetsTrigger',\n\t\ticon: 'file:googleSheets.svg',\n\t\tgroup: ['trigger'],\n\t\tversion: 1,\n\t\tsubtitle: '={{($parameter[\"event\"])}}',\n\t\tdescription: 'Starts the workflow when Google Sheets events occur',\n\t\tdefaults: {\n\t\t\tname: 'Google Sheets Trigger',\n\t\t},\n\t\tinputs: [],\n\t\toutputs: [NodeConnectionTypes.Main],\n\t\tcredentials: [\n\t\t\t{\n\t\t\t\tname: 'googleSheetsTriggerOAuth2Api',\n\t\t\t\trequired: true,\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tauthentication: ['triggerOAuth2'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\tpolling: true,\n\t\tproperties: [\n\t\t\t// trigger shared logic with GoogleSheets node, leaving this here for compatibility\n\t\t\t{\n\t\t\t\tdisplayName: 'Authentication',\n\t\t\t\tname: 'authentication',\n\t\t\t\ttype: 'hidden',\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\t// eslint-disable-next-line n8n-nodes-base/node-param-display-name-miscased\n\t\t\t\t\t\tname: 'OAuth2 (recommended)',\n\t\t\t\t\t\tvalue: 'triggerOAuth2',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdefault: 'triggerOAuth2',\n\t\t\t},\n\t\t\tdocument,\n\t\t\tsheet,\n\t\t\t{\n\t\t\t\tdisplayName: 'Trigger On',\n\t\t\t\tname: 'event',\n\t\t\t\ttype: 'options',\n\t\t\t\tdescription:\n\t\t\t\t\t\"It will be triggered also by newly created columns (if the 'Columns to Watch' option is not set)\",\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Row Added',\n\t\t\t\t\t\tvalue: 'rowAdded',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Row Updated',\n\t\t\t\t\t\tvalue: 'rowUpdate',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Row Added or Updated',\n\t\t\t\t\t\tvalue: 'anyUpdate',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdefault: 'anyUpdate',\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Include in Output',\n\t\t\t\tname: 'includeInOutput',\n\t\t\t\ttype: 'options',\n\t\t\t\tdefault: 'new',\n\t\t\t\tdescription: 'This option will be effective only when automatically executing the workflow',\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'New Version',\n\t\t\t\t\t\tvalue: 'new',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Old Version',\n\t\t\t\t\t\tvalue: 'old',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Both Versions',\n\t\t\t\t\t\tvalue: 'both',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\thide: {\n\t\t\t\t\t\tevent: ['rowAdded'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Options',\n\t\t\t\tname: 'options',\n\t\t\t\ttype: 'collection',\n\t\t\t\tplaceholder: 'Add option',\n\t\t\t\tdefault: {},\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tdisplayName: 'Columns to Watch',\n\t\t\t\t\t\tname: 'columnsToWatch',\n\t\t\t\t\t\ttype: 'multiOptions',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'Choose from the list, or specify IDs using an <a href=\"https://docs.n8n.io/code/expressions/\">expression</a>',\n\t\t\t\t\t\ttypeOptions: {\n\t\t\t\t\t\t\tloadOptionsDependsOn: ['sheetName.value'],\n\t\t\t\t\t\t\tloadOptionsMethod: 'getSheetHeaderRowAndSkipEmpty',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdefault: [],\n\t\t\t\t\t\tdisplayOptions: {\n\t\t\t\t\t\t\tshow: {\n\t\t\t\t\t\t\t\t'/event': ['anyUpdate', 'rowUpdate'],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tdisplayName: 'Data Location on Sheet',\n\t\t\t\t\t\tname: 'dataLocationOnSheet',\n\t\t\t\t\t\ttype: 'fixedCollection',\n\t\t\t\t\t\tplaceholder: 'Select Range',\n\t\t\t\t\t\tdefault: { values: { rangeDefinition: 'specifyRangeA1' } },\n\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdisplayName: 'Values',\n\t\t\t\t\t\t\t\tname: 'values',\n\t\t\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tdisplayName: 'Range Definition',\n\t\t\t\t\t\t\t\t\t\tname: 'rangeDefinition',\n\t\t\t\t\t\t\t\t\t\ttype: 'options',\n\t\t\t\t\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'Specify Range (A1 Notation)',\n\t\t\t\t\t\t\t\t\t\t\t\tvalue: 'specifyRangeA1',\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: 'Manually specify the data range',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'Specify Range (Rows)',\n\t\t\t\t\t\t\t\t\t\t\t\tvalue: 'specifyRange',\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: 'Manually specify the data range',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tdisplayName: 'Header Row',\n\t\t\t\t\t\t\t\t\t\tname: 'headerRow',\n\t\t\t\t\t\t\t\t\t\ttype: 'number',\n\t\t\t\t\t\t\t\t\t\ttypeOptions: {\n\t\t\t\t\t\t\t\t\t\t\tminValue: 1,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tdefault: 1,\n\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t'Index of the row which contains the keys. Starts at 1. The incoming node data is matched to the keys for assignment. The matching is case sensitive.',\n\t\t\t\t\t\t\t\t\t\thint: 'First row is row 1',\n\t\t\t\t\t\t\t\t\t\tdisplayOptions: {\n\t\t\t\t\t\t\t\t\t\t\tshow: {\n\t\t\t\t\t\t\t\t\t\t\t\trangeDefinition: ['specifyRange'],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tdisplayName: 'First Data Row',\n\t\t\t\t\t\t\t\t\t\tname: 'firstDataRow',\n\t\t\t\t\t\t\t\t\t\ttype: 'number',\n\t\t\t\t\t\t\t\t\t\ttypeOptions: {\n\t\t\t\t\t\t\t\t\t\t\tminValue: 1,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tdefault: 2,\n\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t'Index of the first row which contains the actual data and not the keys. Starts with 1.',\n\t\t\t\t\t\t\t\t\t\thint: 'First row is row 1',\n\t\t\t\t\t\t\t\t\t\tdisplayOptions: {\n\t\t\t\t\t\t\t\t\t\t\tshow: {\n\t\t\t\t\t\t\t\t\t\t\t\trangeDefinition: ['specifyRange'],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tdisplayName: 'Range',\n\t\t\t\t\t\t\t\t\t\tname: 'range',\n\t\t\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t\t\t\t\t\tplaceholder: 'A:Z',\n\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t'The table range to read from or to append data to. See the Google <a href=\"https://developers.google.com/sheets/api/guides/values#writing\">documentation</a> for the details.',\n\t\t\t\t\t\t\t\t\t\thint: 'You can specify both the rows and the columns, e.g. C4:E7',\n\t\t\t\t\t\t\t\t\t\tdisplayOptions: {\n\t\t\t\t\t\t\t\t\t\t\tshow: {\n\t\t\t\t\t\t\t\t\t\t\t\trangeDefinition: ['specifyRangeA1'],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tdisplayName: 'Value Render',\n\t\t\t\t\t\tname: 'valueRender',\n\t\t\t\t\t\ttype: 'options',\n\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'Unformatted',\n\t\t\t\t\t\t\t\tvalue: 'UNFORMATTED_VALUE',\n\t\t\t\t\t\t\t\tdescription: 'Values will be calculated, but not formatted in the reply',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'Formatted',\n\t\t\t\t\t\t\t\tvalue: 'FORMATTED_VALUE',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\"Values will be formatted and calculated according to the cell's formatting (based on the spreadsheet's locale)\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'Formula',\n\t\t\t\t\t\t\t\tvalue: 'FORMULA',\n\t\t\t\t\t\t\t\tdescription: 'Values will not be calculated. The reply will include the formulas.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t\tdefault: 'UNFORMATTED_VALUE',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'Determines how values will be rendered in the output. <a href=\"https://developers.google.com/sheets/api/reference/rest/v4/ValueRenderOption\" target=\"_blank\">More info</a>.',\n\t\t\t\t\t\tdisplayOptions: {\n\t\t\t\t\t\t\thide: {\n\t\t\t\t\t\t\t\t'/event': ['anyUpdate', 'rowUpdate'],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tdisplayName: 'DateTime Render',\n\t\t\t\t\t\tname: 'dateTimeRenderOption',\n\t\t\t\t\t\ttype: 'options',\n\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'Serial Number',\n\t\t\t\t\t\t\t\tvalue: 'SERIAL_NUMBER',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'Fields will be returned as doubles in \"serial number\" format (as popularized by Lotus 1-2-3)',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'Formatted String',\n\t\t\t\t\t\t\t\tvalue: 'FORMATTED_STRING',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'Fields will be rendered as strings in their given number format (which depends on the spreadsheet locale)',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t\tdefault: 'SERIAL_NUMBER',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'Determines how dates should be rendered in the output.  <a href=\"https://developers.google.com/sheets/api/reference/rest/v4/DateTimeRenderOption\" target=\"_blank\">More info</a>.',\n\t\t\t\t\t\tdisplayOptions: {\n\t\t\t\t\t\t\thide: {\n\t\t\t\t\t\t\t\t'/event': ['anyUpdate', 'rowUpdate'],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t],\n\t};\n\n\tmethods = {\n\t\tlistSearch: { spreadSheetsSearch, sheetsSearch },\n\t\tloadOptions: { getSheetHeaderRowAndSkipEmpty },\n\t};\n\n\tasync poll(this: IPollFunctions): Promise<INodeExecutionData[][] | null> {\n\t\ttry {\n\t\t\tconst workflowStaticData = this.getWorkflowStaticData('node');\n\t\t\tconst event = this.getNodeParameter('event', 0) as string;\n\n\t\t\tconst documentId = this.getNodeParameter('documentId', undefined, {\n\t\t\t\textractValue: true,\n\t\t\t}) as string;\n\n\t\t\tconst sheetWithinDocument = this.getNodeParameter('sheetName', undefined, {\n\t\t\t\textractValue: true,\n\t\t\t}) as string;\n\t\t\tconst { mode: sheetMode } = this.getNodeParameter('sheetName', 0) as {\n\t\t\t\tmode: ResourceLocator;\n\t\t\t};\n\n\t\t\tconst googleSheet = new GoogleSheet(documentId, this);\n\t\t\tconst { sheetId, title: sheetName } = await googleSheet.spreadsheetGetSheet(\n\t\t\t\tthis.getNode(),\n\t\t\t\tsheetMode,\n\t\t\t\tsheetWithinDocument,\n\t\t\t);\n\n\t\t\tconst options = this.getNodeParameter('options') as IDataObject;\n\n\t\t\t// If the documentId or sheetId changed, reset the workflow static data\n\t\t\tif (\n\t\t\t\tthis.getMode() !== 'manual' &&\n\t\t\t\t(workflowStaticData.documentId !== documentId || workflowStaticData.sheetId !== sheetId)\n\t\t\t) {\n\t\t\t\tworkflowStaticData.documentId = documentId;\n\t\t\t\tworkflowStaticData.sheetId = sheetId;\n\t\t\t\tworkflowStaticData.lastRevision = undefined;\n\t\t\t\tworkflowStaticData.lastRevisionLink = undefined;\n\t\t\t\tworkflowStaticData.lastIndexChecked = undefined;\n\t\t\t}\n\n\t\t\tconst previousRevision = workflowStaticData.lastRevision as number;\n\t\t\tconst previousRevisionLink = workflowStaticData.lastRevisionLink as string;\n\n\t\t\tif (event !== 'rowAdded') {\n\t\t\t\tlet pageToken;\n\t\t\t\tdo {\n\t\t\t\t\tconst { revisions, nextPageToken } = await apiRequest.call(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\t'GET',\n\t\t\t\t\t\t'',\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfields: 'revisions(id, exportLinks), nextPageToken',\n\t\t\t\t\t\t\tpageToken,\n\t\t\t\t\t\t\tpageSize: 1000,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t`https://www.googleapis.com/drive/v3/files/${documentId}/revisions`,\n\t\t\t\t\t);\n\n\t\t\t\t\tif (nextPageToken) {\n\t\t\t\t\t\tpageToken = nextPageToken as string;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpageToken = undefined;\n\n\t\t\t\t\t\tconst lastRevision = +revisions[revisions.length - 1].id;\n\t\t\t\t\t\tif (lastRevision <= previousRevision) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (this.getMode() !== 'manual') {\n\t\t\t\t\t\t\t\tworkflowStaticData.lastRevision = lastRevision;\n\t\t\t\t\t\t\t\tworkflowStaticData.lastRevisionLink =\n\t\t\t\t\t\t\t\t\trevisions[revisions.length - 1].exportLinks[BINARY_MIME_TYPE];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} while (pageToken);\n\t\t\t}\n\n\t\t\tlet range = 'A:ZZZ';\n\t\t\tlet keyRow = 1;\n\t\t\tlet startIndex = 2;\n\n\t\t\tlet rangeDefinition = '';\n\n\t\t\tconst [from, to] = range.split(':');\n\t\t\tlet keyRange = `${from}${keyRow}:${to}${keyRow}`;\n\t\t\tlet rangeToCheck = `${from}${keyRow}:${to}`;\n\n\t\t\tif (options.dataLocationOnSheet) {\n\t\t\t\tconst locationDefine = (options.dataLocationOnSheet as IDataObject).values as IDataObject;\n\t\t\t\trangeDefinition = locationDefine.rangeDefinition as string;\n\n\t\t\t\tif (rangeDefinition === 'specifyRangeA1') {\n\t\t\t\t\tif (locationDefine.range === '') {\n\t\t\t\t\t\tthrow new NodeOperationError(\n\t\t\t\t\t\t\tthis.getNode(),\n\t\t\t\t\t\t\t\"The field 'Range' is empty, please provide a range\",\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\trange = locationDefine.range as string;\n\t\t\t\t}\n\n\t\t\t\tif (rangeDefinition === 'specifyRange') {\n\t\t\t\t\tkeyRow = parseInt(locationDefine.headerRow as string, 10);\n\t\t\t\t\tstartIndex = parseInt(locationDefine.firstDataRow as string, 10);\n\t\t\t\t}\n\n\t\t\t\tconst [rangeFrom, rangeTo] = range.split(':');\n\t\t\t\tconst cellDataFrom = rangeFrom.match(/([a-zA-Z]{1,10})([0-9]{0,10})/) || [];\n\t\t\t\tconst cellDataTo = rangeTo.match(/([a-zA-Z]{1,10})([0-9]{0,10})/) || [];\n\n\t\t\t\tif (rangeDefinition === 'specifyRangeA1' && cellDataFrom[2] !== undefined) {\n\t\t\t\t\tkeyRange = `${cellDataFrom[1]}${+cellDataFrom[2]}:${cellDataTo[1]}${+cellDataFrom[2]}`;\n\t\t\t\t\trangeToCheck = `${cellDataFrom[1]}${+cellDataFrom[2] + 1}:${rangeTo}`;\n\t\t\t\t} else {\n\t\t\t\t\tkeyRange = `${cellDataFrom[1]}${keyRow}:${cellDataTo[1]}${keyRow}`;\n\t\t\t\t\trangeToCheck = `${cellDataFrom[1]}${keyRow}:${rangeTo}`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst qs: IDataObject = {};\n\n\t\t\tObject.assign(qs, options);\n\n\t\t\tif (event === 'rowAdded') {\n\t\t\t\tconst [columns] = ((\n\t\t\t\t\t(await apiRequest.call(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\t'GET',\n\t\t\t\t\t\t`/v4/spreadsheets/${documentId}/values/${encodeURIComponent(sheetName)}!${keyRange}`,\n\t\t\t\t\t)) as IDataObject\n\t\t\t\t).values as string[][]) || [[]];\n\n\t\t\t\tif (!columns?.length) {\n\t\t\t\t\tthrow new NodeOperationError(\n\t\t\t\t\t\tthis.getNode(),\n\t\t\t\t\t\t'Could not retrieve the columns from key row',\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tconst sheetData = await googleSheet.getData(\n\t\t\t\t\t`${sheetName}!${rangeToCheck}`,\n\t\t\t\t\t(options.valueRender as ValueRenderOption) || 'UNFORMATTED_VALUE',\n\t\t\t\t\t(options.dateTimeRenderOption as string) || 'FORMATTED_STRING',\n\t\t\t\t);\n\n\t\t\t\tif (Array.isArray(sheetData) && sheetData.length !== 0) {\n\t\t\t\t\tsheetData.splice(0, 1); // Remove header row\n\t\t\t\t}\n\n\t\t\t\tlet dataStartIndex = 0;\n\t\t\t\tif (rangeDefinition === 'specifyRange' && keyRow < startIndex) {\n\t\t\t\t\tdataStartIndex = startIndex - keyRow - 1;\n\t\t\t\t}\n\n\t\t\t\tif (this.getMode() === 'manual') {\n\t\t\t\t\tif (Array.isArray(sheetData)) {\n\t\t\t\t\t\tconst sheetDataFromStartIndex = sheetData.slice(dataStartIndex);\n\t\t\t\t\t\tconst returnData = arrayOfArraysToJson(sheetDataFromStartIndex, columns);\n\n\t\t\t\t\t\tif (Array.isArray(returnData) && returnData.length !== 0) {\n\t\t\t\t\t\t\treturn [this.helpers.returnJsonArray(returnData)];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (Array.isArray(sheetData) && this.getMode() !== 'manual') {\n\t\t\t\t\tif (workflowStaticData.lastIndexChecked === undefined) {\n\t\t\t\t\t\tworkflowStaticData.lastIndexChecked = sheetData.length;\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst rowsStartIndex = Math.max(\n\t\t\t\t\t\tworkflowStaticData.lastIndexChecked as number,\n\t\t\t\t\t\tdataStartIndex,\n\t\t\t\t\t);\n\t\t\t\t\tconst addedRows = sheetData?.slice(rowsStartIndex) || [];\n\t\t\t\t\tconst returnData = arrayOfArraysToJson(addedRows, columns);\n\n\t\t\t\t\tworkflowStaticData.lastIndexChecked = sheetData.length;\n\n\t\t\t\t\tif (Array.isArray(returnData) && returnData.length !== 0) {\n\t\t\t\t\t\treturn [this.helpers.returnJsonArray(returnData)];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (event === 'anyUpdate' || event === 'rowUpdate') {\n\t\t\t\tif (sheetName.length > 31) {\n\t\t\t\t\tthrow new NodeOperationError(\n\t\t\t\t\t\tthis.getNode(),\n\t\t\t\t\t\t'Sheet name is too long choose a name with 31 characters or less',\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tconst sheetRange = `${sheetName}!${range}`;\n\n\t\t\t\tlet dataStartIndex = startIndex - 1;\n\t\t\t\tif (rangeDefinition !== 'specifyRangeA1') {\n\t\t\t\t\tdataStartIndex = keyRow < startIndex ? startIndex - 2 : startIndex - 1;\n\t\t\t\t}\n\n\t\t\t\tconst currentData =\n\t\t\t\t\t((await googleSheet.getData(\n\t\t\t\t\t\tsheetRange,\n\t\t\t\t\t\t'UNFORMATTED_VALUE',\n\t\t\t\t\t\t'SERIAL_NUMBER',\n\t\t\t\t\t)) as string[][]) || [];\n\n\t\t\t\tif (previousRevision === undefined) {\n\t\t\t\t\tif (currentData.length === 0) {\n\t\t\t\t\t\treturn [[]];\n\t\t\t\t\t}\n\t\t\t\t\tconst zeroBasedKeyRow = keyRow - 1;\n\t\t\t\t\tconst columns = currentData[zeroBasedKeyRow];\n\t\t\t\t\tcurrentData.splice(zeroBasedKeyRow, 1); // Remove key row\n\n\t\t\t\t\tlet returnData;\n\t\t\t\t\tif (rangeDefinition !== 'specifyRangeA1') {\n\t\t\t\t\t\treturnData = arrayOfArraysToJson(currentData.slice(dataStartIndex), columns);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturnData = arrayOfArraysToJson(currentData, columns);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Array.isArray(returnData) && returnData.length !== 0 && this.getMode() === 'manual') {\n\t\t\t\t\t\treturn [this.helpers.returnJsonArray(returnData)];\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst previousRevisionBinaryData = await getRevisionFile.call(this, previousRevisionLink);\n\n\t\t\t\tconst previousRevisionSheetData =\n\t\t\t\t\tsheetBinaryToArrayOfArrays(\n\t\t\t\t\t\tpreviousRevisionBinaryData,\n\t\t\t\t\t\tsheetName,\n\t\t\t\t\t\trangeDefinition === 'specifyRangeA1' ? range : undefined,\n\t\t\t\t\t) || [];\n\n\t\t\t\tconst includeInOutput = this.getNodeParameter('includeInOutput', 'new') as string;\n\n\t\t\t\tlet returnData;\n\t\t\t\tif (options.columnsToWatch) {\n\t\t\t\t\treturnData = compareRevisions(\n\t\t\t\t\t\tpreviousRevisionSheetData,\n\t\t\t\t\t\tcurrentData,\n\t\t\t\t\t\tkeyRow,\n\t\t\t\t\t\tincludeInOutput,\n\t\t\t\t\t\toptions.columnsToWatch as string[],\n\t\t\t\t\t\tdataStartIndex,\n\t\t\t\t\t\tevent,\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\treturnData = compareRevisions(\n\t\t\t\t\t\tpreviousRevisionSheetData,\n\t\t\t\t\t\tcurrentData,\n\t\t\t\t\t\tkeyRow,\n\t\t\t\t\t\tincludeInOutput,\n\t\t\t\t\t\t[],\n\t\t\t\t\t\tdataStartIndex,\n\t\t\t\t\t\tevent,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (Array.isArray(returnData) && returnData.length !== 0) {\n\t\t\t\t\treturn [this.helpers.returnJsonArray(returnData)];\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif (\n\t\t\t\terror?.description\n\t\t\t\t\t?.toLowerCase()\n\t\t\t\t\t.includes('user does not have sufficient permissions for file')\n\t\t\t) {\n\t\t\t\tthrow new NodeOperationError(\n\t\t\t\t\tthis.getNode(),\n\t\t\t\t\t\"Edit access to the document is required for the 'Row Update' and 'Row Added or Updated' triggers. Request edit access to the document's owner or select the 'Row Added' trigger in the 'Trigger On' dropdown.\",\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (\n\t\t\t\terror?.error?.error?.message !== undefined &&\n\t\t\t\t!(error.error.error.message as string).toLocaleLowerCase().includes('unknown error') &&\n\t\t\t\t!(error.error.error.message as string).toLocaleLowerCase().includes('bad request')\n\t\t\t) {\n\t\t\t\t// eslint-disable-next-line prefer-const\n\t\t\t\tlet [message, ...description] = (error.error.error.message as string).split('. ');\n\t\t\t\tif (message.toLowerCase() === 'access not configured') {\n\t\t\t\t\tmessage = 'Missing Google Drive API';\n\t\t\t\t}\n\t\t\t\tthrow new NodeOperationError(this.getNode(), message, {\n\t\t\t\t\tdescription: description.join('.\\n '),\n\t\t\t\t});\n\t\t\t}\n\t\t\tthrow error;\n\t\t}\n\t\treturn null;\n\t}\n}\n"],"mappings":"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","names":["returnData"]}