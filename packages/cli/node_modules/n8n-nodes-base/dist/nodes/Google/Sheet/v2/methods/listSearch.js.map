{"version":3,"sources":["../../../../../../nodes/Google/Sheet/v2/methods/listSearch.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tILoadOptionsFunctions,\n\tINodeListSearchItems,\n\tINodeListSearchResult,\n} from 'n8n-workflow';\nimport { NodeOperationError } from 'n8n-workflow';\n\nimport type { ResourceLocator } from '../helpers/GoogleSheets.types';\nimport { getSpreadsheetId } from '../helpers/GoogleSheets.utils';\nimport { apiRequest } from '../transport';\n\nexport async function spreadSheetsSearch(\n\tthis: ILoadOptionsFunctions,\n\tfilter?: string,\n\tpaginationToken?: string,\n): Promise<INodeListSearchResult> {\n\tconst query: string[] = [];\n\tif (filter) {\n\t\tquery.push(`name contains '${filter.replace(\"'\", \"\\\\'\")}'`);\n\t}\n\tquery.push(\"mimeType = 'application/vnd.google-apps.spreadsheet'\");\n\n\tconst qs = {\n\t\tq: query.join(' and '),\n\t\tpageToken: (paginationToken as string) || undefined,\n\t\tfields: 'nextPageToken, files(id, name, webViewLink)',\n\t\torderBy: 'modifiedByMeTime desc,name_natural',\n\t\tincludeItemsFromAllDrives: true,\n\t\tsupportsAllDrives: true,\n\t};\n\n\tconst res = await apiRequest.call(\n\t\tthis,\n\t\t'GET',\n\t\t'',\n\t\t{},\n\t\tqs,\n\t\t'https://www.googleapis.com/drive/v3/files',\n\t);\n\treturn {\n\t\tresults: res.files.map((sheet: IDataObject) => ({\n\t\t\tname: sheet.name as string,\n\t\t\tvalue: sheet.id as string,\n\t\t\turl: sheet.webViewLink as string,\n\t\t})),\n\t\tpaginationToken: res.nextPageToken,\n\t};\n}\n\nexport async function sheetsSearch(\n\tthis: ILoadOptionsFunctions,\n\t_filter?: string,\n): Promise<INodeListSearchResult> {\n\tconst documentId = this.getNodeParameter('documentId', 0) as IDataObject | null;\n\n\tif (!documentId) return { results: [] };\n\n\tconst { mode, value } = documentId;\n\n\tconst spreadsheetId = getSpreadsheetId(this.getNode(), mode as ResourceLocator, value as string);\n\n\tconst query = {\n\t\tfields: 'sheets.properties',\n\t};\n\n\tconst responseData = await apiRequest.call(\n\t\tthis,\n\t\t'GET',\n\t\t`/v4/spreadsheets/${spreadsheetId}`,\n\t\t{},\n\t\tquery,\n\t);\n\n\tif (responseData === undefined) {\n\t\tthrow new NodeOperationError(this.getNode(), 'No data got returned');\n\t}\n\n\tconst returnData: INodeListSearchItems[] = [];\n\tfor (const sheet of responseData.sheets!) {\n\t\tif (sheet.properties!.sheetType !== 'GRID') {\n\t\t\tcontinue;\n\t\t}\n\n\t\treturnData.push({\n\t\t\tname: sheet.properties!.title as string,\n\t\t\tvalue: (sheet.properties!.sheetId as number) || 'gid=0',\n\t\t\turl: `https://docs.google.com/spreadsheets/d/${spreadsheetId}/edit#gid=${sheet.properties!.sheetId}`,\n\t\t});\n\t}\n\n\treturn { results: returnData };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA,0BAAmC;AAGnC,0BAAiC;AACjC,uBAA2B;AAE3B,eAAsB,mBAErB,QACA,iBACiC;AACjC,QAAM,QAAkB,CAAC;AACzB,MAAI,QAAQ;AACX,UAAM,KAAK,kBAAkB,OAAO,QAAQ,KAAK,KAAK,CAAC,GAAG;AAAA,EAC3D;AACA,QAAM,KAAK,sDAAsD;AAEjE,QAAM,KAAK;AAAA,IACV,GAAG,MAAM,KAAK,OAAO;AAAA,IACrB,WAAY,mBAA8B;AAAA,IAC1C,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,2BAA2B;AAAA,IAC3B,mBAAmB;AAAA,EACpB;AAEA,QAAM,MAAM,MAAM,4BAAW;AAAA,IAC5B;AAAA,IACA;AAAA,IACA;AAAA,IACA,CAAC;AAAA,IACD;AAAA,IACA;AAAA,EACD;AACA,SAAO;AAAA,IACN,SAAS,IAAI,MAAM,IAAI,CAAC,WAAwB;AAAA,MAC/C,MAAM,MAAM;AAAA,MACZ,OAAO,MAAM;AAAA,MACb,KAAK,MAAM;AAAA,IACZ,EAAE;AAAA,IACF,iBAAiB,IAAI;AAAA,EACtB;AACD;AAEA,eAAsB,aAErB,SACiC;AACjC,QAAM,aAAa,KAAK,iBAAiB,cAAc,CAAC;AAExD,MAAI,CAAC,WAAY,QAAO,EAAE,SAAS,CAAC,EAAE;AAEtC,QAAM,EAAE,MAAM,MAAM,IAAI;AAExB,QAAM,oBAAgB,sCAAiB,KAAK,QAAQ,GAAG,MAAyB,KAAe;AAE/F,QAAM,QAAQ;AAAA,IACb,QAAQ;AAAA,EACT;AAEA,QAAM,eAAe,MAAM,4BAAW;AAAA,IACrC;AAAA,IACA;AAAA,IACA,oBAAoB,aAAa;AAAA,IACjC,CAAC;AAAA,IACD;AAAA,EACD;AAEA,MAAI,iBAAiB,QAAW;AAC/B,UAAM,IAAI,uCAAmB,KAAK,QAAQ,GAAG,sBAAsB;AAAA,EACpE;AAEA,QAAM,aAAqC,CAAC;AAC5C,aAAW,SAAS,aAAa,QAAS;AACzC,QAAI,MAAM,WAAY,cAAc,QAAQ;AAC3C;AAAA,IACD;AAEA,eAAW,KAAK;AAAA,MACf,MAAM,MAAM,WAAY;AAAA,MACxB,OAAQ,MAAM,WAAY,WAAsB;AAAA,MAChD,KAAK,0CAA0C,aAAa,aAAa,MAAM,WAAY,OAAO;AAAA,IACnG,CAAC;AAAA,EACF;AAEA,SAAO,EAAE,SAAS,WAAW;AAC9B;","names":[]}