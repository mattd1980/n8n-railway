{"version":3,"sources":["../../../nodes/Segment/Segment.node.ts"],"sourcesContent":["import type {\n\tIExecuteFunctions,\n\tIDataObject,\n\tINodeExecutionData,\n\tINodeType,\n\tINodeTypeDescription,\n} from 'n8n-workflow';\nimport { NodeConnectionTypes } from 'n8n-workflow';\nimport { v4 as uuid } from 'uuid';\n\nimport { segmentApiRequest } from './GenericFunctions';\nimport { groupFields, groupOperations } from './GroupDescription';\nimport { identifyFields, identifyOperations } from './IdentifyDescription';\nimport type { IIdentify } from './IdentifyInterface';\nimport { trackFields, trackOperations } from './TrackDescription';\nimport type { IGroup, ITrack } from './TrackInterface';\n\nexport class Segment implements INodeType {\n\tdescription: INodeTypeDescription = {\n\t\tdisplayName: 'Segment',\n\t\tname: 'segment',\n\t\ticon: 'file:segment.svg',\n\t\tgroup: ['output'],\n\t\tversion: 1,\n\t\tsubtitle: '={{$parameter[\"operation\"] + \":\" + $parameter[\"resource\"]}}',\n\t\tdescription: 'Consume Segment API',\n\t\tdefaults: {\n\t\t\tname: 'Segment',\n\t\t},\n\t\tusableAsTool: true,\n\t\tinputs: [NodeConnectionTypes.Main],\n\t\toutputs: [NodeConnectionTypes.Main],\n\t\tcredentials: [\n\t\t\t{\n\t\t\t\tname: 'segmentApi',\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tdisplayName: 'Resource',\n\t\t\t\tname: 'resource',\n\t\t\t\ttype: 'options',\n\t\t\t\tnoDataExpression: true,\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Group',\n\t\t\t\t\t\tvalue: 'group',\n\t\t\t\t\t\tdescription: 'Group lets you associate an identified user with a group',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Identify',\n\t\t\t\t\t\tvalue: 'identify',\n\t\t\t\t\t\tdescription: 'Identify lets you tie a user to their actions',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Track',\n\t\t\t\t\t\tvalue: 'track',\n\t\t\t\t\t\tdescription: 'Track lets you record events',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdefault: 'identify',\n\t\t\t},\n\t\t\t...groupOperations,\n\t\t\t...groupFields,\n\t\t\t...identifyOperations,\n\t\t\t...trackOperations,\n\t\t\t...identifyFields,\n\t\t\t...trackFields,\n\t\t],\n\t};\n\n\tasync execute(this: IExecuteFunctions): Promise<INodeExecutionData[][]> {\n\t\tconst items = this.getInputData();\n\t\tconst returnData: IDataObject[] = [];\n\t\tconst length = items.length;\n\t\tlet responseData;\n\t\tconst resource = this.getNodeParameter('resource', 0);\n\t\tconst operation = this.getNodeParameter('operation', 0);\n\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\ttry {\n\t\t\t\tif (resource === 'group') {\n\t\t\t\t\t//https://segment.com/docs/connections/sources/catalog/libraries/server/http-api/#group\n\t\t\t\t\tif (operation === 'add') {\n\t\t\t\t\t\tconst userId = this.getNodeParameter('userId', i) as string;\n\t\t\t\t\t\tconst groupId = this.getNodeParameter('groupId', i) as string;\n\t\t\t\t\t\tconst traits = (this.getNodeParameter('traits', i) as IDataObject)\n\t\t\t\t\t\t\t.traitsUi as IDataObject[];\n\t\t\t\t\t\tconst context = (this.getNodeParameter('context', i) as IDataObject)\n\t\t\t\t\t\t\t.contextUi as IDataObject;\n\t\t\t\t\t\tconst integrations = (this.getNodeParameter('integrations', i) as IDataObject)\n\t\t\t\t\t\t\t.integrationsUi as IDataObject;\n\t\t\t\t\t\tconst body: IGroup = {\n\t\t\t\t\t\t\tgroupId,\n\t\t\t\t\t\t\ttraits: {\n\t\t\t\t\t\t\t\tcompany: {},\n\t\t\t\t\t\t\t\taddress: {},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t\tapp: {},\n\t\t\t\t\t\t\t\tcampaign: {},\n\t\t\t\t\t\t\t\tdevice: {},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tintegrations: {},\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (userId) {\n\t\t\t\t\t\t\tbody.userId = userId;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbody.anonymousId = uuid();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (traits) {\n\t\t\t\t\t\t\tif (traits && traits.length !== 0) {\n\t\t\t\t\t\t\t\tfor (const trait of traits) {\n\t\t\t\t\t\t\t\t\tbody.traits![trait.key as string] = trait.value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (context) {\n\t\t\t\t\t\t\tif (context.active) {\n\t\t\t\t\t\t\t\tbody.context!.active = context.active as boolean;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.ip) {\n\t\t\t\t\t\t\t\tbody.context!.ip = context.ip as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.locate) {\n\t\t\t\t\t\t\t\tbody.context!.locate = context.locate as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.page) {\n\t\t\t\t\t\t\t\tbody.context!.page = context.page as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.timezone) {\n\t\t\t\t\t\t\t\tbody.context!.timezone = context.timezone as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.timezone) {\n\t\t\t\t\t\t\t\tbody.context!.timezone = context.timezone as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.app) {\n\t\t\t\t\t\t\t\tconst app = (context.app as IDataObject).appUi as IDataObject;\n\t\t\t\t\t\t\t\tif (app) {\n\t\t\t\t\t\t\t\t\tif (app.name) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.app.name = app.name as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (app.version) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.app.version = app.version as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (app.build) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.app.build = app.build as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.campaign) {\n\t\t\t\t\t\t\t\tconst campaign = (context.campaign as IDataObject).campaignUi as IDataObject;\n\t\t\t\t\t\t\t\tif (campaign) {\n\t\t\t\t\t\t\t\t\tif (campaign.name) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.name = campaign.name as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.source) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.source = campaign.source as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.medium) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.medium = campaign.medium as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.term) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.term = campaign.term as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.content) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.content = campaign.content as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (context.device) {\n\t\t\t\t\t\t\t\tconst device = (context.device as IDataObject).deviceUi as IDataObject;\n\t\t\t\t\t\t\t\tif (device) {\n\t\t\t\t\t\t\t\t\tif (device.id) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.id = device.id as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.manufacturer) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.manufacturer = device.manufacturer as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.model) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.model = device.model as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.type) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.type = device.type as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.version) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.version = device.version as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (integrations) {\n\t\t\t\t\t\t\tif (integrations.all) {\n\t\t\t\t\t\t\t\tbody.integrations!.all = integrations.all as boolean;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (integrations.salesforce) {\n\t\t\t\t\t\t\t\tbody.integrations!.salesforce = integrations.salesforce as boolean;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresponseData = await segmentApiRequest.call(this, 'POST', '/group', body);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (resource === 'identify') {\n\t\t\t\t\t//https://segment.com/docs/connections/sources/catalog/libraries/server/http-api/#identify\n\t\t\t\t\tif (operation === 'create') {\n\t\t\t\t\t\tconst userId = this.getNodeParameter('userId', i) as string;\n\t\t\t\t\t\tconst context = (this.getNodeParameter('context', i) as IDataObject)\n\t\t\t\t\t\t\t.contextUi as IDataObject;\n\t\t\t\t\t\tconst traits = (this.getNodeParameter('traits', i) as IDataObject)\n\t\t\t\t\t\t\t.traitsUi as IDataObject[];\n\t\t\t\t\t\tconst integrations = (this.getNodeParameter('integrations', i) as IDataObject)\n\t\t\t\t\t\t\t.integrationsUi as IDataObject;\n\t\t\t\t\t\tconst body: IIdentify = {\n\t\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t\tapp: {},\n\t\t\t\t\t\t\t\tcampaign: {},\n\t\t\t\t\t\t\t\tdevice: {},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttraits: {},\n\t\t\t\t\t\t\tintegrations: {},\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (userId) {\n\t\t\t\t\t\t\tbody.userId = userId;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbody.anonymousId = uuid();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (context) {\n\t\t\t\t\t\t\tif (context.active) {\n\t\t\t\t\t\t\t\tbody.context!.active = context.active as boolean;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.ip) {\n\t\t\t\t\t\t\t\tbody.context!.ip = context.ip as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.locate) {\n\t\t\t\t\t\t\t\tbody.context!.locate = context.locate as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.page) {\n\t\t\t\t\t\t\t\tbody.context!.page = context.page as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.timezone) {\n\t\t\t\t\t\t\t\tbody.context!.timezone = context.timezone as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.timezone) {\n\t\t\t\t\t\t\t\tbody.context!.timezone = context.timezone as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.app) {\n\t\t\t\t\t\t\t\tconst app = (context.app as IDataObject).appUi as IDataObject;\n\t\t\t\t\t\t\t\tif (app) {\n\t\t\t\t\t\t\t\t\tif (app.name) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.app.name = app.name as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (app.version) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.app.version = app.version as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (app.build) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.app.build = app.build as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.campaign) {\n\t\t\t\t\t\t\t\tconst campaign = (context.campaign as IDataObject).campaignUi as IDataObject;\n\t\t\t\t\t\t\t\tif (campaign) {\n\t\t\t\t\t\t\t\t\tif (campaign.name) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.name = campaign.name as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.source) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.source = campaign.source as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.medium) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.medium = campaign.medium as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.term) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.term = campaign.term as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.content) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.content = campaign.content as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (context.device) {\n\t\t\t\t\t\t\t\tconst device = (context.device as IDataObject).deviceUi as IDataObject;\n\t\t\t\t\t\t\t\tif (device) {\n\t\t\t\t\t\t\t\t\tif (device.id) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.id = device.id as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.manufacturer) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.manufacturer = device.manufacturer as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.model) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.model = device.model as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.type) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.type = device.type as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.version) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.version = device.version as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (integrations) {\n\t\t\t\t\t\t\tif (integrations.all) {\n\t\t\t\t\t\t\t\tbody.integrations!.all = integrations.all as boolean;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (integrations.salesforce) {\n\t\t\t\t\t\t\t\tbody.integrations!.salesforce = integrations.salesforce as boolean;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (traits) {\n\t\t\t\t\t\t\tif (traits && traits.length !== 0) {\n\t\t\t\t\t\t\t\tfor (const trait of traits) {\n\t\t\t\t\t\t\t\t\tbody.traits![trait.key as string] = trait.value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresponseData = await segmentApiRequest.call(this, 'POST', '/identify', body);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (resource === 'track') {\n\t\t\t\t\t//https://segment.com/docs/connections/sources/catalog/libraries/server/http-api/#track\n\t\t\t\t\tif (operation === 'event') {\n\t\t\t\t\t\tconst userId = this.getNodeParameter('userId', i) as string;\n\t\t\t\t\t\tconst event = this.getNodeParameter('event', i) as string;\n\t\t\t\t\t\tconst context = (this.getNodeParameter('context', i) as IDataObject)\n\t\t\t\t\t\t\t.contextUi as IDataObject;\n\t\t\t\t\t\tconst integrations = (this.getNodeParameter('integrations', i) as IDataObject)\n\t\t\t\t\t\t\t.integrationsUi as IDataObject;\n\t\t\t\t\t\tconst properties = (this.getNodeParameter('properties', i) as IDataObject)\n\t\t\t\t\t\t\t.propertiesUi as IDataObject[];\n\t\t\t\t\t\tconst body: ITrack = {\n\t\t\t\t\t\t\tevent,\n\t\t\t\t\t\t\ttraits: {},\n\t\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t\tapp: {},\n\t\t\t\t\t\t\t\tcampaign: {},\n\t\t\t\t\t\t\t\tdevice: {},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tintegrations: {},\n\t\t\t\t\t\t\tproperties: {},\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (userId) {\n\t\t\t\t\t\t\tbody.userId = userId;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbody.anonymousId = uuid();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (context) {\n\t\t\t\t\t\t\tif (context.active) {\n\t\t\t\t\t\t\t\tbody.context!.active = context.active as boolean;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.ip) {\n\t\t\t\t\t\t\t\tbody.context!.ip = context.ip as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.locate) {\n\t\t\t\t\t\t\t\tbody.context!.locate = context.locate as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.page) {\n\t\t\t\t\t\t\t\tbody.context!.page = context.page as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.timezone) {\n\t\t\t\t\t\t\t\tbody.context!.timezone = context.timezone as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.timezone) {\n\t\t\t\t\t\t\t\tbody.context!.timezone = context.timezone as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.app) {\n\t\t\t\t\t\t\t\tconst app = (context.app as IDataObject).appUi as IDataObject;\n\t\t\t\t\t\t\t\tif (app) {\n\t\t\t\t\t\t\t\t\tif (app.name) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.app.name = app.name as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (app.version) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.app.version = app.version as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (app.build) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.app.build = app.build as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.campaign) {\n\t\t\t\t\t\t\t\tconst campaign = (context.campaign as IDataObject).campaignUi as IDataObject;\n\t\t\t\t\t\t\t\tif (campaign) {\n\t\t\t\t\t\t\t\t\tif (campaign.name) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.name = campaign.name as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.source) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.source = campaign.source as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.medium) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.medium = campaign.medium as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.term) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.term = campaign.term as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.content) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.content = campaign.content as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (context.device) {\n\t\t\t\t\t\t\t\tconst device = (context.device as IDataObject).deviceUi as IDataObject;\n\t\t\t\t\t\t\t\tif (device) {\n\t\t\t\t\t\t\t\t\tif (device.id) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.id = device.id as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.manufacturer) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.manufacturer = device.manufacturer as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.model) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.model = device.model as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.type) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.type = device.type as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.version) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.version = device.version as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (integrations) {\n\t\t\t\t\t\t\tif (integrations.all) {\n\t\t\t\t\t\t\t\tbody.integrations!.all = integrations.all as boolean;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (integrations.salesforce) {\n\t\t\t\t\t\t\t\tbody.integrations!.salesforce = integrations.salesforce as boolean;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (properties) {\n\t\t\t\t\t\t\tif (properties && properties.length !== 0) {\n\t\t\t\t\t\t\t\tfor (const property of properties) {\n\t\t\t\t\t\t\t\t\tbody.properties![property.key as string] = property.value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresponseData = await segmentApiRequest.call(this, 'POST', '/track', body);\n\t\t\t\t\t}\n\t\t\t\t\t//https://segment.com/docs/connections/sources/catalog/libraries/server/http-api/#page\n\t\t\t\t\tif (operation === 'page') {\n\t\t\t\t\t\tconst userId = this.getNodeParameter('userId', i) as string;\n\t\t\t\t\t\tconst name = this.getNodeParameter('name', i) as string;\n\t\t\t\t\t\tconst context = (this.getNodeParameter('context', i) as IDataObject)\n\t\t\t\t\t\t\t.contextUi as IDataObject;\n\t\t\t\t\t\tconst integrations = (this.getNodeParameter('integrations', i) as IDataObject)\n\t\t\t\t\t\t\t.integrationsUi as IDataObject;\n\t\t\t\t\t\tconst properties = (this.getNodeParameter('properties', i) as IDataObject)\n\t\t\t\t\t\t\t.propertiesUi as IDataObject[];\n\t\t\t\t\t\tconst body: ITrack = {\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\ttraits: {},\n\t\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t\tapp: {},\n\t\t\t\t\t\t\t\tcampaign: {},\n\t\t\t\t\t\t\t\tdevice: {},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tintegrations: {},\n\t\t\t\t\t\t\tproperties: {},\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (userId) {\n\t\t\t\t\t\t\tbody.userId = userId;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbody.anonymousId = uuid();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (context) {\n\t\t\t\t\t\t\tif (context.active) {\n\t\t\t\t\t\t\t\tbody.context!.active = context.active as boolean;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.ip) {\n\t\t\t\t\t\t\t\tbody.context!.ip = context.ip as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.locate) {\n\t\t\t\t\t\t\t\tbody.context!.locate = context.locate as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.page) {\n\t\t\t\t\t\t\t\tbody.context!.page = context.page as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.timezone) {\n\t\t\t\t\t\t\t\tbody.context!.timezone = context.timezone as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.timezone) {\n\t\t\t\t\t\t\t\tbody.context!.timezone = context.timezone as string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.app) {\n\t\t\t\t\t\t\t\tconst app = (context.app as IDataObject).appUi as IDataObject;\n\t\t\t\t\t\t\t\tif (app) {\n\t\t\t\t\t\t\t\t\tif (app.name) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.app.name = app.name as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (app.version) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.app.version = app.version as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (app.build) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.app.build = app.build as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (context.campaign) {\n\t\t\t\t\t\t\t\tconst campaign = (context.campaign as IDataObject).campaignUi as IDataObject;\n\t\t\t\t\t\t\t\tif (campaign) {\n\t\t\t\t\t\t\t\t\tif (campaign.name) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.name = campaign.name as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.source) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.source = campaign.source as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.medium) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.medium = campaign.medium as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.term) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.term = campaign.term as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (campaign.content) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.campaign.content = campaign.content as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (context.device) {\n\t\t\t\t\t\t\t\tconst device = (context.device as IDataObject).deviceUi as IDataObject;\n\t\t\t\t\t\t\t\tif (device) {\n\t\t\t\t\t\t\t\t\tif (device.id) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.id = device.id as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.manufacturer) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.manufacturer = device.manufacturer as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.model) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.model = device.model as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.type) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.type = device.type as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (device.version) {\n\t\t\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\t\t\tbody.context.device.version = device.version as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (integrations) {\n\t\t\t\t\t\t\tif (integrations.all) {\n\t\t\t\t\t\t\t\tbody.integrations!.all = integrations.all as boolean;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (integrations.salesforce) {\n\t\t\t\t\t\t\t\tbody.integrations!.salesforce = integrations.salesforce as boolean;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (properties) {\n\t\t\t\t\t\t\tif (properties && properties.length !== 0) {\n\t\t\t\t\t\t\t\tfor (const property of properties) {\n\t\t\t\t\t\t\t\t\tbody.properties![property.key as string] = property.value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresponseData = await segmentApiRequest.call(this, 'POST', '/page', body);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tif (this.continueOnFail()) {\n\t\t\t\t\treturnData.push({ error: error.message });\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t\tif (Array.isArray(responseData)) {\n\t\t\t\treturnData.push.apply(returnData, responseData as IDataObject[]);\n\t\t\t} else {\n\t\t\t\treturnData.push(responseData as IDataObject);\n\t\t\t}\n\t\t}\n\t\treturn [this.helpers.returnJsonArray(returnData)];\n\t}\n}\n"],"mappings":"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","names":["uuid"]}