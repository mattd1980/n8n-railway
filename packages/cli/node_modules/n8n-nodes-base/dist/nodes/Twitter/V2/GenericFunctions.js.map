{"version":3,"sources":["../../../../nodes/Twitter/V2/GenericFunctions.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tIHookFunctions,\n\tILoadOptionsFunctions,\n\tINodeParameterResourceLocator,\n\tJsonObject,\n\tIRequestOptions,\n\tIHttpRequestMethods,\n} from 'n8n-workflow';\nimport { ApplicationError, NodeApiError, NodeOperationError } from 'n8n-workflow';\n\nexport async function twitterApiRequest(\n\tthis: IExecuteFunctions | ILoadOptionsFunctions | IHookFunctions,\n\tmethod: IHttpRequestMethods,\n\tresource: string,\n\tbody: IDataObject = {},\n\tqs: IDataObject = {},\n\tfullOutput?: boolean,\n\turi?: string,\n\toption: IDataObject = {},\n) {\n\tlet options: IRequestOptions = {\n\t\tmethod,\n\t\tbody,\n\t\tqs,\n\t\turl: uri || `https://api.twitter.com/2${resource}`,\n\t\tjson: true,\n\t};\n\ttry {\n\t\tif (Object.keys(option).length !== 0) {\n\t\t\toptions = Object.assign({}, options, option);\n\t\t}\n\t\tif (Object.keys(body).length === 0) {\n\t\t\tdelete options.body;\n\t\t}\n\t\tif (Object.keys(qs).length === 0) {\n\t\t\tdelete options.qs;\n\t\t}\n\t\tif (fullOutput) {\n\t\t\treturn await this.helpers.requestOAuth2.call(this, 'twitterOAuth2Api', options);\n\t\t} else {\n\t\t\tconst { data } = await this.helpers.requestOAuth2.call(this, 'twitterOAuth2Api', options);\n\t\t\treturn data;\n\t\t}\n\t} catch (error) {\n\t\tif (error.error?.required_enrollment === 'Appropriate Level of API Access') {\n\t\t\tthrow new NodeOperationError(\n\t\t\t\tthis.getNode(),\n\t\t\t\t'The operation requires Twitter Api to be either Basic or Pro.',\n\t\t\t);\n\t\t} else if (error.errors && error.error?.errors[0].message.includes('must be ')) {\n\t\t\tthrow new NodeOperationError(this.getNode(), error.error.errors[0].message as string);\n\t\t}\n\t\tthrow new NodeApiError(this.getNode(), error as JsonObject);\n\t}\n}\n\nexport async function twitterApiRequestAllItems(\n\tthis: IExecuteFunctions | ILoadOptionsFunctions,\n\tpropertyName: string,\n\tmethod: IHttpRequestMethods,\n\tendpoint: string,\n\tbody: IDataObject = {},\n\tquery: IDataObject = {},\n) {\n\tconst returnData: IDataObject[] = [];\n\n\tlet responseData;\n\n\tquery.max_results = 10;\n\n\tdo {\n\t\tresponseData = await twitterApiRequest.call(this, method, endpoint, body, query, true);\n\t\tquery.next_token = responseData.meta.next_token as string;\n\t\treturnData.push.apply(returnData, responseData[propertyName] as IDataObject[]);\n\t} while (responseData.meta.next_token);\n\n\treturn returnData;\n}\n\nexport function returnId(tweetId: INodeParameterResourceLocator) {\n\tif (tweetId.mode === 'id') {\n\t\treturn tweetId.value as string;\n\t} else if (tweetId.mode === 'url') {\n\t\ttry {\n\t\t\tconst url = new URL(tweetId.value as string);\n\t\t\tif (!/(twitter|x).com$/.test(url.hostname)) {\n\t\t\t\tthrow new ApplicationError('Invalid domain');\n\t\t\t}\n\t\t\tconst parts = url.pathname.split('/');\n\t\t\tif (parts.length !== 4 || parts[2] !== 'status' || !/^\\d+$/.test(parts[3])) {\n\t\t\t\tthrow new ApplicationError('Invalid path');\n\t\t\t}\n\t\t\treturn parts[3];\n\t\t} catch (error) {\n\t\t\tthrow new ApplicationError('Not a valid tweet url', { level: 'warning', cause: error });\n\t\t}\n\t} else {\n\t\tthrow new ApplicationError(`The mode ${tweetId.mode} is not valid!`, { level: 'warning' });\n\t}\n}\n\nexport async function returnIdFromUsername(\n\tthis: IExecuteFunctions,\n\tusernameRlc: INodeParameterResourceLocator,\n) {\n\tusernameRlc.value = (usernameRlc.value as string).includes('@')\n\t\t? (usernameRlc.value as string).replace('@', '')\n\t\t: usernameRlc.value;\n\tif (\n\t\tusernameRlc.mode === 'username' ||\n\t\t(usernameRlc.mode === 'name' && this.getNode().parameters.list !== undefined)\n\t) {\n\t\tconst user = (await twitterApiRequest.call(\n\t\t\tthis,\n\t\t\t'GET',\n\t\t\t`/users/by/username/${usernameRlc.value}`,\n\t\t\t{},\n\t\t)) as { id: string };\n\t\treturn user.id;\n\t} else if (this.getNode().parameters.list === undefined) {\n\t\tconst list = (await twitterApiRequest.call(\n\t\t\tthis,\n\t\t\t'GET',\n\t\t\t`/list/by/name/${usernameRlc.value}`,\n\t\t\t{},\n\t\t)) as { id: string };\n\t\treturn list.id;\n\t} else\n\t\tthrow new ApplicationError(`The username mode ${usernameRlc.mode} is not valid!`, {\n\t\t\tlevel: 'warning',\n\t\t});\n}\n"],"mappings":"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","names":[]}