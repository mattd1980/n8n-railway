{"version":3,"sources":["../../../../../../nodes/Microsoft/Excel/v2/methods/listSearch.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tILoadOptionsFunctions,\n\tINodeListSearchItems,\n\tINodeListSearchResult,\n} from 'n8n-workflow';\n\nimport { microsoftApiRequest } from '../transport';\n\nexport async function searchWorkbooks(\n\tthis: ILoadOptionsFunctions,\n\tfilter?: string,\n\tpaginationToken?: string,\n): Promise<INodeListSearchResult> {\n\tconst fileExtensions = ['.xlsx', '.xlsm', '.xlst'];\n\tconst extensionFilter = fileExtensions.join(' OR ');\n\n\tconst q = filter || extensionFilter;\n\n\tlet response: IDataObject = {};\n\n\tif (paginationToken) {\n\t\tresponse = await microsoftApiRequest.call(\n\t\t\tthis,\n\t\t\t'GET',\n\t\t\t'',\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\tpaginationToken, // paginationToken contains the full URL\n\t\t);\n\t} else {\n\t\tresponse = await microsoftApiRequest.call(\n\t\t\tthis,\n\t\t\t'GET',\n\t\t\t`/drive/root/search(q='${q}')`,\n\t\t\tundefined,\n\t\t\t{\n\t\t\t\tselect: 'id,name,webUrl',\n\t\t\t\t$top: 100,\n\t\t\t},\n\t\t);\n\t}\n\n\tif (response.value && filter) {\n\t\tresponse.value = (response.value as IDataObject[]).filter((workbook: IDataObject) => {\n\t\t\treturn fileExtensions.some((extension) => (workbook.name as string).includes(extension));\n\t\t});\n\t}\n\n\treturn {\n\t\tresults: (response.value as IDataObject[]).map((workbook: IDataObject) => {\n\t\t\tfor (const extension of fileExtensions) {\n\t\t\t\tif ((workbook.name as string).includes(extension)) {\n\t\t\t\t\tworkbook.name = (workbook.name as string).replace(extension, '');\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tname: workbook.name as string,\n\t\t\t\tvalue: workbook.id as string,\n\t\t\t\turl: workbook.webUrl as string,\n\t\t\t};\n\t\t}),\n\t\tpaginationToken: response['@odata.nextLink'],\n\t};\n}\n\nexport async function getWorksheetsList(\n\tthis: ILoadOptionsFunctions,\n): Promise<INodeListSearchResult> {\n\tconst workbookRLC = this.getNodeParameter('workbook') as IDataObject;\n\tconst workbookId = workbookRLC.value as string;\n\tlet workbookURL = (workbookRLC.cachedResultUrl as string) ?? '';\n\n\tif (workbookURL.includes('1drv.ms')) {\n\t\tworkbookURL = `https://onedrive.live.com/edit.aspx?resid=${workbookId}`;\n\t}\n\n\tlet response: IDataObject = {};\n\n\tresponse = await microsoftApiRequest.call(\n\t\tthis,\n\t\t'GET',\n\t\t`/drive/items/${workbookId}/workbook/worksheets`,\n\t\tundefined,\n\t\t{\n\t\t\tselect: 'id,name',\n\t\t},\n\t);\n\n\treturn {\n\t\tresults: (response.value as IDataObject[]).map((worksheet: IDataObject) => ({\n\t\t\tname: worksheet.name as string,\n\t\t\tvalue: worksheet.id as string,\n\t\t\turl: workbookURL\n\t\t\t\t? `${workbookURL}&activeCell=${encodeURIComponent(worksheet.name as string)}!A1`\n\t\t\t\t: undefined,\n\t\t})),\n\t};\n}\n\nexport async function getWorksheetTables(\n\tthis: ILoadOptionsFunctions,\n): Promise<INodeListSearchResult> {\n\tconst workbookRLC = this.getNodeParameter('workbook') as IDataObject;\n\tconst workbookId = workbookRLC.value as string;\n\tlet workbookURL = (workbookRLC.cachedResultUrl as string) ?? '';\n\n\tif (workbookURL.includes('1drv.ms')) {\n\t\tworkbookURL = `https://onedrive.live.com/edit.aspx?resid=${workbookId}`;\n\t}\n\n\tconst worksheetId = this.getNodeParameter('worksheet', undefined, {\n\t\textractValue: true,\n\t}) as string;\n\n\tlet response: IDataObject = {};\n\n\tresponse = await microsoftApiRequest.call(\n\t\tthis,\n\t\t'GET',\n\t\t`/drive/items/${workbookId}/workbook/worksheets/${worksheetId}/tables`,\n\t\tundefined,\n\t);\n\n\tconst results: INodeListSearchItems[] = [];\n\n\tfor (const table of response.value as IDataObject[]) {\n\t\tconst name = table.name as string;\n\t\tconst value = table.id as string;\n\n\t\tconst { address } = await microsoftApiRequest.call(\n\t\t\tthis,\n\t\t\t'GET',\n\t\t\t`/drive/items/${workbookId}/workbook/worksheets/${worksheetId}/tables/${value}/range`,\n\t\t\tundefined,\n\t\t\t{\n\t\t\t\tselect: 'address',\n\t\t\t},\n\t\t);\n\n\t\tconst [sheetName, sheetRange] = address.split('!' as string);\n\n\t\tlet url;\n\t\tif (workbookURL) {\n\t\t\turl = `${workbookURL}&activeCell=${encodeURIComponent(sheetName as string)}${\n\t\t\t\tsheetRange ? '!' + (sheetRange as string) : ''\n\t\t\t}`;\n\t\t}\n\n\t\tresults.push({ name, value, url });\n\t}\n\n\treturn { results };\n}\n"],"mappings":"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","names":[]}