{"version":3,"sources":["../../../nodes/SentryIo/GenericFunctions.ts"],"sourcesContent":["import type {\n\tIDataObject,\n\tIExecuteFunctions,\n\tIHookFunctions,\n\tIHttpRequestMethods,\n\tILoadOptionsFunctions,\n\tIRequestOptions,\n\tIWebhookFunctions,\n\tJsonObject,\n} from 'n8n-workflow';\nimport { NodeApiError } from 'n8n-workflow';\n\nexport async function sentryIoApiRequest(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions | IWebhookFunctions,\n\tmethod: IHttpRequestMethods,\n\tresource: string,\n\n\tbody: any = {},\n\tqs: IDataObject = {},\n\turi?: string,\n\toption: IDataObject = {},\n): Promise<any> {\n\tconst authentication = this.getNodeParameter('authentication', 0);\n\n\tconst version = this.getNodeParameter('sentryVersion', 0);\n\n\tconst options = {\n\t\theaders: {},\n\t\tmethod,\n\t\tqs,\n\t\tbody,\n\t\turi: uri || `https://sentry.io${resource}`,\n\t\tjson: true,\n\t} satisfies IRequestOptions;\n\tif (!Object.keys(body as IDataObject).length) {\n\t\tdelete options.body;\n\t}\n\n\tif (Object.keys(option).length !== 0) {\n\t\tObject.assign(options, option);\n\t}\n\n\tif (options.qs.limit) {\n\t\tdelete options.qs.limit;\n\t}\n\n\tlet credentialName;\n\n\ttry {\n\t\tif (authentication === 'accessToken') {\n\t\t\tif (version === 'cloud') {\n\t\t\t\tcredentialName = 'sentryIoApi';\n\t\t\t} else {\n\t\t\t\tcredentialName = 'sentryIoServerApi';\n\t\t\t}\n\n\t\t\tconst credentials = await this.getCredentials(credentialName);\n\n\t\t\tif (credentials.url) {\n\t\t\t\toptions.uri = `${credentials?.url}${resource}`;\n\t\t\t}\n\n\t\t\toptions.headers = {\n\t\t\t\tAuthorization: `Bearer ${credentials?.token}`,\n\t\t\t};\n\n\t\t\treturn await this.helpers.request(options);\n\t\t} else {\n\t\t\treturn await this.helpers.requestOAuth2.call(this, 'sentryIoOAuth2Api', options);\n\t\t}\n\t} catch (error) {\n\t\tthrow new NodeApiError(this.getNode(), error as JsonObject);\n\t}\n}\n\nfunction getNext(link: string) {\n\tif (link === undefined) {\n\t\treturn;\n\t}\n\tconst next = link.split(',')[1];\n\tif (next.includes('rel=\"next\"')) {\n\t\treturn next.split(';')[0].replace('<', '').replace('>', '').trim();\n\t}\n}\n\nfunction hasMore(link: string) {\n\tif (link === undefined) {\n\t\treturn;\n\t}\n\tconst next = link.split(',')[1];\n\tif (next.includes('rel=\"next\"')) {\n\t\treturn next.includes('results=\"true\"');\n\t}\n}\n\nexport async function sentryApiRequestAllItems(\n\tthis: IHookFunctions | IExecuteFunctions | ILoadOptionsFunctions,\n\tmethod: IHttpRequestMethods,\n\tresource: string,\n\n\tbody: any = {},\n\tquery: IDataObject = {},\n): Promise<any> {\n\tconst returnData: IDataObject[] = [];\n\n\tlet responseData;\n\n\tlet link;\n\n\tlet uri: string | undefined;\n\n\tdo {\n\t\tresponseData = await sentryIoApiRequest.call(this, method, resource, body, query, uri, {\n\t\t\tresolveWithFullResponse: true,\n\t\t});\n\t\tlink = responseData.headers.link;\n\t\turi = getNext(link as string);\n\t\treturnData.push.apply(returnData, responseData.body as IDataObject[]);\n\t\tconst limit = query.limit as number | undefined;\n\t\tif (limit && limit >= returnData.length) {\n\t\t\treturn;\n\t\t}\n\t} while (hasMore(link as string));\n\n\treturn returnData;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA,0BAA6B;AAE7B,eAAsB,mBAErB,QACA,UAEA,OAAY,CAAC,GACb,KAAkB,CAAC,GACnB,KACA,SAAsB,CAAC,GACR;AACf,QAAM,iBAAiB,KAAK,iBAAiB,kBAAkB,CAAC;AAEhE,QAAM,UAAU,KAAK,iBAAiB,iBAAiB,CAAC;AAExD,QAAM,UAAU;AAAA,IACf,SAAS,CAAC;AAAA,IACV;AAAA,IACA;AAAA,IACA;AAAA,IACA,KAAK,OAAO,oBAAoB,QAAQ;AAAA,IACxC,MAAM;AAAA,EACP;AACA,MAAI,CAAC,OAAO,KAAK,IAAmB,EAAE,QAAQ;AAC7C,WAAO,QAAQ;AAAA,EAChB;AAEA,MAAI,OAAO,KAAK,MAAM,EAAE,WAAW,GAAG;AACrC,WAAO,OAAO,SAAS,MAAM;AAAA,EAC9B;AAEA,MAAI,QAAQ,GAAG,OAAO;AACrB,WAAO,QAAQ,GAAG;AAAA,EACnB;AAEA,MAAI;AAEJ,MAAI;AACH,QAAI,mBAAmB,eAAe;AACrC,UAAI,YAAY,SAAS;AACxB,yBAAiB;AAAA,MAClB,OAAO;AACN,yBAAiB;AAAA,MAClB;AAEA,YAAM,cAAc,MAAM,KAAK,eAAe,cAAc;AAE5D,UAAI,YAAY,KAAK;AACpB,gBAAQ,MAAM,GAAG,aAAa,GAAG,GAAG,QAAQ;AAAA,MAC7C;AAEA,cAAQ,UAAU;AAAA,QACjB,eAAe,UAAU,aAAa,KAAK;AAAA,MAC5C;AAEA,aAAO,MAAM,KAAK,QAAQ,QAAQ,OAAO;AAAA,IAC1C,OAAO;AACN,aAAO,MAAM,KAAK,QAAQ,cAAc,KAAK,MAAM,qBAAqB,OAAO;AAAA,IAChF;AAAA,EACD,SAAS,OAAO;AACf,UAAM,IAAI,iCAAa,KAAK,QAAQ,GAAG,KAAmB;AAAA,EAC3D;AACD;AAEA,SAAS,QAAQ,MAAc;AAC9B,MAAI,SAAS,QAAW;AACvB;AAAA,EACD;AACA,QAAM,OAAO,KAAK,MAAM,GAAG,EAAE,CAAC;AAC9B,MAAI,KAAK,SAAS,YAAY,GAAG;AAChC,WAAO,KAAK,MAAM,GAAG,EAAE,CAAC,EAAE,QAAQ,KAAK,EAAE,EAAE,QAAQ,KAAK,EAAE,EAAE,KAAK;AAAA,EAClE;AACD;AAEA,SAAS,QAAQ,MAAc;AAC9B,MAAI,SAAS,QAAW;AACvB;AAAA,EACD;AACA,QAAM,OAAO,KAAK,MAAM,GAAG,EAAE,CAAC;AAC9B,MAAI,KAAK,SAAS,YAAY,GAAG;AAChC,WAAO,KAAK,SAAS,gBAAgB;AAAA,EACtC;AACD;AAEA,eAAsB,yBAErB,QACA,UAEA,OAAY,CAAC,GACb,QAAqB,CAAC,GACP;AACf,QAAM,aAA4B,CAAC;AAEnC,MAAI;AAEJ,MAAI;AAEJ,MAAI;AAEJ,KAAG;AACF,mBAAe,MAAM,mBAAmB,KAAK,MAAM,QAAQ,UAAU,MAAM,OAAO,KAAK;AAAA,MACtF,yBAAyB;AAAA,IAC1B,CAAC;AACD,WAAO,aAAa,QAAQ;AAC5B,UAAM,QAAQ,IAAc;AAC5B,eAAW,KAAK,MAAM,YAAY,aAAa,IAAqB;AACpE,UAAM,QAAQ,MAAM;AACpB,QAAI,SAAS,SAAS,WAAW,QAAQ;AACxC;AAAA,IACD;AAAA,EACD,SAAS,QAAQ,IAAc;AAE/B,SAAO;AACR;","names":[]}