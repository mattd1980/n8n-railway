{"version":3,"sources":["../../../nodes/CompareDatasets/CompareDatasets.node.ts"],"sourcesContent":["import {\n\ttype IExecuteFunctions,\n\ttype IDataObject,\n\ttype INodeExecutionData,\n\ttype INodeType,\n\ttype INodeTypeDescription,\n\tNodeConnectionTypes,\n} from 'n8n-workflow';\n\nimport {\n\tcheckInput,\n\tcheckInputAndThrowError,\n\tcheckMatchFieldsInput,\n\tfindMatches,\n} from './GenericFunctions';\n\nexport class CompareDatasets implements INodeType {\n\tdescription: INodeTypeDescription = {\n\t\tdisplayName: 'Compare Datasets',\n\t\tname: 'compareDatasets',\n\t\ticon: 'file:compare.svg',\n\t\tgroup: ['transform'],\n\t\tversion: [1, 2, 2.1, 2.2, 2.3],\n\t\tdescription: 'Compare two inputs for changes',\n\t\tdefaults: { name: 'Compare Datasets' },\n\n\t\tinputs: [NodeConnectionTypes.Main, NodeConnectionTypes.Main],\n\t\tinputNames: ['Input A', 'Input B'],\n\t\trequiredInputs: 1,\n\n\t\toutputs: [\n\t\t\tNodeConnectionTypes.Main,\n\t\t\tNodeConnectionTypes.Main,\n\t\t\tNodeConnectionTypes.Main,\n\t\t\tNodeConnectionTypes.Main,\n\t\t],\n\t\toutputNames: ['In A only', 'Same', 'Different', 'In B only'],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tdisplayName:\n\t\t\t\t\t'Items from different branches are paired together when the fields below match. If paired, the rest of the fields are compared to determine whether the items are the same or different',\n\t\t\t\tname: 'infoBox',\n\t\t\t\ttype: 'notice',\n\t\t\t\tdefault: '',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Fields to Match',\n\t\t\t\tname: 'mergeByFields',\n\t\t\t\ttype: 'fixedCollection',\n\t\t\t\tplaceholder: 'Add Fields to Match',\n\t\t\t\tdefault: { values: [{ field1: '', field2: '' }] },\n\t\t\t\ttypeOptions: {\n\t\t\t\t\tmultipleValues: true,\n\t\t\t\t},\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tdisplayName: 'Values',\n\t\t\t\t\t\tname: 'values',\n\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdisplayName: 'Input A Field',\n\t\t\t\t\t\t\t\tname: 'field1',\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t\t\t\t// eslint-disable-next-line n8n-nodes-base/node-param-placeholder-miscased-id\n\t\t\t\t\t\t\t\tplaceholder: 'e.g. id',\n\t\t\t\t\t\t\t\thint: ' Enter the field name as text',\n\t\t\t\t\t\t\t\trequiresDataPath: 'single',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdisplayName: 'Input B Field',\n\t\t\t\t\t\t\t\tname: 'field2',\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t\t\t\t// eslint-disable-next-line n8n-nodes-base/node-param-placeholder-miscased-id\n\t\t\t\t\t\t\t\tplaceholder: 'e.g. id',\n\t\t\t\t\t\t\t\thint: ' Enter the field name as text',\n\t\t\t\t\t\t\t\trequiresDataPath: 'single',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'When There Are Differences',\n\t\t\t\tname: 'resolve',\n\t\t\t\ttype: 'options',\n\t\t\t\tdefault: 'preferInput2',\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Use Input A Version',\n\t\t\t\t\t\tvalue: 'preferInput1',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Use Input B Version',\n\t\t\t\t\t\tvalue: 'preferInput2',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Use a Mix of Versions',\n\t\t\t\t\t\tvalue: 'mix',\n\t\t\t\t\t\tdescription: 'Output uses different inputs for different fields',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Include Both Versions',\n\t\t\t\t\t\tvalue: 'includeBoth',\n\t\t\t\t\t\tdescription: 'Output contains all data (but structure more complex)',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\t'@version': [1, 2],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'When There Are Differences',\n\t\t\t\tname: 'resolve',\n\t\t\t\ttype: 'options',\n\t\t\t\tdefault: 'includeBoth',\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Use Input A Version',\n\t\t\t\t\t\tvalue: 'preferInput1',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Use Input B Version',\n\t\t\t\t\t\tvalue: 'preferInput2',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Use a Mix of Versions',\n\t\t\t\t\t\tvalue: 'mix',\n\t\t\t\t\t\tdescription: 'Output uses different inputs for different fields',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Include Both Versions',\n\t\t\t\t\t\tvalue: 'includeBoth',\n\t\t\t\t\t\tdescription: 'Output contains all data (but structure more complex)',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\thide: {\n\t\t\t\t\t\t'@version': [1, 2],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Fuzzy Compare',\n\t\t\t\tname: 'fuzzyCompare',\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdefault: false,\n\t\t\t\tdescription:\n\t\t\t\t\t\"Whether to tolerate small type differences when comparing fields. E.g. the number 3 and the string '3' are treated as the same.\",\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\thide: {\n\t\t\t\t\t\t'@version': [1],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Prefer',\n\t\t\t\tname: 'preferWhenMix',\n\t\t\t\ttype: 'options',\n\t\t\t\tdefault: 'input1',\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Input A Version',\n\t\t\t\t\t\tvalue: 'input1',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'Input B Version',\n\t\t\t\t\t\tvalue: 'input2',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresolve: ['mix'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'For Everything Except',\n\t\t\t\tname: 'exceptWhenMix',\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: '',\n\t\t\t\t// eslint-disable-next-line n8n-nodes-base/node-param-placeholder-miscased-id\n\t\t\t\tplaceholder: 'e.g. id, country',\n\t\t\t\thint: 'Enter the names of the input fields as text, separated by commas',\n\t\t\t\tdisplayOptions: {\n\t\t\t\t\tshow: {\n\t\t\t\t\t\tresolve: ['mix'],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\trequiresDataPath: 'multiple',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Options',\n\t\t\t\tname: 'options',\n\t\t\t\ttype: 'collection',\n\t\t\t\tplaceholder: 'Add option',\n\t\t\t\tdefault: {},\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tdisplayName: 'Fields to Skip Comparing',\n\t\t\t\t\t\tname: 'skipFields',\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tdefault: '',\n\t\t\t\t\t\tplaceholder: 'e.g. updated_at, updated_by',\n\t\t\t\t\t\thint: 'Enter the field names as text, separated by commas',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\"Fields that shouldn't be included when checking whether two items are the same\",\n\t\t\t\t\t\trequiresDataPath: 'multiple',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tdisplayName: 'Fuzzy Compare',\n\t\t\t\t\t\tname: 'fuzzyCompare',\n\t\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\t\tdefault: false,\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\"Whether to tolerate small type differences when comparing fields. E.g. the number 3 and the string '3' are treated as the same.\",\n\t\t\t\t\t\tdisplayOptions: {\n\t\t\t\t\t\t\tshow: {\n\t\t\t\t\t\t\t\t'@version': [1],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tdisplayName: 'Disable Dot Notation',\n\t\t\t\t\t\tname: 'disableDotNotation',\n\t\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\t\tdefault: false,\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'Whether to disallow referencing child fields using `parent.child` in the field name',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tdisplayName: 'Multiple Matches',\n\t\t\t\t\t\tname: 'multipleMatches',\n\t\t\t\t\t\ttype: 'options',\n\t\t\t\t\t\tdefault: 'first',\n\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'Include First Match Only',\n\t\t\t\t\t\t\t\tvalue: 'first',\n\t\t\t\t\t\t\t\tdescription: 'Only ever output a single item per match',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'Include All Matches',\n\t\t\t\t\t\t\t\tvalue: 'all',\n\t\t\t\t\t\t\t\tdescription: 'Output multiple items if there are multiple matches',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t],\n\t};\n\n\tasync execute(this: IExecuteFunctions): Promise<INodeExecutionData[][]> {\n\t\tconst matchFields = checkMatchFieldsInput(\n\t\t\tthis.getNodeParameter('mergeByFields.values', 0, []) as IDataObject[],\n\t\t);\n\n\t\tconst options = this.getNodeParameter('options', 0, {});\n\n\t\toptions.nodeVersion = this.getNode().typeVersion;\n\n\t\tif (options.nodeVersion >= 2) {\n\t\t\toptions.fuzzyCompare = this.getNodeParameter('fuzzyCompare', 0, false) as boolean;\n\t\t}\n\n\t\tlet input1 = this.getInputData(0);\n\t\tlet input2 = this.getInputData(1);\n\t\tif (options.nodeVersion < 2.2) {\n\t\t\tinput1 = checkInputAndThrowError(\n\t\t\t\tinput1,\n\t\t\t\tmatchFields.map((pair) => pair.field1),\n\t\t\t\t(options.disableDotNotation as boolean) || false,\n\t\t\t\t'Input A',\n\t\t\t);\n\n\t\t\tinput2 = checkInputAndThrowError(\n\t\t\t\tinput2,\n\t\t\t\tmatchFields.map((pair) => pair.field2),\n\t\t\t\t(options.disableDotNotation as boolean) || false,\n\t\t\t\t'Input B',\n\t\t\t);\n\t\t} else {\n\t\t\tinput1 = checkInput(input1);\n\t\t\tinput2 = checkInput(input2);\n\t\t}\n\n\t\tconst resolve = this.getNodeParameter('resolve', 0, '') as string;\n\t\toptions.resolve = resolve;\n\n\t\tif (resolve === 'mix') {\n\t\t\toptions.preferWhenMix = this.getNodeParameter('preferWhenMix', 0, '') as string;\n\t\t\toptions.exceptWhenMix = this.getNodeParameter('exceptWhenMix', 0, '') as string;\n\t\t}\n\n\t\tconst matches = findMatches(input1, input2, matchFields, options);\n\n\t\treturn matches;\n\t}\n}\n"],"mappings":"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","names":[]}